<!DOCTYPE html>
<html lang="zh-CN" class="no-js">

<head>
    
<title>Golang 速查表 Cheatsheet</title>
<meta charset="utf-8">

<meta name="robots" content="index,nofollow">


<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="x-dns-prefetch-control" content="on">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="origin-when-cross-origin" />

<meta name="description" content="Golang Golang General gb Go Tool import Scope Constants iota - generator (auto-increment) Variables Short Notation assignment for new variables Multiple Assignment Default values Bitwise operations 位运算符 Types Basic Data Types int, float, bool Short-circuit behavior string Unicode Iterate on symbols Iterate on bytes Composite Types Array Slice Map Control Flow if for switch Function Anonymous Function Closure Recursive Functions defer panic() init() Pointers new vs. make">

<meta name="author" content=rinetd>

<meta name="baidu-site-verification" content="pCInWQYbNT" />
<meta name="google-site-verification" content="ifeWsnNpU7w8vP3ii_Cjq-P9LKw3ngVitnMWv4XmJqk" />





  
  
  
  
  
  

  








<link rel="canonical" href="../../../language/golang/_cheatsheets/" />

<link rel="icon" href="../../../public/favicon.ico"/>
<link rel="shortcut icon" href="../../../public/favicon.ico"/>













<link rel="stylesheet" href="../../../front/css/main.min.css" >

<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">






<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

</head>

<body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome">
    <div id="wrapper">
        <header id="header" class="top-menu-mobile-on one-mobile-menu top_menu header-ads-desktop  topbar-transparent">
    
  <nav class="nav-container group mobile-menu mobile-sticky " id="nav-mobile" data-menu-id="header-1">
    <div class="mobile-title-logo-in-header">
        <p class="site-title">
            <a class="custom-logo-link" href="" rel="home" title="Pytool | Home ">
                
                Pytool
            </a>
        </p>
    </div>
    <div class="ham__navbar-toggler-two collapsed" title="Menu" aria-expanded="false">
        <div class="ham__navbar-span-wrapper">
            <span class="line line-1"></span>
            <span class="line line-2"></span>
            <span class="line line-3"></span>
        </div>
    </div>
    <div class="nav-text">Golang 速查表 Cheatsheets</div>
    <div class="nav-wrap container">
        <ul class="nav container-inner group mobile-search">
            <li>
                <form method="get" class="searchform themeform" action="https://demo-hueman.presscustomizr.com/">
                    <div>
                        <input type="text" class="search" name="s" onblur="if(this.value=='')this.value='To search type and hit enter';" onfocus="if(this.value=='To search type and hit enter')this.value='';" value="To search type and hit enter"/>
                    </div>
                </form>
            </li>
        </ul>
        <ul id="menu-topbar-menu" class="nav container-inner group">
        
            <li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home ">
            <a href=" ">Home</a>
            </li>

        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../ai/">Ai </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../ai/math/">Math</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../language/">Language </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/python/">Python</a>
                                
                                            
                                                 
                                        <ul class="sub-menu">
                                            
                                                <li class="menu-item menu-item-type-custom menu-item-object-custom ">
                                                <a href="../../../language/python/scrapy/">Scrapy</a>
                                                
                                            </li>                
                                            
                                        </ul>
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/golang/">Golang</a>
                                
                                            
                                                 
                                        <ul class="sub-menu">
                                            
                                                <li class="menu-item menu-item-type-custom menu-item-object-custom ">
                                                <a href="../../../language/golang/hugo/">Hugo</a>
                                                
                                            </li>                
                                            
                                                <li class="menu-item menu-item-type-custom menu-item-object-custom ">
                                                <a href="../../../language/golang/goher/">Goher</a>
                                                
                                            </li>                
                                            
                                        </ul>
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/java/">Java</a>
                                
                                            
                                                 
                                        <ul class="sub-menu">
                                            
                                                <li class="menu-item menu-item-type-custom menu-item-object-custom ">
                                                <a href="../../../language/java/hadoop/">Hadoop</a>
                                                
                                            </li>                
                                            
                                        </ul>
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/awesome/">Awesome</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/php/">Php</a>
                                
                                            
                                                 
                                        <ul class="sub-menu">
                                            
                                                <li class="menu-item menu-item-type-custom menu-item-object-custom ">
                                                <a href="../../../language/php/magento/">Magento</a>
                                                
                                            </li>                
                                            
                                        </ul>
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../language/android/">Android</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../macos/">Macos </a>
                
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../hardware/">Hardware </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hardware/rtmp/">Rtmp</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hardware/%E8%BD%A6%E8%81%94%E7%BD%91/">车联网</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hardware/android-%E5%BA%95%E5%B1%82/">Android-底层</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../linux/">Linux </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/cmd/">Cmd</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/shell/">Shell</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/nginx/">Nginx</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/ip/">Ip</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/git/">Git</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/haproxy/">Haproxy</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../linux/lvs/">Lvs</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../frontend/">Frontend </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../frontend/css/">Css</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../frontend/vue/">Vue</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../devops/">Devops </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/docker/">Docker</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/elk/">Elk</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/ansible/">Ansible</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/prometheus/">Prometheus</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/drone/">Drone</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/kubernetes/">Kubernetes</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/oauth2/">OAuth2</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/etcd/">Etcd</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/apidoc/">Apidoc</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/">系统监控</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../database/">Database </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../database/mysql/">Mysql</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../database/mongo/">Mongo</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../database/redis/">Redis</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../windows/">Windows </a>
                
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../hacker/">Hacker </a>
                
                                 
                            <ul class="sub-menu">
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/">01_端口扫描</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/">00_端口转发(隧道)</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hacker/01-info-gather/">01-Info-Gather</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hacker/02-spoof/">02-Spoof</a>
                                
                                            
                                        
                                </li>                
                            
                                <li class="menu-item menu-item-type-post_type menu-item-object-page">
                                <a href="../../../hacker/shells/">Shells</a>
                                
                                            
                                        
                                </li>                
                            
                            </ul>
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../work/">Work </a>
                
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../weixin/">Weixin </a>
                
                        

              </li>
            
        
            
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children">
                
                <a  href="../../../edit/">Edit </a>
                
                        

              </li>
            
        
        
        <li class="item ">
                <a class="text" href="../../../series/">series</a>
        </li>
        <li class="item ">
                <a class="text" href="../../../categories/">categories</a>
        </li>
        <li class="item ">
                <a class="text" href="../../../tags/">tags</a>
        </li>
        <li class="item ">
                <a class="text" href="../../../me/">about</a>
        </li>

        
        </ul>
    </div>
  </nav>
    
  <nav class="nav-container group desktop-menu desktop-sticky " id="nav-topbar" data-menu-id="header-2">
    <div class="nav-text">Golang 速查表 Cheatsheets</div>
    
    <div class="topbar-toggle-down">
        <i class="fas fa-angle-double-down" aria-hidden="true" data-toggle="down" title="Expand menu"></i>
        <i class="fas fa-angle-double-up" aria-hidden="true" data-toggle="up" title="Collapse menu"></i>
    </div>

    
    <div class="nav-wrap container">
      <ul id="menu-topbar-menu-1" class="nav container-inner group">
        <li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home ">
            <a href="../../../">Home</a></li>
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../ai/">Ai </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../ai/math/">Math</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../language/">Language </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/python/">Python</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/golang/">Golang</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/java/">Java</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/awesome/">Awesome</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/php/">Php</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../language/android/">Android</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../macos/">Macos </a>
                
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../hardware/">Hardware </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hardware/rtmp/">Rtmp</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hardware/%E8%BD%A6%E8%81%94%E7%BD%91/">车联网</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hardware/android-%E5%BA%95%E5%B1%82/">Android-底层</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../linux/">Linux </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/cmd/">Cmd</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/shell/">Shell</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/nginx/">Nginx</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/ip/">Ip</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/git/">Git</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/haproxy/">Haproxy</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../linux/lvs/">Lvs</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../post/">Post </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/software/">Software</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/english/">English</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/seo/">Seo</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/life/">Life</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/wiki/">Wiki</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/basic/">Basic</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../post/reship/">Reship</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../frontend/">Frontend </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../frontend/css/">Css</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../frontend/vue/">Vue</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../devops/">Devops </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/docker/">Docker</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/elk/">Elk</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/ansible/">Ansible</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/prometheus/">Prometheus</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/drone/">Drone</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/kubernetes/">Kubernetes</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/oauth2/">OAuth2</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/etcd/">Etcd</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/apidoc/">Apidoc</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/">系统监控</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../database/">Database </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../database/mysql/">Mysql</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../database/mongo/">Mongo</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../database/redis/">Redis</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../windows/">Windows </a>
                
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../hacker/">Hacker </a>
                
                           
                    <ul class="sub-menu">
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/">01_端口扫描</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/">00_端口转发(隧道)</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hacker/01-info-gather/">01-Info-Gather</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hacker/02-spoof/">02-Spoof</a>
                          
                        </li>                
                        
                        <li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag">
                          <a href="../../../hacker/shells/">Shells</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../work/">Work </a>
                
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../weixin/">Weixin </a>
                
                  
              </li>
                    
        
            
              
                  <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children">
                <a href="../../../edit/">Edit </a>
                
                  
              </li>
                    
        
       
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="../../../series/">series</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="../../../categories/">categories</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="../../../tags/">tags</a>
        </li>
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a href="../../../me/">about</a>
        </li>
        

        
      </ul>
      
    </div>
    
    
  
  </nav>
  

  
  

</header>

        <div class="container" id="page">
            <div class="container-inner">
                <div class="main">
                    <div class="main-inner group">
                        <div class="content">
    
        <div class="pad group page-title">
            <ul class="meta-single group">
                
                <li><span class="fa fa-folder-open"></span></li>
                
            </ul>
        </div>

        
        <div class="pad group">
            <article class="post type-post status-publish format-standard has-post-thumbnail hentry category-lifestyle tag-classical-grid tag-masonry-grid tag-standard-list">
                <div class="post-inner group">
                        <h1 class="post-title">Golang 速查表 Cheatsheets</h1>

                        <p class="post-byline">
                          by  · 2018年04月09日 · 14336 Words ·
                          ~29min reading time |
                          
                          
                          <a href="https://gitlab.com/rinetd/blog/edit/master/language/golang/_cheatsheets.md" target="_blank">Improve on <i class="fa fa-gitlab"></i></a>
                        </p>
                    <div class="clear"></div>
                    <div class="entry themeform">
                        <div class="entry-inner">
                            
                            </br>
                            原文链接：<a target="_blank" href="../../../language/golang/_cheatsheets/"> Golang 速查表 Cheatsheets</a> 
                            </p>
                            

<h1 id="golang">Golang</h1>

<ul>
<li><a href="#golang">Golang</a><br />

<ul>
<li><a href="#general">General</a><br /></li>
<li><a href="#gb"><code>gb</code></a><br /></li>
<li><a href="#go-tool">Go Tool</a><br /></li>
<li><a href="#import">import</a><br /></li>
<li><a href="#scope">Scope</a><br /></li>
<li><a href="#constants">Constants</a><br />

<ul>
<li><a href="#iota---generator-auto-increment"><code>iota</code> - generator (auto-increment)</a><br /></li>
</ul></li>
<li><a href="#variables">Variables</a><br /></li>
<li><a href="#short-notation-assignment-for-new-variables">Short Notation assignment for new variables</a><br /></li>
<li><a href="#multiple-assignment">Multiple Assignment</a><br /></li>
<li><a href="#default-values">Default values</a><br /></li>
<li><a href="#bitwise-operations-%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6">Bitwise operations 位运算符</a><br /></li>
<li><a href="#types">Types</a><br /></li>
<li><a href="#basic-data-types">Basic Data Types</a><br /></li>
<li><a href="#int-float-bool"><code>int</code>, <code>float</code>, <code>bool</code></a><br />

<ul>
<li><a href="#short-circuit-behavior">Short-circuit behavior</a><br /></li>
</ul></li>
<li><a href="#string"><code>string</code></a><br /></li>
<li><a href="#unicode">Unicode</a><br /></li>
<li><a href="#iterate-on-symbols">Iterate on symbols</a><br /></li>
<li><a href="#iterate-on-bytes">Iterate on bytes</a><br /></li>
<li><a href="#composite-types">Composite Types</a><br /></li>
<li><a href="#array">Array</a><br /></li>
<li><a href="#slice">Slice</a><br /></li>
<li><a href="#map">Map</a><br /></li>
<li><a href="#control-flow">Control Flow</a><br /></li>
<li><a href="#if"><code>if</code></a><br /></li>
<li><a href="#for"><code>for</code></a><br /></li>
<li><a href="#switch"><code>switch</code></a><br /></li>
<li><a href="#function">Function</a><br /></li>
<li><a href="#anonymous-function">Anonymous Function</a><br /></li>
<li><a href="#closure">Closure</a><br /></li>
<li><a href="#recursive-functions">Recursive Functions</a><br /></li>
<li><a href="#defer"><code>defer</code></a><br /></li>
<li><a href="#panic"><code>panic()</code></a><br /></li>
<li><a href="#init"><code>init()</code></a><br /></li>
<li><a href="#pointers">Pointers</a><br /></li>
<li><a href="#new-vs-make"><code>new</code> vs. <code>make</code></a><br /></li>
<li><a href="#heap-vs-stack">Heap vs. Stack</a><br /></li>
<li><a href="#named-basic-types">Named basic types</a><br /></li>
<li><a href="#struct-concrete-type">Struct (concrete type)</a><br /></li>
<li><a href="#type-methods">Type methods</a><br /></li>
<li><a href="#method-values-and-expressions">Method Values and Expressions</a><br /></li>
<li><a href="#interface-abstract-type">Interface (abstract type)</a><br /></li>
<li><a href="#empty-interface-as-a-type">Empty interface as a type</a><br /></li>
<li><a href="#interface-value">Interface Value</a><br /></li>
<li><a href="#interface-with-nil-pointer">Interface with <code>nil</code> Pointer</a><br /></li>
<li><a href="#embed">Embed</a><br /></li>
<li><a href="#error">Error</a><br /></li>
<li><a href="#type-assertion">Type Assertion</a><br /></li>
<li><a href="#switch-type-assertion">Switch Type Assertion</a><br /></li>
<li><a href="#goroutines">Goroutines</a><br /></li>
<li><a href="#overview">Overview</a><br /></li>
<li><a href="#go-run--race"><code>go run -race</code></a><br /></li>
<li><a href="#go-routine--closure"><code>go routine</code> &amp; closure</a><br /></li>
<li><a href="#shadowing-variable">Shadowing variable</a><br /></li>
<li><a href="#channel">Channel</a><br /></li>
<li><a href="#overview-1">Overview</a><br /></li>
<li><a href="#buffered--unbuffered-channels">Buffered &amp; unbuffered channels</a><br /></li>
<li><a href="#read-from-channel-w-range">Read from channel w/ <code>range</code></a><br /></li>
<li><a href="#channel-generator">Channel generator</a><br /></li>
<li><a href="#sync-go-routines-using-channels">Sync go routines using channels</a><br /></li>
<li><a href="#channel-multiplexer">Channel multiplexer</a><br /></li>
<li><a href="#select"><code>Select</code></a><br /></li>
<li><a href="#packages">Packages</a><br /></li>
<li><a href="#io"><code>io</code></a><br />

<ul>
<li><a href="#reader"><code>Reader</code></a><br /></li>
<li><a href="#readfull-readatleast"><code>ReadFull()</code>, <code>ReadAtLeast()</code></a><br /></li>
<li><a href="#multireader"><code>MultiReader()</code></a><br /></li>
<li><a href="#teereader"><code>TeeReader()</code></a><br /></li>
<li><a href="#limitreader"><code>LimitReader()</code></a><br /></li>
<li><a href="#writer"><code>Writer</code></a><br /></li>
<li><a href="#multiwriter"><code>MultiWriter()</code></a><br /></li>
<li><a href="#writestring"><code>WriteString()</code></a><br /></li>
<li><a href="#copy-copyn-copybuffer"><code>Copy()</code>, <code>CopyN()</code>, <code>CopyBuffer()</code></a><br /></li>
<li><a href="#writerto-readerfrom"><code>WriterTo</code>, <code>ReaderFrom</code></a><br /></li>
<li><a href="#pipe"><code>Pipe()</code></a><br /></li>
<li><a href="#closer"><code>Closer</code></a><br /></li>
<li><a href="#seeker"><code>Seeker</code></a><br /></li>
<li><a href="#bytereader-bytewriter-bytescanner"><code>ByteReader</code>, <code>ByteWriter</code>, <code>ByteScanner</code></a><br /></li>
<li><a href="#runereader-runescanner"><code>RuneReader</code>, <code>RuneScanner</code></a><br /></li>
</ul></li>
<li><a href="#bytes-strings"><code>bytes</code>, <code>strings</code></a><br />

<ul>
<li><a href="#newreader"><code>NewReader</code></a><br /></li>
<li><a href="#buffer"><code>Buffer</code></a><br /></li>
</ul></li>
<li><a href="#bufio"><code>bufio</code></a><br /></li>
<li><a href="#encoding"><code>encoding</code></a><br /></li>
<li><a href="#encodingjson"><code>encoding/json</code></a><br />

<ul>
<li><a href="#rawmessage"><code>RawMessage</code></a><br /></li>
<li><a href="#indent-setindent-compact"><code>Indent()</code>, <code>SetIndent()</code>, <code>Compact()</code></a><br /></li>
<li><a href="#newencoder-newdecoder"><code>NewEncoder()</code>, <code>NewDecoder()</code></a><br /></li>
<li><a href="#struct-field-attributes">Struct Field Attributes</a><br /></li>
</ul></li>
<li><a href="#encodingbinary"><code>encoding/binary</code></a><br />

<ul>
<li><a href="#endianness">Endianness</a><br /></li>
<li><a href="#variable-length-encoding">Variable-length encoding</a><br /></li>
</ul></li>
<li><a href="#strconv"><code>strconv</code></a><br />

<ul>
<li><a href="#int"><code>int</code></a><br /></li>
<li><a href="#float"><code>float</code></a><br /></li>
<li><a href="#boolean"><code>boolean</code></a><br /></li>
<li><a href="#string-1"><code>string</code></a><br /></li>
</ul></li>
<li><a href="#fmt"><code>fmt</code></a><br /></li>
<li><a href="#http"><code>http</code></a><br />

<ul>
<li><a href="#servemux"><code>ServeMux</code></a><br /></li>
<li><a href="#handler-handlerfunc-handle-handlefunc"><code>Handler</code>, <code>HandlerFunc</code>, <code>Handle()</code>, <code>HandleFunc()</code></a><br /></li>
<li><a href="#listenandserve"><code>ListenAndServe()</code></a><br /></li>
<li><a href="#handlers">Handlers</a><br /></li>
<li><a href="#chain-handlers-middleware">Chain Handlers (middleware)</a><br /></li>
<li><a href="#getpost"><code>Get()</code>/<code>Post()</code></a><br /></li>
</ul></li>
<li><a href="#context"><code>context</code></a><br /></li>
<li><a href="#netrpc"><code>net/rpc</code></a><br />

<ul>
<li><a href="#rpc-over-tcp"><code>RPC over TCP</code></a><br /></li>
<li><a href="#rpc-over-http"><code>RPC over HTTP</code></a><br /></li>
<li><a href="#json-rpc-over-http"><code>JSON-RPC over HTTP</code></a><br /></li>
</ul></li>
<li><a href="#nethttphttputil"><code>net/http/httputil</code></a><br /></li>
<li><a href="#html"><code>html</code></a><br /></li>
<li><a href="#sort"><code>sort</code></a><br /></li>
<li><a href="#compressgzip"><code>compress/gzip</code></a><br /></li>
<li><a href="#ioutil"><code>ioutil</code></a><br /></li>
<li><a href="#sync"><code>sync</code></a><br />

<ul>
<li><a href="#syncatomic"><code>sync/atomic</code></a><br /></li>
<li><a href="#waitgroup">WaitGroup</a><br /></li>
<li><a href="#mutex">Mutex</a><br /></li>
<li><a href="#rwmutex">RWMutex</a><br /></li>
<li><a href="#map-1">Map</a><br /></li>
</ul></li>
<li><a href="#time"><code>time</code></a><br /></li>
<li><a href="#runtime"><code>runtime</code></a><br /></li>
<li><a href="#flag"><code>flag</code></a><br /></li>
<li><a href="#os"><code>os</code></a><br /></li>
<li><a href="#network">Network</a><br /></li>
<li><a href="#tcp-echo-server-async">TCP echo server (Async)</a><br /></li>
<li><a href="#http-server">HTTP Server</a><br /></li>
<li><a href="#json-api-server">JSON API Server</a><br /></li>
<li><a href="#templates">Templates</a><br /></li>
<li><a href="#texttemplate"><code>text/template</code></a><br /></li>
<li><a href="#htmltemplate"><code>html/template</code></a><br /></li>
<li><a href="#inline">Inline</a><br /></li>
<li><a href="#separate-file">Separate file</a><br /></li>
<li><a href="#cookies">Cookies</a><br /></li>
<li><a href="#database">DataBase</a><br /></li>
<li><a href="#mysql">MySQL</a><br />

<ul>
<li><a href="#connect">Connect</a><br /></li>
<li><a href="#query-for-select-many"><code>Query()</code> for <code>SELECT</code> many</a><br /></li>
<li><a href="#queryrow-for-select-one"><code>QueryRow()</code> for <code>SELECT</code> one</a><br /></li>
<li><a href="#exec-for-insertupdate"><code>Exec()</code> for <code>INSERT</code>/<code>UPDATE</code></a><br /></li>
<li><a href="#prepared-statements-prepare--exec">Prepared statements: <code>Prepare()</code> + <code>Exec()</code></a><br /></li>
</ul></li>
<li><a href="#postgresql">PostgreSQL</a><br />

<ul>
<li><a href="#connect-1">Connect</a><br /></li>
<li><a href="#query-for-select-many-1"><code>Query()</code> for <code>SELECT</code> many</a><br /></li>
<li><a href="#queryrow-for-select-one-1"><code>QueryRow()</code> for <code>SELECT</code> one</a><br /></li>
<li><a href="#queryrow-for-insert--lastinsertid"><code>QueryRow()</code> for <code>INSERT</code> + <code>LastInsertId()</code></a><br /></li>
<li><a href="#exec-for-insertupdate-1"><code>Exec()</code> for <code>INSERT</code>/<code>UPDATE</code></a><br /></li>
<li><a href="#prepared-statements-prepare--exec-1">Prepared statements: <code>Prepare()</code> + <code>Exec()</code></a><br /></li>
</ul></li>
<li><a href="#memcached">Memcached</a><br /></li>
<li><a href="#redis">Redis</a><br />

<ul>
<li><a href="#cache-invalidation">Cache Invalidation</a><br /></li>
</ul></li>
<li><a href="#mongodb">MongoDB</a><br /></li>
<li><a href="#orm">ORM</a><br /></li>
<li><a href="#tests">Tests</a><br /></li>
<li><a href="#simple">Simple</a><br /></li>
<li><a href="#test-http-handlers">Test HTTP handlers</a><br /></li>
<li><a href="#mocks">Mocks</a><br />
<br />
<br /></li>
</ul></li>
</ul>

<h2 id="general">General</h2>

<p>Binary file, that includes all dependencies.</p>

<pre><code>GOPATH
   ├── bin/
   ├── pkg/
   │    └── linux_amd64/
   └── src/
       ├── github.com
       │      └── oleglegun/
       ├── golang.org
       └── gopkg.in
</code></pre>

<pre><code class="language-go">/*
Every package should have a package comment.
Package ... implements ...
*/
package main // executable main must contain function `main`

func main() {
    println(&quot;Hello&quot;)  // println works w/o any libs
}

// Do makes ...
func Do() {}
</code></pre>

<h2 id="gb"><code>gb</code></h2>

<p>Vendoring - save dependencies within repository.</p>

<p><code>vendor/src/my-lib</code> folder can keep all local vendoring files.</p>

<p><code>alias ggb='$GOPATH/bin/gb'</code></p>

<p>Files structure with <code>gb</code>:</p>

<pre><code>project
   ├── src/
   └── vendor/
       └── src/
            └── github.com/
</code></pre>

<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>gb vendor fetch gopkg.in/telegram-bot-api.v4</code></td>
<td align="left">Download package to local <code>vendor</code> folder</td>
</tr>

<tr>
<td align="left"><code>gb vendor update</code></td>
<td align="left">Update all local packages</td>
</tr>

<tr>
<td align="left"><code>gb vendor restore</code></td>
<td align="left">Install all packages listed in <code>manifest</code></td>
</tr>

<tr>
<td align="left"><code>gb build</code></td>
<td align="left">Build project from <code>src/</code></td>
</tr>
</tbody>
</table>

<blockquote>
<p>All info about packages is located in <code>manifest</code></p>
</blockquote>

<h2 id="go-tool">Go Tool</h2>

<pre><code class="language-bash">
go run main.go # build + execute program
go build main.go; ./main # build + execute separately
go get -u github.com/user/repo

# cross compilation
env GOOS=linux GOARCH=amd64 go build -o ./bin/cmd ./src/

go doc
go doc ./dir
go doc ./dir.FuncName
godoc -http=:6060
</code></pre>

<p><a href="./src/Makefile">Makefile Example</a></p>

<p><code>goimports</code> formats code + manages insertion and removal of import<br />
declarations as needed.</p>

<h2 id="import">import</h2>

<pre><code class="language-go">import &quot;github.com/oleglegun/repo&quot;  // path relative to GOPATH (accessible only in current file)
import _ from &quot;github.com/...&quot;      // import package for its side effects

func main() {
    repo.Method()  // Capitalized method == exported
}
</code></pre>

<p>In Go only <strong>Capitalized</strong> <code>var</code>/<code>const</code>/<code>func</code> are exported (accessible<br />
throughout the whole package (often folder)).</p>

<h2 id="scope">Scope</h2>

<ul>
<li><code>syntactic block</code> - sequence of statements enclosed in braces<br /></li>
<li><code>lexical block</code> - block that is not explicitly surrounded by braces<br />
<br /></li>
</ul>

<p>Scopes in Go:</p>

<ul>
<li>universe block (entire source code, lexical block)<br /></li>
<li>package level block<br /></li>
<li>file level block<br /></li>
<li><code>for</code>, <code>if</code>, <code>switch</code> blocks<br /></li>
<li>blocks for each <code>case</code> in <code>switch</code>/<code>select</code><br /></li>
<li>each explicit syntactic block<br />
<br /></li>
</ul>

<blockquote>
<p>In Go, <strong>package</strong> is a unit of encapsulation, not a type.</p>
</blockquote>

<h2 id="constants">Constants</h2>

<p>Only <strong>numbers</strong>, <strong>strings</strong>/<strong>characters</strong> and <strong>booleans</strong> can be<br />
constants. Expression that defines constant must be constant, because it<br />
evaluates at <strong>compile time</strong>. Can be used to set a fixed array size.</p>

<pre><code class="language-go">const i int64 = 10
const name = &quot;Oleg&quot;

const (
    flag1 = true
    flag2 = false
)

const x := math.Sin(0) // Wrong, Sin() needs to happen at run time
</code></pre>

<h4 id="iota-generator-auto-increment"><code>iota</code> - generator (auto-increment)</h4>

<p>Excellent for enum.</p>

<p><code>iota</code> resets in each block <code>()</code>.</p>

<pre><code class="language-go">const (
    one =  iota + 1 // 1
    two             // 2
    _               // skip 3
    four            // 4
)

const (
    _ = iota * 2    // 0
    i2              // 2
    i4              // 4
    _               // skip 6
    i16 = iota * 4  // 16 - redefine
    i32             // 20
)
</code></pre>

<p>Used for checking flags w/ mask.</p>

<pre><code class="language-go">// Masks
const (
    flagUserIsActive = 1 &lt;&lt; iota
    flagUserIsLogged
    flagUserIsSubscribed
)

var userFlags = '\x11'

println(&quot;User is active&quot;, userFlags &amp; flagUserIsActive)
</code></pre>

<h2 id="variables">Variables</h2>

<h3 id="short-notation-assignment-for-new-variables">Short Notation assignment for new variables</h3>

<p>Use for working w/ functions: <code>age := getAge()</code> when we know the return<br />
type and that there won't be any problems w/ dynamic type assignment.<br />
<code>:=</code> can be used only within a function, not for package-level<br />
variables.</p>

<pre><code class="language-go">age := 25

res1, err := do()
res2, err := do() // in := assignment `err` can be reused even if it has been already declared
</code></pre>

<h3 id="multiple-assignment">Multiple Assignment</h3>

<p>Multiple assignment should be used only when it helps readability<br />
(initialization in <code>for</code> loop).</p>

<pre><code class="language-go">var i, j, k int = 1, 2, 3
var s1, s2 string = &quot;Hello&quot;, &quot;World&quot;

// 2nd variant - often used for global (package) variables
package main

var (
    i int = 1
    j     = 2
    s1    = &quot;Hello&quot;
)

// Tuple assignment (swap values)
// All of the right-hand side expressions are evaluated before any of the variables are updated
i, j = j, i
a[i], a[j] = a[j], a[i]
</code></pre>

<h3 id="default-values">Default values</h3>

<p>All variables in Go are initialized by default w/ <code>nil</code> values. We can<br />
define variable and instantly use it w/o value assignment. Go has<br />
default values for all variables (unlike <code>C</code>, where variable w/o value<br />
can point to memory addr w/ trash).</p>

<pre><code>int: 0
float: 0
string: &quot;&quot;
bool: false
*pointer : nil
</code></pre>

<h3 id="bitwise-operations-位运算符">Bitwise operations 位运算符</h3>

<p>运算符 描述<br />
%   取余<br />
&amp;   按位与<br />
¦   按位或<br />
^   按位异或<br />
&amp;^  按位清除（AND NOT）<br />
&amp;^  即是 AND NOT(x, y) = AND(x, NOT(Y))，如：<br />
^   作为二元运算符：按位异或 (XOR)<br />
^   作为一元运算符: 按位取反 (~)</p>

<pre><code class="language-go">procedure swap(var a,b:longint);
begin
   a:=a xor b;
   b:=a xor b;
   a:=a xor b;
end;
</code></pre>

<pre><code class="language-go">package main
import &quot;fmt&quot;
func main() {
	x := 0xDC	         // 11011100
	y := 0xF0	         // 11110000
    z := x &amp; ^y	         // 00001100	// y 中为 1 的位全部被清除为 0
    m := x^y
    n := ^y              //
	fmt.Printf(&quot;%08b&quot;, z)
	fmt.Printf(&quot;%08b&quot;, m)
	fmt.Printf(&quot;%08b&quot;, n)
}

 var x uint8 = 1&lt;&lt;1 | 1&lt;&lt;5
 var y uint8 = 1&lt;&lt;1 | 1&lt;&lt;2

 fmt.Printf(&quot;%08b\n&quot;, x)    // &quot;00100010&quot;, the set {1, 5}
 fmt.Printf(&quot;%08b\n&quot;, y)    // &quot;00000110&quot;, the set {1, 2}
 fmt.Printf(&quot;%08b\n&quot;, x&amp;y)  // &quot;00000010&quot;, the intersection {1}
 fmt.Printf(&quot;%08b\n&quot;, x|y)  // &quot;00100110&quot;, the union {1, 2, 5}
 fmt.Printf(&quot;%08b\n&quot;, x^y)  // &quot;00100100&quot;, XOR the symmetric difference {2, 5}
 fmt.Printf(&quot;%08b\n&quot;, ^x)   // &quot;11011101&quot;, each bit is inverted
 fmt.Printf(&quot;%08b\n&quot;, x&amp;^y) // &quot;00100000&quot;, AND NOT the difference {5}

 for i := uint(0); i &lt; 8; i++ {
     if x&amp;(1&lt;&lt;i) != 0 {     // membership test
         fmt.Println(i)     // &quot;1&quot;, &quot;5&quot;
} }
 fmt.Printf(&quot;%08b\n&quot;, x&lt;&lt;1) // &quot;01000100&quot;, the set {2, 6}
 fmt.Printf(&quot;%08b\n&quot;, x&gt;&gt;1) // &quot;00010001&quot;, the set {0, 4}
</code></pre>

<blockquote>
<p><code>^x</code> - bitwise negation or complement (unary operation)</p>
</blockquote>

<h2 id="types">Types</h2>

<ul>
<li>Basic types: <code>int</code>, <code>float</code>, <code>string</code>, <code>bool</code><br /></li>
<li>Aggregate types: <code>array</code>, <code>struct</code><br /></li>
<li>Reference types (indirect refer): <code>slice</code>, <code>map</code>, <code>pointer</code>,<br />
<code>function</code>, <code>channel</code><br /></li>
<li>Interface types<br />
<br /></li>
</ul>

<p><code>Struct</code>, <code>array</code> and <code>interface</code> may contain reference types.</p>

<h2 id="basic-data-types">Basic Data Types</h2>

<h3 id="int-float-bool"><code>int</code>, <code>float</code>, <code>bool</code></h3>

<pre><code class="language-go">// INT
var i int = 10                // 32/64bit int, depends on platform
var autoInt = -10             // Auto assign type (int)
var bitInt int64 = 1&lt;&lt;32 - 1  // int8, int16, int32, int64
var uInt uint = 100           // unsigned 32/64bit int, depends on platform
var uBigInt uint64 = 1&lt;&lt;64 -1 // uint8, uint16, uint32, uint64

// FLOAT
var pi float64 = 3.14         // float32, float64 (precision)

// BOOL
var b = true                  // boolean
</code></pre>

<blockquote>
<p>Use <strong>unsigned integer</strong> only when it is absolutely necessary<br />
(hashing, cryptography, bit sets, parsing binary file format...</p>
</blockquote>

<p><code>float64</code> is preferable for most purposes because <code>float32</code> computations<br />
accumulate error rapidly.</p>

<h4 id="short-circuit-behavior">Short-circuit behavior</h4>

<pre><code class="language-go">s != &quot;&quot; &amp;&amp; s[0] == 'x' // if left is false =&gt; right will not be evaluated
</code></pre>

<h3 id="string"><code>string</code></h3>

<p>All strings are in UTF-8.</p>

<p>String values are <strong>immutable</strong>.</p>

<blockquote>
<p>Immutability means that it is safe for two copies of a string to share<br />
the same underlying memory, making it cheap to copy strings of any<br />
length. Similarly, a string <code>s</code> and a substring like <code>s[7:]</code> may<br />
safely share the same data, so the substring operation is also cheap.<br />
No new memory is allocated in either case.</p>
</blockquote>

<pre><code class="language-go">var str1 string = &quot;Hello\n\t&quot; // double quotes for string literal
var str3 = `Hello
            there`            // Raw string literal (invisible symbols \t,\n)

// BINARY/'SYMBOL'
var binary byte = '\x28'      // single quotes for symbols
</code></pre>

<p><strong>Raw string literals</strong> are useful for RegExp, which tend to have lots<br />
of backslashes.</p>

<pre><code class="language-go">var str1 = &quot;Hello&quot;
var str2 = &quot;, world!&quot;
str := []string{str1, str2}

// Length
println(len(str1))                    // 5 - number of bytes
println(urf8.RuneCountInString(str1)) // 5 - number of runes


// Concatenation

// 1. `+` - Use only on small number of short strings: too many allocations
str3 := str1 + str2

// 2. strings.Join() - Use for large slices of strings
strings.Join(str, &quot;&quot;)

// 3. bytes.Buffer - most efficient
var buffer bytes.Buffer
for _, str := range str {
    buffer.WriteString(str)
}
fmt.Println(buffer.String())


if str1 == str2 {} // Equality
if str1 &gt; str2 {}  // Compare
</code></pre>

<h2 id="unicode">Unicode</h2>

<p>Unicode is embedded in Go.</p>

<table>
<thead>
<tr>
<th align="left">1st Byte</th>
<th align="left">2nd Byte</th>
<th align="left">3rd Byte</th>
<th align="left">4th Byte</th>
<th align="left">Free Bits</th>
<th align="left">Maximum Unicode Value</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>0xxxxxxx</code></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">7</td>
<td align="left">007F hex (127)</td>
</tr>

<tr>
<td align="left"><code>110xxxxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(5+6)=11</td>
<td align="left">07FF hex (2047)</td>
</tr>

<tr>
<td align="left"><code>1110xxxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left"></td>
<td align="left">(4+6+6)=16</td>
<td align="left">FFFF hex (65535)</td>
</tr>

<tr>
<td align="left"><code>11110xxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left"><code>10xxxxxx</code></td>
<td align="left">(3+6+6+6)=21</td>
<td align="left">10FFFF hex (1,114,111)</td>
</tr>
</tbody>
</table>

<p><code>rune</code> (Unicode code point) - is an alias for <code>int32</code> and is equivalent<br />
to <code>int32</code> in all ways. It is used, by convention, to distinguish<br />
character values from integer values.</p>

<pre><code class="language-go">var symbol rune = 's'
unicodeSymbol := ''
unicodeSymbolFromCodePoint := '\u2222'
</code></pre>

<p>A rune whose value &lt; 256 may be written with a single hexadecimal escape<br />
<code>\x40</code>, but for higher values, a <code>\u</code> or <code>\U</code> escape must be used.</p>

<h3 id="iterate-on-symbols">Iterate on symbols</h3>

<pre><code class="language-go">strRu := &quot;Привет&quot;
for index, rune := range strRu {  // range loop performs UTF-8 decoding implicitly
    fmt.Printf(&quot;%#U %d&quot;, rune, index)
    println()
}

/*
U+041F 'П' 0
U+0440 'р' 2
U+0438 'и' 4
U+0432 'в' 6
U+0435 'е' 8
U+0442 'т' 10
*/
</code></pre>

<blockquote>
<p>For unexpected input byte <code>DecodeRuneInString</code> or <code>range</code> loop<br />
generate special Unicode <strong>replacement character</strong> <code>\uFFFD</code> &lt;?&gt;.</p>
</blockquote>

<h3 id="iterate-on-bytes">Iterate on bytes</h3>

<pre><code class="language-go">str := &quot;Привет&quot;
slice := []byte(str)  // convert String to Byte array

for index, value := range slice {
    fmt.Println(index, value)
}
</code></pre>

<h2 id="composite-types">Composite Types</h2>

<h3 id="array">Array</h3>

<p>Is a low-level data type. Size is part of array type =&gt; can't change its<br />
size. The types <code>[10]int</code> and <code>[20]int</code> are distinct.</p>

<p>Array is a value type. Assigning one array to another <strong>copies</strong> all the<br />
elements. Passing array to a function - creates copy of it. Using a<br />
pointer to an array is efficient and allows the called function to<br />
mutate the caller's variable.</p>

<pre><code class="language-go">var arr1 [4]int // [0 0 0 0] create array + allocate memory for its elements

const size uint = 2
var arr2 [size]bool // [false false]

arr3 := [...]int{1, 2, 3} // [1 2 3], len = auto (3)

// Edit value of an element
arr3[2] = 10 // [1 2 10]

// Multidimensional Array
var arr4 [2][2]int // [[0 0] [0 0]], len = 2
</code></pre>

<h3 id="slice">Slice</h3>

<p>Slice is an array w/ dynamic size. Slices hold references to an<br />
underlying array, and if you assign one slice to another, both refer to<br />
the <strong>same array</strong>.</p>

<p>Pointer points to the first element of the array that is reachable<br />
through the slice, which is not necessarily the array's first element.</p>

<p>Passing a slice to a function permits the function to modify the<br />
underlying array elements.</p>

<blockquote>
<p>Slices unlike arrays are not comparable, we can compare only <code>[]byte</code><br />
using <code>bytes.Equal()</code></p>
</blockquote>

<pre><code class="language-go">struct {
    length          // length ≤ capacity
    capacity        // doubles on each length overflow
    pointerToArray  // pointer to the first element of a underlying array (fix size)
}
</code></pre>

<pre><code class="language-go">// Create slice
var sl1 []int               // []
sl1 := []int{1, 2, 3}       // [1 2 3]
bsl := []byte{0x0, 0xFF}

// Memory efficient creation (we know the len/cap beforehand)
sl2 := make([]int, 5)       // [0 0 0 0 0] len = 5 cap = 5!!
sl3 := make([]int, 0, 10)   // [] len = 0 cap = 10

// Length
len(sl1)  // 3

// Capacity
cap(sl1)  // 4

// Slicing (shrink)
sl := []int{1, 2, 3, 4, 5}
sl[1:3]  // [2 3]
sl[1:]   // [2 3 4 5]
sl[:3]   // [1 2 3]

// Add element (grow)
sl1 = append(sl1, 100)
fmt.println(sl1)      // [1 2 3 100]

// Concat another slice
sl := append(sl1, sl1...) // ... - spread
fmt.Println(sl)           // [1 2 3 100 1 2 3 100]

// Copy slice
slCopy := make([]int, len(sl))  // new slice must have the same len
copy(slCopy, sl)

// Append slices
sl := append(sl1[:2], sl2[1:]...)

// Slice from Array
arr := [...]int{1, 2, 3}
sl := arr[:]     // sl: [1 2 3]
arr[1] = 10      // sl points to the same addr as arr
fmt.println(sl)  // [1 10 3]
</code></pre>

<h3 id="map">Map</h3>

<p>Map hold reference to an underlying data structure (created by <code>make</code>).<br />
When a map is passed to a function, it receives a copy of the reference<br />
=&gt; any changes will be visible through the caller's map reference too.</p>

<blockquote>
<p>Map does not guarantee key order.</p>
</blockquote>

<p>Keys of map can be of any comparable type. Value can be of any type at<br />
all.</p>

<blockquote>
<p>We can't take the address of a map element because growing a map might<br />
cause rehashing of existing elements into new storage locations,<br />
invalidating the address.</p>
</blockquote>

<pre><code class="language-go">var m map[string]string  // nil - points to nothing
//     |     |     |
//   type   key  value

// Nested Map
var mm map[string]map[string]string

// Initialize
var m map[string]string = map[string]string{}  // Empty Interface {}

// Initialize w/ `make`
var m = make(map[string]string)

// Short notation for Initialization
m := map[string]string{}

// Add element
m[&quot;firstName&quot;] = &quot;Oleg&quot;  // String literal as key
m[varName] = &quot;string&quot;    // Variable as key

// Read element
name = m[&quot;firstName&quot;]

// Read nonexistent element
name = m[&quot;lastName&quot;]     // &quot;&quot; - returns default zero value for a type

// Check if key exists
_, ok := m[&quot;lastName&quot;]         // only check for key existence
lastName, ok := m[&quot;lastName&quot;]  // returns value + ok - bool

// Delete element
delete(m, &quot;firstName&quot;)
</code></pre>

<blockquote>
<p><code>, ok</code> - &quot;comma ok&quot; idiom</p>
</blockquote>

<h2 id="control-flow">Control Flow</h2>

<h3 id="if"><code>if</code></h3>

<p>Checks strictly for <code>bool</code> value. Doesn't support implicit type<br />
conversion (<code>1 ≠ true</code>).</p>

<pre><code class="language-go">if flag {
    println(&quot;flag is true&quot;)
}

if a == 1 &amp;&amp; flag {
    println(&quot;success&quot;)
}


// Complex if using `;`
// firstName, ok are only accessible in 'if' scope

if firstName, ok := m[&quot;firstName&quot;]; ok {
//     |                             |
//  can be `_`                 bool to check
    println(&quot;Key exists&quot;)
} else {
    println(&quot;Key doesn't exist&quot;)
}
</code></pre>

<h3 id="for"><code>for</code></h3>

<pre><code class="language-go">// Infinite loop
for {
    println(&quot;Works like `while true {}`&quot;)
    break
}

// Conditional `for` == while
for i &lt; 5 {
    println(i)
    i++
}

// Conditional `for` w/ `if`
for i &lt; 10 {
    if i%2 == 0 {
        i++
        continue
    }
    println(i)
    i++
}


sl := []int{1, 3, 5}

// Standard `for`
for i := 0; i &lt; len(sl); i++ {
    println(&quot;Iteration&quot;)
}

// `for` w/ `range` for slice
for index, value := range sl {
    println(index, &quot;\b:&quot;, value)
}

// `for` w/ `range` for map
m := make(map[string]string)

m[&quot;firstName&quot;] = &quot;Oleg&quot;
m[&quot;lastName&quot;] = &quot;Legun&quot;

for key, value := range m {
    println(key, &quot;:&quot;, value)
}
</code></pre>

<h3 id="switch"><code>switch</code></h3>

<p>We don't fall through cases in Go - don't need <code>break</code>.</p>

<pre><code class="language-go">m := make(map[string]string)
m[&quot;firstName&quot;] = &quot;Oleg&quot;

switch m[&quot;firstName&quot;] {
case &quot;Oleg&quot;:
    println(&quot;Name is set to 'Oleg'&quot;)

case &quot;Igor&quot;:
    println(&quot;Name is set to 'Igor'&quot;)
    if true {
        break               // exit switch
    }
    println(&quot;Some text&quot;)

case &quot;&quot;:
    println(&quot;Name is empty&quot;)
    fallthrough             // fall to next case

default:
    println(&quot;Please, set a valid 'firstName'&quot;)
}
</code></pre>

<p>Check condition directly in <code>case</code>. Can substitute multiple <code>if-else</code>.</p>

<pre><code class="language-go">switch { // tagless switch
case m[&quot;firstName&quot;] == &quot;Oleg&quot;:
    println(&quot;First Name: Oleg&quot;)

case m[&quot;firstName&quot;] == &quot;&quot;:
    println(&quot;First Name is empty&quot;)
}
</code></pre>

<p>To break out from loop inside <code>switch</code>, we need to use <code>label</code>.</p>

<pre><code class="language-go">m := make(map[string]string)
m[&quot;firstName&quot;] = &quot;Oleg&quot;

Loop:
    for key, val := range m {
        switch {
        case key == &quot;firstName&quot; &amp;&amp; val == &quot;Oleg&quot;:
            println(&quot;Breaking...&quot;)
            break Loop
        }
        println(&quot;Won't be outputted&quot;)
    }
</code></pre>

<h2 id="function">Function</h2>

<p>Go has no concept of default parameter values.</p>

<blockquote>
<p>In Go (call-by-value language) the called function always receives<br />
only a copy of an argument, not a reference to the original argument.</p>
</blockquote>

<pre><code class="language-go">// Local function
func sum(a int,  b int) int {
    return a + b
}

// Sum is an exported function and must have a comment
func Sum(a int, b int) int {
    return a + b
}

// Short notation (same type)
func sum(a, b int) int {
    return a + b
}

// Any number of arguments of the same type
func sum(sl ...int) int { // sl - variadic parameter (== []int)
    var res int
    for i:= range sl {
        res += sl[i]
    }
    return res
}

// Named return variable =&gt; initialized w/ null value (ready to use)
func sum() (res int) {
    res = 1
    return
}

// Multiple return
func multiReturn() (int, error) {
    return 1, nil
}

// Multiple return w/ named variables
func multiReturn() (res int, err error) {
    res = 1
    err = fmt.Errorf(&quot;Error&quot;)
    return
}
</code></pre>

<blockquote>
<p>Getter method should be called <code>Property</code> (upper case, exported), not<br />
<code>GetProperty</code>. A setter function, if needed, will likely be called<br />
<code>SetProperty</code>.</p>
</blockquote>

<h3 id="anonymous-function">Anonymous Function</h3>

<p>Function in Go is <strong>first class citizen</strong>. We can save pointer to a<br />
function or pass it in the moment of creation.</p>

<pre><code class="language-go">f := func() func() {  // return func()
    return func() {
        println(&quot;success&quot;)
    }
}

pointer = f() // pointer to function
pointer()     // &quot;success&quot;
f()()         // &quot;success&quot;
</code></pre>

<h3 id="closure">Closure</h3>

<pre><code class="language-go">func main() {
    closure()()
}

func closure() func() {
    a := 1
    return func() { // has a in closure
        print(a)
    }
}
</code></pre>

<h3 id="recursive-functions">Recursive Functions</h3>

<p>Are good for processing data w/ recursive structure. Unefficient on<br />
memory, each new call expands stack. Good w/ last call optimization.</p>

<blockquote>
<p>Many programming language implementations use a fixed-size function<br />
call stack; sizes from 64KB to 2MB are typical. Fixed-size stacks<br />
impose a limit on the depth of recursion, so one must be careful to<br />
avoid a stack overflow when traversing large data structures<br />
recursively; fixed-size stacks may even pose a security risk. In<br />
contrast, typical Go implementations use variable-size stacks that<br />
start small and grow as needed up to a limit on the order of a<br />
gigabyte. This lets us use recursion safely and without worrying about<br />
overflow.</p>
</blockquote>

<h3 id="defer"><code>defer</code></h3>

<p>Block <code>defer</code> will be executed on exiting current function. The<br />
canonical examples are unlocking a mutex or closing a file/connection.</p>

<blockquote>
<p>Go's gc won't release unused <strong>OS resources</strong> like open files and<br />
network connections. They must be closed explicitly.</p>
</blockquote>

<p>The last defined <code>defer</code> will be executed first and so on (LIFO).</p>

<pre><code class="language-go">func main() {
    defer println(&quot;Done&quot;)
    println(&quot;Last command&quot;)
}

func ReadFile(f string) ([]byte, error) {
    file, err := os.OpenFile(...)
    if err != nil {
        return nil, err
    }
    defer file.Close()  // Now we can exit function any time

    return nil, nil
}
</code></pre>

<p>Right place for a defer statement that releases a resource is<br />
immediately after the resource has been <strong>successfully</strong> acquired.</p>

<blockquote>
<p>In <code>defer obj.method().close()</code> - <code>.method()</code> will be called right<br />
after <code>defer</code> definition! Only <code>.close()</code> will be deferred. Arguments<br />
to deferred functions are evaluated when the <code>defer</code> executes.</p>
</blockquote>

<h3 id="panic"><code>panic()</code></h3>

<p><code>panic()</code> - creates exception. We can catch it using <code>recover()</code>. Create<br />
and handle panic - expensive operations!</p>

<p>Use panic when some <em>impossible</em> situation happens.</p>

<pre><code class="language-go">func main() {
	createPanic()
	println(&quot;Continue working&quot;)
}

func createPanic() {
	defer func() {
		// Handle panic
		if r := recover(); r != nil {
			println(&quot;Error happened&quot;)
		}

		// Capture the stack trace
		buf := make([]byte, 10000)
		runtime.Stack(buf, false)
		println(&quot;Stack:&quot;, string(buf))
	}()

	panic(&quot;Error&quot;) // Will immediately exit current function
}
</code></pre>

<h3 id="init"><code>init()</code></h3>

<p>In every package function <code>init()</code> will be called at the start of<br />
execution, before <code>main()</code>.</p>

<p>Doesn't take any arguments or return any values.</p>

<pre><code class="language-go">package main

var user = os.Getenv(&quot;USER&quot;)
var a int

func init() {
    if user == &quot;&quot; {
        panic(&quot;no value for $USER&quot;)
    }
    a = 100  // Is set before main() executes
}

func main() {
    println(a)
}
</code></pre>

<p>It's used to initialize variables w/ needed values or to verify/repair<br />
the program state before real execution begins.</p>

<blockquote>
<p>All <code>init()</code> functions in all packages will be called simultaneously<br />
=&gt; order is unpredictable.</p>
</blockquote>

<h2 id="pointers">Pointers</h2>

<p>Variable - storage which contains value. Pointer allows access/update<br />
the value <strong>indirectly</strong>: w/o knowing the name of the variable.</p>

<pre><code class="language-go">a := 1
aPtr := &amp;a  // *int
*aPtr = 10

bPtr := new(int) // return pointer to int
*bPtr = 10
</code></pre>

<blockquote>
<p>Not every value has an address, but every variable does.</p>
</blockquote>

<p>Each component of a variable of aggregate type (field of a struct,<br />
element of an array) - is also a variable and thus han an address.</p>

<blockquote>
<p>It is safe for a function to return the address of a local variable.</p>
</blockquote>

<h2 id="new-vs-make"><code>new</code> vs. <code>make</code></h2>

<ul>
<li><code>new()</code> - allocates zeroed storage for any type <code>T</code> and returns<br />
pointer. <code>new(type)</code> is just <code>&amp;type{}</code>. Use <code>new</code> when there is no<br />
need of a dummy name.<br /></li>
<li><code>make()</code> - only for slices, maps and channels, returns an initialized<br />
(not zeroed) value of type <code>T</code> (not <code>*T</code>)<br />
<br />
<br /></li>
</ul>

<blockquote>
<p>Slice, map or channel represent references to data structures that<br />
<strong>must be initialized</strong> using <code>make</code> before use. Until these<br />
structures are initialized these types are <code>nil</code>. <code>new</code> only allocates<br />
storage!</p>
</blockquote>

<p>The <code>new</code> function is rarely used because the most common unnamed<br />
variables are of <code>struct</code> types, for which the struct literal syntax<br />
(<code>User{}</code>) is more flexible.</p>

<h2 id="heap-vs-stack">Heap vs. Stack</h2>

<p>A compiler may choose to allocate local variables on the heap or on the<br />
stack based on escape analysis. Each variable that escapes requires an<br />
extra memory allocation.</p>

<pre><code class="language-go">var global *int

func f() {
    var x int
    x = 1
    global = &amp;x // x escapes from f =&gt; stack allocation is not safe =&gt; allocate on heap
}
</code></pre>

<h2 id="named-basic-types">Named basic types</h2>

<p>The named type provides a way to separate different uses of the<br />
underlying type so that they can't be mixed unintentionally.</p>

<pre><code class="language-go">// Distinguishing the types makes it possible to avoid errors
// like combining temperatures in the two different scales.
type Celsius float64
type Fahrenheit float64

// Explicit conversion is required
tc := Celsius(-273.15)
tf := Fahrenheit(180)

// Error: mismatched types
temp := tf + tc
</code></pre>

<h2 id="struct-concrete-type">Struct (concrete type)</h2>

<p>Type is a pointer to a <code>struct</code>.</p>

<p>Struct is a value type and describes properties of an object.</p>

<blockquote>
<p>If variable is a large <code>struct</code> and performance is an issue, it's<br />
preferable to pass variable by pointer <code>*T</code>. So that to avoid<br />
expensive copying of the whole struct in memory.</p>
</blockquote>

<p>We can compare <code>struct</code>s (only for equality): they are equal if all<br />
their properties are equal.</p>

<blockquote>
<p>All fields in a <code>struct</code> are initialized w/ default <code>nil</code> values when<br />
using <code>T{}</code></p>
</blockquote>

<pre><code class="language-go">type Text string

type Person struct {
    Name    string
    age     int
}

// Initialize w/ default values
var article Text  //   &quot;&quot;
var p1 Person     //  {&quot;&quot;, 0}
p2 := Person{}    //  {&quot;&quot;, 0}
p3 := new(Person) // &amp;{&quot;&quot;, 0}

// Initialize w/ custom values using literal
article := Text(&quot;Simple Text&quot;)
p := Person{
    Name:   &quot;Oleg&quot;,  // Do not need to set all fields
    age:    26
}

// Short variant
p := Person{&quot;Oleg&quot;, 26}  // Need to specify all fields

// Get pointer to a struct's field
name := &amp;p.Name
*name = &quot;Jack&quot;
</code></pre>

<blockquote>
<p>Struct can't contain itself (recursion), but it can contain pointer to<br />
itself.</p>
</blockquote>

<pre><code class="language-go">type tree struct { // binary tree
    value       int
    left, right *tree
}
</code></pre>

<h3 id="type-methods">Type methods</h3>

<p>Any type like <code>string</code>, <code>struct</code>, <code>func</code>... can have its own methods. Go<br />
doesn't use <code>this</code> or <code>self</code>, it uses receiver name.</p>

<pre><code class="language-go">type MyType int

// Value method uses copy of a type
func (m MyType) getInfo() {  // get m by value (copy)
    fmt.Printf(&quot;%T %v&quot;, m, m)
}

// Pointer method uses address of a type
func (m *MyType) Increment() {  // get m by reference (can change value)
    *m = *m + 1                 // Need to dereference pointer
}
</code></pre>

<p><strong>Value methods</strong> can be invoked on <strong>pointers</strong> and <strong>values</strong>, but<br />
<strong>pointer methods</strong> can only be invoked on <strong>pointers</strong>. This rule<br />
arises because pointer methods can modify the receiver, invoking them on<br />
a value would cause the method to receive a copy of the value, so any<br />
modifications would be discarded.</p>

<pre><code class="language-go">// Person - simple type
type Person struct {
	name, surname   string
	age             int
}

// Method for type Person
func (p Person) getAge() int {
	return p.age
}

// Method for pointer to type Person
func (p *Person) setAge(age int) {
	p.age = age
}

func main() {
	oleg := Person{&quot;Oleg&quot;, &quot;Legun&quot;, 25}

	oleg.setAge(26)  // implicit &amp;oleg on variable
	Person{&quot;Jack&quot;, &quot;&quot;, 10}.setAge(20) // compile error: can't take address of Person literal
	println(oleg.getAge())
}
</code></pre>

<blockquote>
<p>If any method of a type <code>T</code> has a pointer receiver, you should avoid<br />
copying instances of <code>T</code> because doing so may violate internal<br />
invariants. For example, copying an instance of <code>bytes.Buffer</code> would<br />
cause the original and the copy to alias the same underlying array of<br />
bytes. Subsequent method calls would have unpredictable effects.</p>
</blockquote>

<h3 id="method-values-and-expressions">Method Values and Expressions</h3>

<pre><code class="language-go">type User struct{ name string }

func (u *User) SetName(n string) { u.name = n }
func (u User) PrintName()        { fmt.Println(u.name) }

func main() {
    u := User{}

    setName := u.SetName           // Method value
    setName(&quot;Jack&quot;)
    PrintNameExp := User.PrintName // Method expression
    PrintNameExp(u)                // first arg == instance of User, then any args for method
}
</code></pre>

<h2 id="interface-abstract-type">Interface (abstract type)</h2>

<p>Interface - describes behaviour = <strong>only</strong> methods that will be<br />
implemented by some type.</p>

<blockquote>
<p>One-method interfaces are named by the method name plus an <code>-er</code><br />
suffix: <code>Sender</code>, <code>Reader</code>, <code>Closer</code>...</p>
</blockquote>

<pre><code class="language-go">type Speaker interface {
	Speak()
}

type Person struct {
	Name string
}

func (p Person) Speak() {
	println(p.Name + &quot; is speaking...&quot;)
}

func SpeakTwice(s Speaker) { // Receives object w/ methods described in Speaker
	s.Speak()
	s.Speak()
}

func main() {
	oleg := Person{&quot;Oleg&quot;}
	oleg.Speak()
	SpeakTwice(oleg)
}
</code></pre>

<p>We can use Duck Typing in Go - if <code>type struct</code> implements all methods<br />
from <code>interface</code> - we can pass it like this <code>interface</code>.</p>

<p>Use <code>interface</code> only when it's absolutely needed.</p>

<h3 id="empty-interface-as-a-type">Empty interface as a type</h3>

<p><code>interface{}</code> - empty interface has no methods -&gt; any type conforms to<br />
it.</p>

<pre><code class="language-go">func Do(any interface{}) interface{} {
    // to use `any` we need to implement type assertion.
}
</code></pre>

<h3 id="interface-value">Interface Value</h3>

<p>Interface value has 2 components:</p>

<ul>
<li><strong>concrete type</strong> (dynamic type)<br /></li>
<li><strong>value of its type</strong> (dynamic value)<br />
<br /></li>
</ul>

<p>Zero value for an interface has both its type and value components set<br />
to <code>nil</code>.</p>

<pre><code class="language-go">var w io.Writer
/*  w
    type  =  nil
    value =  nil
*/
w.Write([]byte(&quot;text&quot;)) // panic: nil pointer dereference

w = os.Stdout
/*  w
    type  =  *os.File
    value =  *---------&gt; os.File(fd int = 1(stdout))
*/
// dynamic value holds a copy of os.Stdout, which is a pointer to the
// os.File variable representing the standard output of the process
w.Write([]byte(&quot;text&quot;)) // success
</code></pre>

<blockquote>
<p>We cannot know at compile time what the <strong>dynamic type</strong> of an<br />
<code>interface</code> value will be, so a call through an <code>interface</code> must use<br />
<strong>dynamic dispatch</strong>. Instead of a direct call, the compiler must<br />
generate code to obtain the address of the method named <code>Write</code> from<br />
the type descriptor, then make an indirect call to that address. The<br />
receiver argument for the call is a copy of the interface’s dynamic<br />
value, <code>os.Stdout</code>.</p>
</blockquote>

<h3 id="interface-with-nil-pointer">Interface with <code>nil</code> Pointer</h3>

<pre><code class="language-go">func main() {
    var buf *bytes.Buffer  // must be io.Writer
    f(buf)
}

func f(out io.Writer) {
    if out != nil {                // dynamic value = nil, type = *bytes.Buffer, thus is not nil!
        out.Write([]byte(&quot;text&quot;))  // panic: nil pointer dereference
    }
}
</code></pre>

<h3 id="embed">Embed</h3>

<p>Similar to inheritance.</p>

<p>By embedding a <code>struct</code> we get its properties + methods.</p>

<pre><code class="language-go">type Person struct {
	name string
	Age  int
}

type Student struct {
	Person     // indicate only type
	course int
	Age    int // shadow property from Person
}
</code></pre>

<blockquote>
<p>Only interfaces can be embedded within interfaces.</p>
</blockquote>

<h2 id="error">Error</h2>

<pre><code class="language-go">func Do() err {
    return errors.New(&quot;simple error&quot;)
}
</code></pre>

<p>Any obj that implements <code>error</code> interface can be returned as an error.</p>

<pre><code class="language-go">type error interface {
    Error() string
}
</code></pre>

<p>Thus we can create custom error types.</p>

<pre><code class="language-go">// Create a named type for our new error type
type myError string

// Implement the error interface
func (e myError) Error() string {
       return string(e)  // wrapper above string
}
</code></pre>

<blockquote>
<p>Message strings should not be capitalized and newlines should be<br />
avoided.</p>
</blockquote>

<p><a href="https://blog.golang.org/error-handling-and-go" target="_blank">Error Handling And Go</a></p>

<h2 id="type-assertion">Type Assertion</h2>

<p>having created an <code>interface{}</code> value containing a <strong>boolean</strong>,<br />
<strong>float</strong>, <strong>string</strong>, <strong>map</strong>, <strong>pointer</strong>, or any other type, we can<br />
do <strong>nothing</strong> directly to the value it holds since the interface has<br />
<strong>no methods</strong>. We need a way to get the value back out again.</p>

<pre><code class="language-go">func DoubleSpeak(s interface{}) { // Receives object w/ methods described in Speaker
    if p, ok := s.(Speaker); ok { // if s implements Speaker interface
        p.Speak()
        p.Speak()
    }
    if p, ok := s.(Person); ok {  // if s obj is of type Person
        println(p.Name)           // use property of p
    }
}
</code></pre>

<h2 id="switch-type-assertion">Switch Type Assertion</h2>

<p>Check type:</p>

<pre><code class="language-go">func showMeTheType(i interface{}) string {
   switch i.(type) {
   case int:
      return &quot;int&quot;
   case uint:
      return &quot;uint&quot;
   case int8:
      return &quot;int8&quot;
   case float64:
      return &quot;float64&quot;
   case string:
      return &quot;string&quot;
   case rune:
      return &quot;int32&quot;
   case []int:
      return &quot;[]int&quot;
   case map[string]bool:
      return &quot;map[string]bool&quot;
   default:
      return &quot;undefined&quot;
   }
}
</code></pre>

<p><code>err.(type)</code> works only in <code>switch</code>.</p>

<p>Check error type:</p>

<pre><code class="language-go">switch err := err.(type) {  // Check error type
    case nil:

    case *MyError:

    default:
}
</code></pre>

<h2 id="goroutines">Goroutines</h2>

<h3 id="overview">Overview</h3>

<p><code>Go routine</code> - &quot;simplified&quot; thread, independent code that executes<br />
asynchronously and has its own stack. To start go routine we need 2-4KB<br />
(depending on the architecture).</p>

<p>Process - in OS, have separate address space (independent). We need to<br />
use pipes or other OS mechanisms to coordinate processes.</p>

<p>Threads are within Process. Have common assets - can conflict (use<br />
mutex). To start thread we need 1MB for its data.</p>

<p>In Go we don't know what thread we are working on. All concurrency is<br />
managed by Go runtime.</p>

<p>Go runtime manages dispatching go routines on threads.</p>

<p>Go routines can lead to memory leaks, if not finished correctly.</p>

<blockquote>
<p>Concurrency — structuring a program as independently executing<br />
components and parallelism — executing calculations in parallel for<br />
efficiency on multiple CPUs.</p>
</blockquote>

<pre><code class="language-go">package main

import &quot;fmt&quot;

func main() {
   go test() // tells runtime to create &quot;subprocess&quot; w/ its own stack

   go print(5) // go routine w/ parameters

   go func() { // anonymous
      println(&quot;anonymous go routine&quot;)
   }()

   fmt.Scanln() // We need to wait go routine completion
}

func test() {
   println(&quot;routine&quot;)
}

func print(i int) {
   println(i)
}
</code></pre>

<h3 id="go-run-race"><code>go run -race</code></h3>

<p>Used to debug concurrent programs.</p>

<p>Go routines that operate on the same object can cause unexpected changes<br />
(they need to be synced). Check problems w/ <code>go run -race ...</code>. <code>-race</code><br />
arbitrary switches between goroutines in runtime.</p>

<pre><code>go run -race main.go
...
Found 5 data race(s)
exit status 66
</code></pre>

<p>Indicates that 5 simultaneous read/write operations happened w/o blocks.</p>

<h3 id="go-routine-closure"><code>go routine</code> &amp; closure</h3>

<pre><code class="language-go">for i := 0; i &lt; 5; i++ {
    go func() {
        println(i)  // will print '4' every time
    }()
}
</code></pre>

<p>When async <code>println(i)</code> is invoked - <code>for</code> loop has already finished =&gt;<br />
i == 4</p>

<p>We need to explicitly pass needed values to save them in closure:</p>

<pre><code class="language-go">for i := 0; i &lt; 5; i++ {
    go func(i int) {
        println(i)  // will print 1 2 3 4
    }(i)
}
</code></pre>

<h3 id="shadowing-variable">Shadowing variable</h3>

<p>It's legal and idiomatic in Go to do this. You get a fresh version of<br />
the variable with the same name, deliberately shadowing the loop<br />
variable locally but unique to each goroutine.</p>

<pre><code class="language-go">func Serve(queue chan *Request) {
    for req := range queue {
        req := req // Create new instance of req for the goroutine.
        sem &lt;- 1
        go func() {
            process(req)
            &lt;-sem
        }()
    }
}
</code></pre>

<h2 id="channel">Channel</h2>

<h3 id="overview-1">Overview</h3>

<p>Channels are pipes for concurrent go routines. We can read from/write to<br />
channel and it works in sync.</p>

<p>Channel is a reference type (pointer to a struct inside).</p>

<h3 id="buffered-unbuffered-channels">Buffered &amp; unbuffered channels</h3>

<p>Channel can be <strong>unbuffered</strong> or <strong>buffered</strong>.</p>

<p>Unbuffered channel works in synchronous mode - we can't write to<br />
channel, unless somebody is ready to read from it.</p>

<pre><code class="language-go">func main() {
   ch := make(chan string) // Create channel for strings

   go writeToChannel(ch) // Asynchronously write to channel

   fmt.Println(&lt;-ch, &quot;,&quot;, &lt;-ch) // Read 2 times from channel
}

func writeToChannel(ch chan&lt;- string) { // receive channel (implicitly indicate write-only channel)
   ch &lt;- fmt.Sprintf(&quot;Foo&quot;) // will pause until smb. is ready to read from ch
   ch &lt;- fmt.Sprintf(&quot;Bar&quot;)
   ch &lt;- fmt.Sprintf(&quot;Baz&quot;) // will not be printed, since we read only 2 times from ch
}
</code></pre>

<p>Channel direction (prevents errors in compile time - it's just an<br />
instruction for compiler checks):</p>

<ul>
<li><code>&lt;-chan</code> - read-only<br /></li>
<li><code>chan&lt;-</code> - write-only<br />
<br /></li>
</ul>

<p>To use buffered channel, we must implicitly indicate its size.</p>

<pre><code class="language-go">bufCh := make(chan int, 7) // Create buffered channel for ints
</code></pre>

<p>We can write to <code>bufCh</code> 7 times before our program execution blocks (in<br />
case nobody read from <code>bufCh</code>).</p>

<p>To close channel:</p>

<pre><code class="language-go">close(bufCh)

// Check if buffer is closed
data, ok := &lt;-bufCh // if opened: ok == true, if closed -&gt; false
</code></pre>

<p>We can't write to closed channel (<code>panic</code>), but can read from it (always<br />
returns <code>nil</code>)</p>

<h3 id="read-from-channel-w-range">Read from channel w/ <code>range</code></h3>

<pre><code class="language-go">func readFromChannel(ch &lt;-chan string) {
    for r := range ch {
        println(r)
    }
}
</code></pre>

<p>If chanel is closed - <code>range</code> will stop iterating.</p>

<h3 id="channel-generator">Channel generator</h3>

<pre><code class="language-go">func main() {
   channel := createChannel(&quot;Hello&quot;)

   for {
      fmt.Println(&lt;-channel)
   }
}

func createChannel(message string) &lt;-chan string {
   ch := make(chan string)

   go func() {
      for i := 0; ; i++ {  // Infinite loop
         ch &lt;- fmt.Sprintf(&quot;%d. %s&quot;, i, message)
         time.Sleep(time.Second)
      }
   }()

   return ch
}
</code></pre>

<p><code>time.After(interval)</code> - is a channel generator, that returns channel<br />
that receives bool values <code>true</code> each time interval passes.</p>

<h3 id="sync-go-routines-using-channels">Sync go routines using channels</h3>

<blockquote>
<p>We can use <code>chan struct{}</code> or <code>chan bool</code> to implement <code>done</code> channel.<br />
<code>struct{}</code> has zero size, but syntax is more cumbersome <code>ch &lt;-
struct{}{}</code> and space saving is marginal.</p>
</blockquote>

<pre><code class="language-go">func main() {
   done := make(chan bool, 1)
   go mustPrint(done)

   // Blocking receive
   &lt;-done // await, read from done, otherwise program will exit earlier
}

func mustPrint(done chan&lt;- bool) {
   for i := 0; i &lt; 10; i++ {
      println(i)
   }

   done &lt;- true // write to done on finish
}
</code></pre>

<h3 id="channel-multiplexer">Channel multiplexer</h3>

<p>Read several channels simultaneously. Order is not guaranteed, i.e.<br />
working w/ unsynced channels.</p>

<pre><code class="language-go">func main() {
   ch1, ch2 := generateNumbers()
   ch := readAll(ch1, ch2)

   for {
      fmt.Println(&lt;-ch)
      time.Sleep(time.Second)
   }
}

func generateNumbers() (&lt;-chan int, &lt;-chan int) {
   ch1, ch2 := make(chan int, 1), make(chan int, 1)

   go func() {
      for i := 0; i &lt; 10; i++ {
         ch1 &lt;- i
      }
   }()

   go func() {
      for i := 10; i &gt; 0; i-- {
         ch2 &lt;- i
      }
   }()

   return ch1, ch2
}

// readAll reads 2 channels simultaneously and writes result to the returned channel
func readAll(ch1, ch2 &lt;-chan int) &lt;-chan int {
   ch := make(chan int)

   go func() {
      for {
         ch &lt;- &lt;-ch1
      }
   }()

   go func() {
      for {
         ch &lt;- &lt;-ch2
      }
   }()

   return ch
}
</code></pre>

<h3 id="select"><code>Select</code></h3>

<p>Works like <code>switch</code> but for channels.</p>

<p>Checks all cases in order and checks for available data in channels. If<br />
any - case will be executed, if not - waits and passes control to other<br />
routines.</p>

<pre><code class="language-go">for {
   select {
   case msg := &lt;-ch1:
      println(msg)
   case msg := &lt;-ch2:
      println(msg)
   case &lt;-time.After(time.Second): // Guarantees non-blocking execution
      println(&quot;timeout&quot;)  // excellent for networking requests
   }
   runtime.Gosched()  // Runtime can pass control to other routine
}
</code></pre>

<p>If <code>select</code> doesn't have <code>default</code> case - program <strong>blocks</strong> execution<br />
and waits for input on any channel, otherwise it executes <code>default</code><br />
case.</p>

<pre><code class="language-go">select {
default:  // non-blocking channel operation
    println(&quot;default&quot;)
}
</code></pre>

<blockquote>
<p><code>default</code> case guarantees infinite loop - no code will be blocked if<br />
no channel is ready for read.</p>
</blockquote>

<p>Priority select: 1 channel is more important that another.</p>

<p>Go runtime can't take execution control from the subroutine in arbitrary<br />
moment (when it's rendering smth.), but <code>runtime.Gosched()</code> tells<br />
runtime that there will be waiting, and it can pass control to other<br />
routine during it. Useful in infinite loops!</p>

<p><code>select</code> can also act as a <code>channel multiplexer</code>:</p>

<pre><code class="language-go">func readAll(ch1, ch2 &lt;-chan int) &lt;-chan int {
    ch := make(chan int)

    go func() {
        for {
            select {
            case num := &lt;-ch1:
                ch &lt;- num
            case num := &lt;-ch2:
                ch &lt;- num
            }
        }
    }()
}
</code></pre>

<h2 id="packages">Packages</h2>

<h3 id="io"><code>io</code></h3>

<p>Working with byte streams.</p>

<h4 id="reader"><code>Reader</code></h4>

<pre><code class="language-go">type Reader interface {
    // Pass buffer p to reuse the same bytes (helps GC)
    // p is not guaranteed to be filled: 0 - len(p)
    // returns io.EOF on stream done (normal behavior)
    Read(p []byte) (n int, err error)
}
</code></pre>

<h4 id="readfull-readatleast"><code>ReadFull()</code>, <code>ReadAtLeast()</code></h4>

<pre><code class="language-go">// ReadFull ensures that buf is completely filled
// Returns io.EOF or io.ErrUnexpectedEOF on partial read
func ReadFull(r Reader, buf []byte) (n int, err error)
</code></pre>

<pre><code class="language-go">// ReadAtLeast reads at least min bytes
// We can minimize a number of Read() calls buffering additional data
func ReadAtLeast(r Reader, buf []byte, min int) (n int, err error)
</code></pre>

<h4 id="multireader"><code>MultiReader()</code></h4>

<pre><code class="language-go">// MultiReader combines n Readers into one concatenated reader
func MultiReader(readers ...Reader) Reader
</code></pre>

<pre><code class="language-go">r := io.MultiReader(
    bytes.NewReader([]byte(&quot;string&quot;)),
    file,
)
http.Post(&quot;http://...&quot;, &quot;application/octet-stream&quot;, r)
</code></pre>

<h4 id="teereader"><code>TeeReader()</code></h4>

<pre><code class="language-go">// TeeReader duplicates streams: returns new Reader, that wraps r
// Any reads from r will be written to w (ex. bytes.Buffer{}) for further inspection
func TeeReader(r Reader, w Writer) Reader
</code></pre>

<h4 id="limitreader"><code>LimitReader()</code></h4>

<pre><code class="language-go">// LimitReader wraps r and stops reading with EOF after n bytes or less
func LimitReader(r Reader, n int64) Reader
</code></pre>

<blockquote>
<p>Set <code>n = n + 1</code> to check if <code>r</code> has more than <code>n</code> bytes to read</p>
</blockquote>

<h4 id="writer"><code>Writer</code></h4>

<pre><code class="language-go">type Writer interface {
    Write(p []byte) (n int, err error)
}
</code></pre>

<h4 id="multiwriter"><code>MultiWriter()</code></h4>

<pre><code class="language-go">// MultiWriter duplicates writes to multiple streams (useful for logging)
func MultiWriter(writers ...Writer) Writer
</code></pre>

<h4 id="writestring"><code>WriteString()</code></h4>

<pre><code class="language-go">// WriteString uses optimized WriteString() method of w if available
// Optimization: converts string to a []byte w/o allocations
func WriteString(w Writer, s string) (n int, err error)
</code></pre>

<h4 id="copy-copyn-copybuffer"><code>Copy()</code>, <code>CopyN()</code>, <code>CopyBuffer()</code></h4>

<pre><code class="language-go">// Copy copies all bytes from Reader to Writer using 32KB buffer
func Copy(dst Writer, src Reader) (written int64, err error)
</code></pre>

<pre><code class="language-go">// CopyN copies N bytes from Reader to Writer
func CopyN(dst Writer, src Reader, n int64) (written int64, err error)
</code></pre>

<pre><code class="language-go">// CopyBuffer uses passed buf []byte w/o allocation its own 32KB buffer
func CopyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error)
</code></pre>

<h4 id="writerto-readerfrom"><code>WriterTo</code>, <code>ReaderFrom</code></h4>

<pre><code class="language-go">type WriterTo interface {
    // Directly write data to w w/o intermediate buffer (optimized)
    WriteTo(w Writer) (n int64, err error)
}

type ReaderFrom interface {
    ReadFrom(r Reader) (n int64, err error)
}
</code></pre>

<h4 id="pipe"><code>Pipe()</code></h4>

<pre><code class="language-go">// Pipe provides new Reader and Writer, any writes to Writer will go to Reader
// Useful if we have a method that only accepts a Reader, but we only have a Writer
func Pipe() (*PipeReader, *PipeWriter)
</code></pre>

<h4 id="closer"><code>Closer</code></h4>

<pre><code class="language-go">type Closer interface {
    Close() error
}
</code></pre>

<h4 id="seeker"><code>Seeker</code></h4>

<pre><code class="language-go">type Seeker interface {
    // Seek is useful for fixed length blocks in a file
    // whence can be io.SeekStart, io.SeekCurrent, io.SeekEnd
    Seek(offset int64, whence int) (int 64, error)
}
</code></pre>

<h4 id="bytereader-bytewriter-bytescanner"><code>ByteReader</code>, <code>ByteWriter</code>, <code>ByteScanner</code></h4>

<pre><code class="language-go">type ByteReader interface {
    // Read single byte
    ReadByte() (c byte, err error)
}

type ByteWriter interface {
    WriteByte(c byte) error
}

// For working with buffered byte readers
// that push the prev byte back for reading (peek next byte)
type ByteScanner interface {
    ByteReader
    UnreadByte() error
}
</code></pre>

<h4 id="runereader-runescanner"><code>RuneReader</code>, <code>RuneScanner</code></h4>

<pre><code class="language-go">type RuneReader interface {
    ReadRune() (r rune, size int, err error)
}

type RuneScanner interface {
    RuneReader
    UnreadRune() error
}
</code></pre>

<h3 id="bytes-strings"><code>bytes</code>, <code>strings</code></h3>

<p>Working with bounded, in-memory byte slices. The elements of a byte<br />
slice can be freely modified.</p>

<ul>
<li><code>[]byte</code> - mutable, resizable, contiguous list of bytes<br /></li>
<li><code>string</code> - immutable, fixed-size, contiguous list of bytes.<br />
<br /></li>
</ul>

<h4 id="newreader"><code>NewReader</code></h4>

<p>Create Reader that wraps an in-memory <code>[]byte</code> or <code>string</code>. It also<br />
implements <code>io</code> interfaces: <code>WriterTo</code>, <code>ByteReader</code>, <code>ByteScanner</code>,<br />
<code>RuneReader</code>, <code>RuneScanner</code>, <code>Seeker</code>.</p>

<pre><code class="language-go">func NewReader(b []byte) *Reader
</code></pre>

<pre><code class="language-go">func NewReader(s string) *Reader
</code></pre>

<pre><code class="language-go">// Effective on memory
r := strings.NewReader(&quot;oleg&quot;)  // Can be inside of io.MultiReader() if needed
http.Post(&quot;http://...&quot;, &quot;text/plain&quot;, r)
</code></pre>

<h4 id="buffer"><code>Buffer</code></h4>

<p>For buffer use <code>bufio</code> package.</p>

<pre><code class="language-go">// Buffer of bytes with many Read and Write methods.
// The zero value for Buffer is an empty buffer ready to use.
type Buffer struct { /* filtered */ }

// Useful Type Methods
buf.WriteString(s string) (n int, err error) {} // appends string to the end of the buffer
buf.Reset() // Empties buffer
</code></pre>

<pre><code class="language-go">var buf bytes.Buffer
myApp.Logger = log.New(&amp;buf, &quot;&quot;, log.LstdFlags)
myAPp.Start()

if !strings.Contains(buf.String(), &quot;app failed&quot;) {
        log.Fatal(&quot;Message&quot;)
}
</code></pre>

<pre><code class="language-go">func Equal(a, b []byte) bool {}     // check for equality byte slices, for strings use ==
func EqualFold(s, t string) bool {} // check for equality 2 string ignoring case

func Contains(b, subslice []byte) bool {}// 1+ subslice in b
func Contains(s, substr string) bool {}  // 1+ substr in s
func Count(b, subslice []byte) int {}    // Exact num of sublices in b
func Count(s, substr string) int {}      // Exact num of substr in s, if substr is &quot;&quot; -&gt; returns len+1 of chars

// Find position
func Index(s, sep []byte) int {}
func IndexAny(s []byte, chars string) int {}
func IndexByte(s []byte, c byte) int {}
func IndexFunc(s []byte, f func(r rune) bool {}) int {}
func IndexRune(s []byte, r rune) int {}

// Includes validation for blank slice (no panic)
func HasPrefix(s, prefix []byte) bool {}  // &quot;PrefixString&quot;
func HasPrefix(s, prefix string) bool {}
func HasSuffix(s, suffix []byte) bool {}  // &quot;StringSuffix&quot;
func HasSuffix(s, suffix string) bool {}

// Remove any runes defines in cutset from the beginning/end
func Trim(s []byte, cutset string) []byte {}
func Trim(s string, cutset string) string {}
func TrimLeft(s []byte, cutset string) []byte {}
func TrimRight(s []byte, cutset string) []byte {}
func TrimFunc(s []byte, f func(r rune) bool {}) []byte {}

// Remove prefix/suffix
func TrimPrefix(s, prefix []byte) []byte {}
func TrimPrefix(s, prefix string) string {}
func TrimSuffix(s, suffix []byte) []byte {}
func TrimSuffix(s, suffix string) string {}

// Remove space from the beginning/end
func TrimSpace(s []byte) []byte {}
func TrimSpace(s string) string {}

// Replace (for templates)
func Replace(s, old, new []byte, n int) []byte {}
func Replace(s, old, new string, n int) string {}

// Change case
func ToUpper(s []byte) []byte {}
func ToUpper(s string) string {}
func ToLower(s []byte) []byte {}
func ToLower(s string) string {}
func Title(s []byte) []byte {}
func Title(s string) string {} // &quot;hello world&quot; -&gt; &quot;Hello World&quot;

// Split slice using separator
func Split(s, sep []byte) [][]byte {}
func Split(s, sep string) []string {} // (&quot;1:2:3&quot;, &quot;:&quot;) -&gt; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]
func SplitN(s, sep []byte, n int) [][]byte {}
func SplitN(s, sep string, n int) []string {}
func SplitAfter(s, sep []byte) [][]byte {}
func SplitAfter(s, sep string) []string {}
func SplitAfterN(s, sep []byte, n int) [][]byte {}
func SplitAfterN(s, sep string, n int) []string {}
func Fields(s string) []string {}         // (&quot;hello    world&quot;) -&gt; [&quot;hello&quot;, &quot;world&quot;]

func Join(s [][]byte, sep []byte) []byte {}
func Join(a []string, sep string) string {}
func Repeat(s string, count int) string {}  // (&quot;-&quot;, 5) -&gt; &quot;-----&quot;
</code></pre>

<h3 id="bufio"><code>bufio</code></h3>

<pre><code class="language-go">// Scanner reads input and breaks it into lines/words.
// Best way to process input that comes in lines
type Scanner struct {}

input := bufio.NewScanner(os.Stdin)
input.Scan() // reads next line + removes `\n`; returns false
input.Text() // retrieve result from scan
</code></pre>

<h3 id="encoding"><code>encoding</code></h3>

<ul>
<li><code>Encoding</code>/<code>Decoding</code> applies a logical structure to a <strong>stream</strong> of<br />
bytes (<code>io.Reader</code>/<code>io.Writer</code>)<br /></li>
<li><code>Marshaling</code>/<code>Unmarshaling</code> applies a logical structure to bounded,<br />
<strong>in-memory</strong> bytes (<code>[]byte</code>)<br />
<br /></li>
</ul>

<p>Go structures are already represented in-memory as bytes. We can use<br />
them directly. <code>gob</code> (stream encoding) included the schema format when<br />
encoding, but is large. No cross language support.</p>

<pre><code class="language-go">type BinaryMarshaler interface {
    MarshalBinary() (data []byte, err error)
}
type BinaryUnmarshaler interface {
    UnmarshalBinary(data []byte) error
}

// Output in UTF-8 format
type TextMarshaler interface {
    MarshalText() (text []byte, err error)
}
type TextUnmarshaler interface {
    UnmarshalText(text []byte) error
}
</code></pre>

<h3 id="encoding-json"><code>encoding/json</code></h3>

<p>JSON encoding/decoding is slow. Encoder checks for a <code>MarshalJSON</code><br />
method of an type, then for <code>MarshalText</code>. If no one method is<br />
implemented - it will recursively build an encoder based on the<br />
primitive encoders (<code>intEncoder</code>, <code>stringEncoder</code>, <code>mapEncoder</code>,<br />
<code>structEncoder</code>, <code>sliceEncoder</code>).</p>

<pre><code class="language-go">type Marshaler interface {
    MarshalJSON() ([]byte, error)
}
type Unmarshaler interface {
    UnmarshalJSON([]byte) error
}
</code></pre>

<blockquote>
<p>Channel, complex types, functions cannot be encoded in JSON.</p>
</blockquote>

<h4 id="rawmessage"><code>RawMessage</code></h4>

<p><code>RawMessage</code> is a raw encoded JSON value. It implements <code>Marshaler</code> and<br />
<code>Unmarshaler</code> and can be used to delay JSON decoding or precompute a<br />
JSON encoding.</p>

<pre><code class="language-go">type T struct {
	Type  string          `json:&quot;type&quot;`
	Value json.RawMessage `json:&quot;value&quot;`
}

func (t *T) Val() (interface{}, error) {
    switch t.Type {
    case &quot;foo&quot;:
        // parse &quot;t.Value&quot; as Foo
    case &quot;bar&quot;:
        // parse &quot;t.Value&quot; as Bar
    default:
        return nil, errors.New(&quot;invalid type&quot;)
    }
}
</code></pre>

<h4 id="indent-setindent-compact"><code>Indent()</code>, <code>SetIndent()</code>, <code>Compact()</code></h4>

<p>Pretty print JSON.</p>

<pre><code class="language-go">func Indent(dst *bytes.Buffer, src []byte, prefix, indent string) error {}
func Compact(dst *bytes.Buffer, src []byte) error {}

// For using with Encoder
func (enc *Encoder) SetIndent(prefix, indent string) {}
</code></pre>

<p>JSON package has many error types, there’s not much we can do to handle<br />
them in code other than log an error and have a human operator<br />
intervene.</p>

<blockquote>
<p><code>ffjson</code> lib - faster JSON processing for Go</p>
</blockquote>

<h4 id="newencoder-newdecoder"><code>NewEncoder()</code>, <code>NewDecoder()</code></h4>

<p>Useful for efficient encoding/decoding with less heap allocations.</p>

<pre><code class="language-go">type Person struct {
    FirstName string `json:&quot;first_name&quot;`
    LastName  string `json:&quot;last_name&quot;`
}

func main() {
    person := Person{&quot;Oleg&quot;, &quot;Legun&quot;}

    // Marshal - save to []byte
    personEncoded, err := json.Marshal(person)
    if err != nil {
        log.Fatal(err)
    }

    personDecoded := Person{}

    // Unmarshal
    err = json.Unmarshal(personEncoded, &amp;personDecoded)
    if err != nil {
        log.Fatal(err)
    }

    fmt.Printf(&quot;Unmarshal: %+v\n&quot;, personDecoded)

    // Encoder - encode &amp; write strait to the Writer
    encoder := json.NewEncoder(os.Stdout)
    err = encoder.Encode(person)
    if err != nil {
        log.Fatal(err)
    }

    // Decoder - read &amp; decode strait from the Reader
    reader := bytes.NewReader(personEncoded)
    decoder := json.NewDecoder(reader)
    err = decoder.Decode(&amp;personDecoded)
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>

<h4 id="struct-field-attributes">Struct Field Attributes</h4>

<pre><code class="language-go">type Person struct {
    // Change the field name in JSON output
    FirstName  string `json:&quot;first_name&quot;`
    // Lowercase (unexported) properties are ignored by Marshal()
    lastName   string `json:&quot;last_name&quot;`
    // Omit this field in output
    Patronymic string `json&quot;-&quot;`
    // Omit this non-struct field if empty
    Age        int    `json:&quot;age, omitempty&quot;`
    // Convert field value to a quoted string (very important for 64-bit values
    // JS has problems with values above 53 bits start to lose integer precision
    Phone      int    `json:&quot;,string&quot;`
}
</code></pre>

<p><code>json.Encoder</code> uses <code>sync.Pool</code> to reuse internal buffer (minimize heap<br />
allocations).</p>

<h3 id="encoding-binary"><code>encoding/binary</code></h3>

<ul>
<li>In text protocol like JSON number 128 is represented with 1 + 2 + 8<br />
chars.<br /></li>
<li>In binary protocol 128 is represented with a single byte <code>0x80</code><br />
<br /></li>
</ul>

<h4 id="endianness">Endianness</h4>

<ul>
<li>Little-endian (CPU byte order = resizable) - <code>[less signif. byte][most
signif. byte] = 11 22 33 (00 00)</code><br /></li>
<li>Big endian (network byte order = sortable) - <code>[most signif. byte][less
signif. byte] = 33 22 11</code><br />
<br />
<br /></li>
</ul>

<pre><code class="language-go">v := uint32(65534)
buf := make([]byte, 4)

binary.BigEndian.PutUint32(buf, v)    // [00 00 ff fe]
binary.LittleEndian.PutUint32(buf, v) // [fe ff 00 00]
</code></pre>

<h4 id="variable-length-encoding">Variable-length encoding</h4>

<p>Small numbers take less space (trim empty zero bytes).</p>

<pre><code class="language-go">// Encode varint x to a []byte slice
func PutUvarint(buf []byte, x uint64) int {}
func PutVarint(buf []byte, x int64) int {}

// Decode varint from a []byte slice
func Uvarint(buf []byte) (uint64, int) {}
func Varint(buf []byte) (int64, int) {}

// Decode varint from a byte stream (one by one)
func ReadUvarint(r io.ByteReader) (uint64, error) {}
func ReadVarint(r io.ByteReader) (int64, error) {}
</code></pre>

<h3 id="strconv"><code>strconv</code></h3>

<p>Package for efficient conversions of primitive values (<code>bool</code>, <code>int</code>,<br />
<code>float</code>, <code>string</code>). <code>fmt</code> is slower.</p>

<h4 id="int"><code>int</code></h4>

<pre><code class="language-go">// Parse int from a string
// base: 2-36 (0 - auto); bitSize: 8-64 (0 - default system int size 32/64)
func ParseInt(s string, base int, bitSize int) (int64, error) {}
func ParseUint(s string, base int, bitSize int) (uint64, error) {}

func Atoi(s string) (int, error) {} // == ParseInt(s, 10 ,0)

// int -&gt; string (base: 2 - 36 [0-9 + a-z])
func FormatInt(i int64, base int) string {}  // new string is allocated on each call
func FormatUint(i uint64, base int) string {}

// int -&gt; string (less allocations, reusable buffer)
func AppendInt(dst []byte, i int64, base int) []byte {}
func AppendUint(dst []byte, i uint64, base int) []byte {}
</code></pre>

<h4 id="float"><code>float</code></h4>

<pre><code class="language-go">// Parse float from a string, bitSize: 32/64
func ParseFloat(s string, bitSize int) (float64, error) {}

// float -&gt; string
// prec: -1 - auto from bitSize (smallest num possible), bitSize: 32/64
func FormatFloat(f float64, fmt byte, prec, bitSize int) string {}
</code></pre>

<h4 id="boolean"><code>boolean</code></h4>

<pre><code class="language-go">// true:  &quot;1&quot; &quot;t&quot; &quot;T&quot; &quot;true&quot; &quot;True&quot; &quot;TRUE&quot;
// false: &quot;0&quot; &quot;f&quot; &quot;F&quot; &quot;false&quot; &quot;False&quot; &quot;FALSE&quot;
// error: others
func ParseBool(str string) (bool, error) {}

// bool -&gt; string; returns &quot;true&quot;/&quot;false&quot;
func FormatBool(b bool) string {}

// bool -&gt; string
// Appends &quot;true&quot;/&quot;false&quot; to the end of dst, returns extended buffer
func AppendBool(dst []byte, b bool) []byte {}
</code></pre>

<h4 id="string-1"><code>string</code></h4>

<pre><code class="language-go">// Quote (double quotes) string s, converting non-printable chars to `\t`, `\n`, `uXXXX`
// Useful for displaying error messages.
func Quote(s string) string {} // &quot;Hello   &quot; -&gt; &quot;\&quot;Hello\t\&quot;&quot;

// Converts all non ASCII chars (non-printable, emoji)
func QuoteToASCII(s string) string {}

// Less heap allocations when quoting strings
func AppendQuote(dst []byte, s string) []byte {}
func AppendQuoteToASCII(dst []byte, s string) []byte {}


// Quote individual rune (single quotes)
func QuoteRune(r rune) string {}
func QuoteRuneToASCII(r rune) string {}

// Less heap allocations when quoting runes
func AppendQuoteRune(dst []byte, r rune) []byte {}
func AppendQuoteRuneToASCII(dst []byte, r rune) []byte {}


// Unquote strings (parses &quot;&quot;, '' and `` strings)
func Unquote(s string) (string, error) {}
</code></pre>

<h3 id="fmt"><code>fmt</code></h3>

<pre><code>%v    default format
      bool:                    %t
      int, int8 etc.:          %d
      uint, uint8 etc.:        %d, %#x if printed with %#v
      float32, complex64, etc: %g
      string:                  %s
      chan:                    %p
      pointer:                 %p
%+v   add field names
%#v   valid Go syntax, can be pasted into the code right away
%T    print type (useful for the dynamic type of an interface value)
%d    int (base-10)
%x    int (base-16)
%f    float
       %5.2f   1.23 -&gt; &quot;  1.23&quot; (width = 5, precision = 2)
       %-5.2f  1.23 -&gt; &quot;1.23  &quot;
       %05.2f  1.23 -&gt; &quot;001.23&quot;

%q    quoted string (use-case: print with invisible chars)
%p    pointer (use-case: check if 2 pointer variables reference the same data)
</code></pre>

<pre><code class="language-go">// Print to os.Stdout
func Print(a ...interface{}) (n int, err error) {}
func Printf(format string, a ...interface{}) (n int, err error) {}
func Println(a ...interface{}) (n int, err error) {}

// Print to io.Writer, F stands for File
func Fprint(w io.Writer, a ...interface{}) (n int, err error) {}
func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error) {}
func Fprintln(w io.Writer, a ...interface{}) (n int, err error) {}

LogOutput := os.Stdout
fmt.FPrintln(LogOutput, &quot;Error&quot;)

// Print to string (slow! - use reusable bytes.Buffer with Fprint())
func Sprint(a ...interface{}) string {}
func Sprintf(format string, a ...interface{}) string {}
func Sprintln(a ...interface{}) string {}

// Just a wrapper for errors.New(Sprintf())
func Errorf(format string, a ...interface{}) error {}

// Use for custom types
type Stringer interface {
    String() string
}
</code></pre>

<blockquote>
<p>Do not use <code>Scan</code> functions - use CLI flags, env vars, API calls<br />
instead, config files.</p>
</blockquote>

<h3 id="http"><code>http</code></h3>

<h4 id="servemux"><code>ServeMux</code></h4>

<p>HTTP request multiplexer. Matches URLs of incoming requests against a<br />
list of registered patterns and calls the handler for the pattern that<br />
most closely matches the URL. A <code>ServeMux</code> aggregates a collection of<br />
<code>http.Handler</code>s into a single <code>http.Handler</code>. Doesn't support wildcards<br />
and RegExp.</p>

<p>Matching rules:</p>

<ul>
<li><code>/</code> matches all <strong>unmatched</strong> paths + root<br /></li>
<li><strong>long path</strong> has more priority over <strong>short path</strong> (<code>/src/img/</code> &gt;<br />
<code>/src/</code>)<br /></li>
<li><code>/src</code> will be redirected to <code>/src/</code> if handler for <code>/src/</code> is<br />
registered (override - register handler for <code>/src</code>)<br />
<br /></li>
</ul>

<blockquote>
<p>Several <code>ServeMux</code> may be composed to handle more intricate<br />
dispatching requirements.</p>
</blockquote>

<h4 id="handler-handlerfunc-handle-handlefunc"><code>Handler</code>, <code>HandlerFunc</code>, <code>Handle()</code>, <code>HandleFunc()</code></h4>

<pre><code class="language-go">// Any object that implement Handler can used as a router
type Handler interface {
    // Return from ServeHTTP == request is finished
    ServeHTTP(ResponseWriter, *Request)
}

// HandlerFunc is an Adapter to allow the use of functions as HTTP handlers
// its ServeHTTP() method calls underlying function
type HandlerFunc func(ResponseWriter, *Request)
</code></pre>

<p>To add handlers to a <code>ServeMux</code> use:</p>

<pre><code class="language-go">// DefaultServeMux

// Requires an object that implements Handler interface
func Handle(pattern string, handler Handler) {}


// HandleFunc registers a handler function for the given pattern
// ServeHTTP() method calls handler() passing (ResponseWriter, *Request)
func HandleFunc(pattern string, handler func(ResponseWriter, *Request)) {}
</code></pre>

<pre><code class="language-go">// Custom ServeMux
mux := http.NewServeMux()
mux.Handle(&quot;/&quot;, http.HandlerFunc(f))
mux.HandleFunc(&quot;/&quot;, f) // the same
log.Fatal(http.ListenAndServe(&quot;localhost:8080&quot;, mux)

func f(w http.ResponseWriter, r *http.Request) {/* ... */}
</code></pre>

<h4 id="listenandserve"><code>ListenAndServe()</code></h4>

<pre><code class="language-go">func ListenAndServe(addr string, handler Handler) error {}

// if handler == nil, use DefaultServeMux (instance of ServeMux)
http.ListenAndServe(&quot;:8080&quot;, nil)
</code></pre>

<h4 id="handlers">Handlers</h4>

<blockquote>
<p>Go web server invokes each handler in a new goroutine, so handlers<br />
must take precautions such as locking when accessing variables the<br />
other goroutines may be accessing.</p>
</blockquote>

<pre><code class="language-go">// FileServer returns Handler for serving static files
func FileServer(root FileSystem) Handler {}

http.Handle(&quot;/images&quot;, http.FileServer(http.Dir(&quot;./images&quot;)))


// NotFoundHandler returns Handler that replies to each request with a 404 error
func NotFoundHandler() Handler {}


// RedirectHandler returns Handler that redirects each request to url using status code
// Codes: http.StatusMovedPermanently, http.StatusFound, http.StatusSeeOther
func RedirectHandler(url string, code int) Handler {}


// StripPrefix returns Handler removes given prefix from a request and passes it to h
func StripPrefix(prefix string, h Handler) Handler {}

http.Handle(&quot;/files/&quot;, http.StripPrefix(&quot;/files/&quot;, http.FileServer(http.Dir(&quot;./&quot;))))


// TimeoutHandler returns Handler that runs h with the given time limit
// On timeout handler responds with a http.StatusServiceUnavailable and msg in body
func TimeoutHandler(h Handler, dt time.Duration, msg string) Handler {}
</code></pre>

<h4 id="chain-handlers-middleware">Chain Handlers (middleware)</h4>

<p>Useful for authentication.</p>

<pre><code class="language-go">type clientRequest struct {
    Data string `json:&quot;data&quot;`
}

type validationHandler struct {
    next http.Handler
}

func newValidationHandler(next http.Handler) http.Handler {
    return validationHandler{next: next}
}

func (v validationHandler) ServeHTTP(rw http.ResponseWriter, r *http.Request) {
    var request clientRequest

    decoder := json.NewDecoder(r.Body)
    err := decoder.Decode(&amp;request)
    if err != nil {
        http.Error(rw, &quot;Bad Request&quot;, http.StatusBadRequest)
        return // stop handler chaining on error
    }

    v.next.ServeHTTP(rw, r)
}

func main() {
    handler := newValidationHandler(http.NotFoundHandler())

    http.Handle(&quot;/&quot;, handler)
    http.ListenAndServe(&quot;:8080&quot;, nil)
}
</code></pre>

<h4 id="get-post"><code>Get()</code>/<code>Post()</code></h4>

<pre><code class="language-go">// Get follows the redirect, up to a maximum of 10 redirects.
func Get(url string) (resp *Response, err error)

resp, err := http.Get(url)
b, err := ioutil.ReadAll(resp.Body)
resp.Body.Close() // close to avoid resource leaking

// To set custom headers, use NewRequest and DefaultClient.Do.
func Post(url string, contentType string, body io.Reader) (resp *Response, err error)
</code></pre>

<h3 id="context"><code>context</code></h3>

<p>Useful for passing data from one handler to the next w/o breaking the<br />
<code>http.Handler</code> interface.</p>

<pre><code class="language-go">// Returns an empty context (used as a top-level context by the main function)
func Background() Context {}

// Returns a copy of the parent Context with a cancel function; cancel() releases
// resources associated with the context (call after all operations are complete)
func WithCancel(parent Context) (ctx Context, cancel CancelFunc) {}

// Returns a copy of the parent context that expires after the current time &gt; deadline
// CancelFunc - method for manual context cancellation
func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc) {}

// Similar to WithDeadline, except we pass it a duration for which Context should exist
func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) {}

// Returns a copy of the parent context in which {key: val} is set
func WithValue(parent Context, key interface{}, val interface{}) Context {}

Context.Value(key interface{}) interface{}
</code></pre>

<blockquote>
<p>For <strong>inbound requests</strong> <code>http.Server</code> automatically cancels context<br />
when the client connection closes. For outbound requests <code>Context()</code><br />
controls cancellation.</p>
</blockquote>

<pre><code class="language-go">// Inbound request

// Context often flows across packages, so we need to create package level type
// for use with context, otherwise collisions can happen with other keys (same name)
type validationContextKey string

func (h validationHandler) ServeHTTP(rw http.ResponseWriter, r *http.Request) {
    /* ... */
    // Set key in new context
    c := context.WithValue(r.Context(), validationContextKey(&quot;data&quot;), request.Data)
    // Apply new context
    r = r.WithContext(c)

    // Pass the request with new context down the chain
    h.next.ServeHTTP(rw, r)
}

// Inside &quot;next&quot; handler:
// Retrieve value from context using key + type assertion
data := r.Context().Value(validationContextKey(&quot;data&quot;)).(string)
</code></pre>

<pre><code class="language-go">// Outbound request

r, err := http.NewRequest(&quot;GET&quot;, &quot;http://site.com&quot;, nil)
if err != nil {
    log.Fatal(err)
}

// r.Context() - parent context
// timeoutRequest - new context with timeout
timeoutRequest, cancelFunc := context.WithTimeout(r.Context(), 1 * time.Millisecond)

// Cancel the Context() method of the outbound request == cancel the request itself!
defer cancelFunc()

// Apply new context to r (Request.WithContext(ctx context.Context) *Request)
r = r.WithContext(timeoutRequest)

_, err = http.DefaultClient.Do(r)
if err != nil {
    log.Fatal(err)
}
</code></pre>

<h3 id="net-rpc"><code>net/rpc</code></h3>

<p>RPC Handler's methods must be:</p>

<ul>
<li>the method's type is exported.<br /></li>
<li>the method is exported.<br /></li>
<li>the method has two arguments, both exported (or builtin) types.<br /></li>
<li>the method's second argument is a pointer.<br /></li>
<li>the method has return type error.<br />
<br /></li>
</ul>

<pre><code class="language-go">// Register (publish) methods of rcvr `Type.Method`
func Register(rcvr interface{}) error {}

// Register (publish) methods of rcvr with custom type name `CustomType.Method`
RegisterName(name string, rcvr interface{}) error {}
</code></pre>

<h4 id="rpc-over-tcp"><code>RPC over TCP</code></h4>

<pre><code class="language-go">// contract/entities.go
type RPCHandlerRequest struct {
    A, B int
}

type RPCHandlerResponse struct {
    Result int
}


// server.go
type RPCHandler struct{}

// We do not need to conform to an interface, all methods of RPCHandler will be registered (published) in RPC server
func (h *RPCHandler) PublicMethodSum(args *contract.RPCHandlerRequest, reply *contract.RPCHandlerResponse) error {
    reply.Result = args.A + args.B
    return nil
}

func main() {
    err := rpc.Register(&amp;RPCHandler{})
    FatalOnErr(err)

    // Create socket based on protocol binded with ip + port
    l, err := net.Listen(&quot;tcp&quot;, &quot;:8080&quot;)
    FatalOnErr(err)

    for {
        conn, err := l.Accept()
        FatalOnErr(err)

        print(&quot;New connection!&quot;)
        // ServeConn() is a blocking method =&gt; using goroutine
        // ServeConn uses gob binary format
        go rpc.ServeConn(conn)
    }
}


// client.go
func main() {
    c, err := rpc.Dial(&quot;tcp&quot;, &quot;:8080&quot;)
    if err != nil {
        log.Fatal(err)
    }
    args := contract.RPCHandlerRequest{2, 3}
    var reply RPCHandlerResponse
    err = c.Call(&quot;RPCHandler.PublicMethodSum&quot;, args, &amp;reply)
    FatalOnErr(err)

    fmt.Printf(&quot;%+v&quot;, reply)
}
</code></pre>

<blockquote>
<p>With <code>gobs</code> the source and destination values and types do not need to<br />
correspond exactly. Non-existing field will be ignored (w/o error).</p>
</blockquote>

<h4 id="rpc-over-http"><code>RPC over HTTP</code></h4>

<pre><code class="language-go">// Sets up 2 endpoints to use HTTP as a transport:
// DefaultRPCPath = &quot;/_goRPC_&quot;
// DefaultDebugPath = &quot;/debug/rpc&quot;
func HandleHTTP() {}
</code></pre>

<pre><code class="language-go">// server.go
err := rpc.Register(&amp;RPCHandler{})
FatalOnErr(err)
rpc.HandleHTTP()

l, err := net.Listen(&quot;tcp&quot;, &quot;:8080&quot;)
FatalOnErr(err)

http.Serve(l, nil)


// client.go
client, err := rpc.DialHTTP(&quot;tcp&quot;, &quot;:8080&quot;)

// sync function invocation
err = client.Call(&quot;RPCHandler.PublicMethodSum&quot;, args, &amp;reply)
// async function invocation
call := client.Go(&quot;RPCHandler.PublicMethodSum&quot;, args, reply, nil)
replyCall := &lt;-call.Done	// will be equal to call
</code></pre>

<blockquote>
<p>With RPC over HTTP we can take advantage of HTTP headers and other<br />
metadata</p>
</blockquote>

<h4 id="json-rpc-over-http"><code>JSON-RPC over HTTP</code></h4>

<p><code>net/rpc/jsonrpc</code> provides a build-in codec for<br />
serializing/deserializing to the JSON-RPC standard.</p>

<pre><code class="language-go">type ClientRequest struct {
    A, B int
}

type ServerResponse struct {
    Result int
}

type RPCHandler struct{}

func (h *RPCHandler) Sum(args *ClientRequest, reply *ServerResponse) error {
    reply.Result = args.A + args.B
    return nil
}

type HttpConn struct {
    in  io.Reader
    out io.Writer
}
// Methods to proxy calls to the reader and writer
func (c *HttpConn) Read(p []byte) (n int, err error)  { return c.in.Read(p) }
func (c *HttpConn) Write(d []byte) (n int, err error) { return c.out.Write(d) }
func (c *HttpConn) Close() error                      { return nil }

func main() {
    rpc.Register(new(RPCHandler))

    l, err := net.Listen(&quot;tcp&quot;, &quot;:8080&quot;)
    if err != nil {
        log.Fatal(err)
    }

    http.Serve(l, http.HandlerFunc(httpHandler))
}

func httpHandler(w http.ResponseWriter, r *http.Request) {
    // Pass a type ReadWriteCloser
    serverCodec := jsonrpc.NewServerCodec(&amp;HttpConn{in: r.Body, out: w})
    err := rpc.ServeRequest(serverCodec)
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>

<blockquote>
<p><code>curl -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;id&quot;: 1,
&quot;method&quot;: &quot;RPCHandler.Sum&quot;, &quot;params&quot;: [{&quot;A&quot;:1,&quot;B&quot;:2}]}'
http://localhost:8080</code></p>
</blockquote>

<h3 id="net-http-httputil"><code>net/http/httputil</code></h3>

<pre><code class="language-go">// DumpRequest dumps HTTP request in ith HTTP/1.x representation into []byte
func DumpRequest(req *http.Request, body bool) ([]byte, error) {}

/* Result:

POST /api/v3/... HTTP/1.1
Host: 10.1.1.2:3000
Accept-Encoding: gzip
Content-Length: 100
Content-Type: application/json

POST_REQUEST_BODY_HERE
*/
</code></pre>

<h3 id="html"><code>html</code></h3>

<pre><code class="language-go">// Parse returns the parse tree for the HTML from the given Reader
func Parse(r io.Reader) (*Node, error) {}
</code></pre>

<h3 id="sort"><code>sort</code></h3>

<pre><code class="language-go">// To sort any sequence we need to define a type that implements 3 methods
type Interface interface {
        Len() int
        Less(i, j int) bool // i, j - indices of sequence
        Swap(i, j int)
}

Sort(data Interface) {}

// Reverse - decorator, the returns Interface with inversed Less() method
ReverseSort(data Interface) Interface {}
</code></pre>

<pre><code class="language-go">// Makes an object sortable
type StringSlice []string
type IntSlice []int
type Float64Slice []float


func Strings(a []string) {} // Sorts a slice of strings in increasing order
</code></pre>

<pre><code class="language-go">type User struct {
    Name string
    Age  int
}

type byAge []*User

func (u byAge) Len() int           { return len(u) }
func (u byAge) Less(i, j int) bool { return u[i].Age &lt; u[j].Age }
func (u byAge) Swap(i, j int)      { u[i], u[j] = u[j], u[i] }

type byName []*User

func (u byName) Len() int           { return len(u) }
func (u byName) Less(i, j int) bool { return u[i].Name &lt; u[j].Name }
func (u byName) Swap(i, j int)      { u[i], u[j] = u[j], u[i] }


type customSort struct {
    u    []*User
    less func(x, y *User) bool
}

func (x customSort) Len() int           { return len(x.u) }
func (x customSort) Less(i, j int) bool { return x.less(x.u[i], x.u[j]) }
func (x customSort) Swap(i, j int)      { x.u[i], x.u[j] = x.u[j], x.u[i] }

func main() {
    users := []*User{{&quot;Jack&quot;, 20}, {&quot;Alice&quot;, 22}, {&quot;Bob&quot;, 10}, {&quot;Nick&quot;, 15}}

    sort.Sort(byAge(users))
    sort.Sort(sort.Reverse(byName(users)))
    sort.Sort(customSort{users, func(x, y *User) bool { return x.Name &lt; y.Name }})
}
</code></pre>

<blockquote>
<p>We use <code>type byAge []*user</code> instead of <code>type byAge []user</code> for faster<br />
sort (<code>sort</code> swaps pointers instead of values).</p>
</blockquote>

<h3 id="compress-gzip"><code>compress/gzip</code></h3>

<p>Use <code>https://github.com/NYTimes/gziphandler</code> for <code>gzip</code>.</p>

<h3 id="ioutil"><code>ioutil</code></h3>

<pre><code class="language-go">ioutil.Discard // io.Writer on which all Write calls succeed
</code></pre>

<h3 id="sync"><code>sync</code></h3>

<p>Low-level synchronization for go routines.</p>

<h4 id="sync-atomic"><code>sync/atomic</code></h4>

<p>Used for working w/ single number to guarantee atomic operations on it.</p>

<pre><code class="language-go">atomic.AddInt64(&amp;num, 5)
atomic.LoadInt64(&amp;num)
</code></pre>

<h4 id="waitgroup">WaitGroup</h4>

<p>Waits for goroutines to finish.</p>

<pre><code class="language-go">func main() {
   var wg sync.WaitGroup

   wg.Add(1) // Increases internal counter (+1 go routine)

   go worker(&amp;wg)

   wg.Wait() // Will block code execution here, unless counter is set to 0

   println(&quot;Done!&quot;)
}

func worker(wg *sync.WaitGroup) {
   wg.Done() // Decrement counter by 1
}
</code></pre>

<h4 id="mutex">Mutex</h4>

<p>Mutex - mutual exclusion lock. Can be created as a part of a struct.</p>

<pre><code class="language-go">type Account struct { // embed Mutex object to allow to use its Public methods on Account
   sync.Mutex
   balance int
}

func main() {

   a := Account{balance: 0}

   var wg sync.WaitGroup

   wg.Add(100)

   for i := 0; i &lt; 100; i++ {
      go worker(&amp;a, &amp;wg)
   }

   wg.Wait()

   println(a.balance)  // w/o mutex - balance can be 98, 99, 100 (data race happens)
}

func worker(account *Account, wg *sync.WaitGroup) {
   account.Lock()
   defer account.Unlock()  // convenient if method is long (but w/o defer - faster)

   account.balance += 1

   wg.Done()
}
</code></pre>

<h4 id="rwmutex">RWMutex</h4>

<p>Non-blocking read operations on resource.</p>

<p>Many can read data, while no one can edit it. While anyone edits data -<br />
no one can read it.</p>

<pre><code class="language-go">a.RLock()  // lock resource for read
a.RLock()  // lock resource for read - works
a.Lock()   // lock resource for edit - doesn't work
a.RUnlock()// release resource
a.Lock()   // lock resource for edit - works
</code></pre>

<h4 id="map-1">Map</h4>

<p>Concurrent map with constant-time load, save, delete operations. Doesn't<br />
require Mutex. Must not be copied - use pointer.</p>

<pre><code class="language-go">func main() {
    var m sync.Map
    
    for i := 0; i &lt; 3; i++ {
        go func(i int) {
            for j := 0; ; j++ {
                m.Store(i, j)
            }
        }(i)
    }
    
    for i := 0; i &lt; 10; i++ {
        m.Range(func(key, value interface{}) bool {
            fmt.Printf(&quot;%d: %d\t&quot;, key, value)
            return true
        })
        fmt.Println()
        time.Sleep(time.Second)
    }
}
</code></pre>

<h3 id="time"><code>time</code></h3>

<pre><code class="language-go">start := time.Now()
/* ... */
secs := time.Since(start).Seconds()
</code></pre>

<pre><code class="language-go">func WaitForServer(url string) error {
    const timeout = 1 * time.Minute
    deadline := time.Now().Add(timeout)
    for tries := 0; time.Now().Before(deadline); tries++ {
        _, err := http.Head(url)
        if err == nil {
            return nil // success
        }
        log.Printf(&quot;server not responding (%s); retrying...&quot;, err)
        time.Sleep(time.Second &lt;&lt; uint(tries)) // exponential back-off
    }
    return fmt.Errorf(&quot;server %s failed to respond after &amp;s&quot;, url, timeout)
}
</code></pre>

<h3 id="runtime"><code>runtime</code></h3>

<pre><code class="language-go">runtime.GOMAXPROCS(runtime.NumCPU()) // activate all CPU cores

runtime.Gosched()  // Allow runtime to pass control to other routine
</code></pre>

<p><code>Gosched()</code> is important in concurrent programs while working in big<br />
loops</p>

<h3 id="flag"><code>flag</code></h3>

<pre><code class="language-go">// Args returns the non-flag command-line arguments.
func Args() []string {}

Bool defines a bool flag with specified name, default value, and usage string.
func Bool(name string, value bool, usage string) *bool
</code></pre>

<pre><code class="language-go">// Bool creates new flag variable
var v = flag.Bool(&quot;v&quot;, false, &quot;enable verbose mode&quot;)
var sep = flag.String(&quot;s&quot;, &quot; &quot;, &quot;separator&quot;)

func main() {
    flag.Parse() // update the flag variables from their default values
    if *v {
        fmt.Println(&quot;verbose mode enabled&quot;)
    }
    fmt.Print(strings.Join(flag.Args(), *sep))
}
</code></pre>

<blockquote>
<p><code>flag.Duration()</code> creates a flag variable of type <code>time.Duration</code> and<br />
allows the user to specify the duration in a variety of user-friendly<br />
formats: <code>./cmd -flag 2m30s</code>.</p>
</blockquote>

<h3 id="os"><code>os</code></h3>

<pre><code class="language-go">os.Args // []string containing CL arguments starting from CMD name itself
os.Getwd // Working directory

// Open returns *File that is used in subsequent reads by the bufio.NewScanner(*os.File)
func Open(name string) (*File, error) {}

// RemoveAll removes path and any children it contains.
func RemoveAll(path string) error {}
</code></pre>

<p>Failure to check the result of the <code>close</code> operation could cause serious<br />
data loss to go unnoticed.</p>

<pre><code class="language-go">f, err := os.Create(&quot;file.txt&quot;)
if err != nil {
    return err
}

io.Copy(f, buf)

// Close file
err := f.Close()
if err != nil {
    return err
}
</code></pre>

<h2 id="network">Network</h2>

<h3 id="tcp-echo-server-async">TCP echo server (Async)</h3>

<pre><code class="language-go">func main() {
    listener, err := net.Listen(&quot;tcp&quot;, &quot;:3000&quot;) // Bind (connect + listen on OS Port)
    if err != nil {
      fmt.Println(&quot;Problem w/ creating server&quot;)
    }

    for {
      conn, err := listener.Accept()
      if err != nil {
         fmt.Println(&quot;Problem w/ connection&quot;)
         conn.Close()
         continue
      }

      fmt.Println(&quot;Connected&quot;)

      bufReader := bufio.NewReader(conn)

      go func() {
         defer conn.Close()

         for {
            // Reading from socket by bytes
            rbyte, err := bufReader.ReadByte()
            if err != nil {
               fmt.Println(&quot;Problem w/ reading from socket&quot;)
               break
            }

            fmt.Println(string(rbyte))
            conn.Write([]byte{rbyte})
         }
      }()
    }
}
</code></pre>

<h3 id="http-server">HTTP Server</h3>

<pre><code class="language-go">func main() {
    // Map request to a handler function
    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {
        path := r.URL.Path

        c := &amp;http.Client{} // create HTTP Client w/ default transport

        // Make request
        response, err := c.Get(&quot;http://setgetgo.com/get.php?Id=&quot; + path[1:])
        if err != nil {
            log.Println(err)
        }

        defer response.Body.Close() // Connection is opened =&gt; Close Body after read, otherwise leaks may appear

        body, _ := ioutil.ReadAll(response.Body) // Read until EOF, return []byte

        w.WriteHeader(http.StatusOK)
        w.Write(body)
    })

    http.ListenAndServe(&quot;:3000&quot;, nil)
}
</code></pre>

<blockquote>
<p>Server port can be set from <code>CLI</code> or from <code>env</code>.</p>
</blockquote>

<h3 id="json-api-server">JSON API Server</h3>

<pre><code class="language-go">type apiRequest struct {
    Name string `json:&quot;name&quot;`
}

type apiResponse struct {
    Greeting string `json:&quot;greeting&quot;`
}

func main() {
    http.HandleFunc(&quot;/json&quot;, jsonHandler)
    log.Fatal(http.ListenAndServe(&quot;:8080&quot;, nil))
}

func jsonHandler(w http.ResponseWriter, r *http.Request) {

    var request apiRequest

    decoder := json.NewDecoder(r.Body)
    err := decoder.Decode(&amp;request)
    if err != nil {
        log.Fatal(err)
    }

    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)

    encoder := json.NewEncoder(w)
    err = encoder.Encode(apiResponse{&quot;Hello &quot; + request.Name})
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>

<h2 id="templates">Templates</h2>

<h3 id="text-template"><code>text/template</code></h3>

<p><strong>Template</strong> - string or file containing one or more portions enclosed<br />
in double braces <code>{{...}}</code> called <strong>actions</strong>.</p>

<ul>
<li><code>.</code> - current value<br /></li>
<li><code>{{range .Items}}... {{end}}</code> - loop<br /></li>
<li><code>.Name | func</code> - pipe field as parameter to a function<br />
<br /></li>
</ul>

<p>Producing output with a template:</p>

<ol>
<li>Parse the template into internal representation (done only once)<br /></li>
<li>Execute it on specific inputs<br />
<br /></li>
</ol>

<pre><code class="language-go">package main

import (
    &quot;text/template&quot;
    &quot;time&quot;
    &quot;os&quot;
    &quot;log&quot;
)

const templ = `Car List ({{len . }}):
{{range .}}----------------------------------------
Model:		{{.Model | printf &quot;%.30s&quot;}}
Age:		{{.Year | countAge}} years
Condition: 	{{.Condition}}
Owner:		{{.Owner.Name}} ({{.Owner.Phone}})
{{end}}`

type Owner struct {
    Name  string
    Phone string
}

type Car struct {
    Model     string
    Year      int
    Condition string
    Owner     *Owner
}

func countAge(year int) int {
    return time.Now().Year() - year
}

// template.Must accepts a template and an error, checks that the error is nil and returns a template
var report = template.Must(template.New(&quot;carlist&quot;).
    Funcs(template.FuncMap{&quot;countAge&quot;: countAge}).
    Parse(templ))

func main() {
    cars := []Car{
        {&quot;Volvo&quot;, 2000, &quot;Used&quot;, &amp;Owner{&quot;Jack&quot;, &quot;0123456&quot;}},
        {&quot;Lexus&quot;, 2010, &quot;New&quot;, &amp;Owner{&quot;Helen&quot;, &quot;0123456&quot;}},
    }

    // cars will be `.` in template
    if err := report.Execute(os.Stdout, cars); err != nil {
        log.Fatal(err)
    }
}
</code></pre>

<pre><code>Car List (2):
----------------------------------------
Model:          Volvo
Age:            17 years
Condition:      Used
Owner:          Jack (0123456)
----------------------------------------
Model:          Lexus
Age:            7 years
Condition:      New
Owner:          Helen (0123456)
</code></pre>

<h3 id="html-template"><code>html/template</code></h3>

<p>Uses the same API as <code>text/template</code> but adds features for automatic<br />
escaping of strings for HTML, JS, CSS or URL.</p>

<h3 id="inline">Inline</h3>

<pre><code class="language-go">func main() {
    t1 := template.New(&quot;my-template&quot;) // Allocate new HTML template
    t1, _ = t1.Parse(`&lt;div&gt;{{.}}&lt;/div&gt;`)
    t1.Execute(os.Stdout, &quot;Inserted text&quot;)

    t2 := template.New(&quot;condition&quot;)
    t2, _ = t2.Parse(`{{if ne . &quot;Hello&quot;}}Not {{end}}Hello`)
    t2.Execute(os.Stdout, &quot;Hello&quot;)
}
</code></pre>

<h3 id="separate-file">Separate file</h3>

<p>Template in separate file <code>template.html</code>:</p>

<pre><code class="language-html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Shopping List&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;root&quot;&gt;
    {{if CheckAllInactive .}}
        &lt;div&gt;All items were bought.&lt;/div&gt;
    {{else}}
        &lt;div class=&quot;title&quot;&gt;Items to buy:&lt;/div&gt;
        {{range $index, $value := .}}
        &lt;div class=&quot;item&quot;&gt;
            &lt;div class=&quot;item-name&quot;&gt;{{.Name}}&lt;/div&gt;
            &lt;form action=&quot;/&quot; method=&quot;post&quot;&gt;
                &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;{{$index}}&quot;/&gt;
                &lt;input type=&quot;submit&quot; {{if eq .Active false}}disabled{{end}} value=&quot;Bought!&quot;/&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        {{end}}
    {{end}}
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<pre><code class="language-go">type Item struct {
    Name   string
    Active bool
}

func CheckAllInactive(items []Item) bool {
    for index := range items {
        if items[index].Active {
            return false
        }
    }
    return true
}

func main() {
    items := []Item{
        {&quot;Bread&quot;, true},
        {&quot;Eggs&quot;, true},
        {&quot;Milk&quot;, true},
        {&quot;Butter&quot;, true},
    }

    t1, err := template.New(&quot;template.html&quot;).Funcs(template.FuncMap{&quot;CheckAllInactive&quot;: CheckAllInactive}).ParseFiles(&quot;template.html&quot;)
    if err != nil {
        log.Fatal(&quot;Can't expand template&quot;, err)
        return
    }

    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {
        if r.Method == http.MethodPost {
            index, _ := strconv.ParseInt(r.FormValue(&quot;id&quot;), 10, 0) // urlencoded -&gt; string -&gt; int
            items[index].Active = false
        }

        err = t1.Execute(w, items)
        if err != nil {
            http.Error(w, err.Error(), http.StatusInternalServerError)
        }
    })

    http.ListenAndServe(&quot;:3000&quot;, nil)
}
</code></pre>

<h2 id="cookies">Cookies</h2>

<p><code>Set-Cookie: session_id=ow42234e88vhg0f83hfs93r32' Expires=Mon, 4 Mar
2018 12:00:00 GMT</code></p>

<pre><code class="language-go">func main() {

    sessions := make(map[string]string)

    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {
        sessionID, err := r.Cookie(&quot;session_id&quot;)
        if err == http.ErrNoCookie {
            w.Write([]byte(formTemplate))
            return
        } else if err != nil {
            log.Panic(err)
        }

        username, ok := sessions[sessionID.Value]
        if !ok {
            fmt.Fprint(w, &quot;Session not found.&quot;)
        } else {
            fmt.Fprintf(w, &quot;Welcome, &quot;+username)
        }

    })

    http.HandleFunc(&quot;/get-cookie&quot;, func(w http.ResponseWriter, r *http.Request) {

        if r.Method == http.MethodPost {

            r.ParseForm()

            login := r.Form[&quot;login&quot;][0]
            sessionId := strconv.Itoa(rand.Int())
            expiration := time.Now().Add(365 * 24 * time.Hour)
            cookie := http.Cookie{
                Name:    &quot;session_id&quot;,
                Value:   sessionId,
                Expires: expiration,
            }

            sessions[sessionId] = login

            http.SetCookie(w, &amp;cookie) // Cookie is set in headers, all content must be below
            http.Redirect(w, r, &quot;/&quot;, http.StatusFound)

        }
    })

    http.ListenAndServe(&quot;:3000&quot;, nil)
}
</code></pre>

<h2 id="database">DataBase</h2>

<h3 id="mysql">MySQL</h3>

<p>MySQL Driver: <code>import _ &quot;github.com/go-sql-driver/myslq&quot;</code></p>

<h4 id="connect">Connect</h4>

<pre><code class="language-go">// Create structure of the DB
// No connections to the DB here
// Can use `interpolateParams=true` to change PREPARE+EXECUTE =&gt; QUERY
db, err := sql.Open(&quot;mysql&quot;, &quot;root:password@tcp(localhost:3306)/testdb?charset=utf8&amp;interpolateParams=true&quot;)
if err != nil {
    panic(err)
}

db.SetMaxOpenConns(10) // Optional; 10 connections can easily process 8000+ fast QPS

// Connect to the DB
if err = db.Ping(); err != nil {
    panic(err)
}

fmt.Println(&quot;Open connections to the DB:&quot;, db.Stats().OpenConnections)
</code></pre>

<h4 id="query-for-select-many"><code>Query()</code> for <code>SELECT</code> many</h4>

<pre><code class="language-go">// Query() returns multiple results
// Requires closing connection to DB
rows, err := db.Query(&quot;SELECT name, info FROM users&quot;)

// Iterate over rows
for rows.Next() {
    var name string
    var info sql.NullString // Now we can differentiate NULL and &quot;&quot; value returned from DB

    if err := rows.Scan(&amp;name, &amp;info); err != nil { // Populates `name` and `info` variables
        panic(err)
    }

    if info.Valid {
        fmt.Println(&quot;User:&quot;, name, info.String)
    } else {
        fmt.Println(&quot;User:&quot;, name, &quot;No info&quot;) // `info` value is NULL
    }
}

rows.Close() // close connection, otherwise - leaks
</code></pre>

<h4 id="queryrow-for-select-one"><code>QueryRow()</code> for <code>SELECT</code> one</h4>

<pre><code class="language-go">// QueryRow() returns single result
// Auto closes connection to DB
row := db.QueryRow(&quot;SELECT name, info FROM users WHERE id=?&quot;, 1)

var name string
var info string
if err := row.Scan(&amp;name, &amp;info); err != nil {
    panic(err)
}

fmt.Println(&quot;User:&quot;, name, info)
</code></pre>

<h4 id="exec-for-insert-update"><code>Exec()</code> for <code>INSERT</code>/<code>UPDATE</code></h4>

<pre><code class="language-go">// Exec() executes query and returns num of changed rows
result, err := db.Exec(&quot;INSERT INTO users (name, info) VALUES (?, ?)&quot;, &quot;Oleg Legun&quot;, &quot;Some information&quot;)
if err != nil {
    panic(err)
}

affected, err := result.RowsAffected()
if err != nil {
    panic(err)
}

lastId, err := result.LastInsertId()
if err != nil {
    panic(err)
}

fmt.Println(&quot;Inserted values:&quot;, affected, &quot;Last ID:&quot;, lastId)
</code></pre>

<h4 id="prepared-statements-prepare-exec">Prepared statements: <code>Prepare()</code> + <code>Exec()</code></h4>

<pre><code class="language-go">// Prepared statements
// Send request to DB (PREPARE)
stmt, err := db.Prepare(&quot;UPDATE users SET info = ? WHERE id = ?&quot;)
if err != nil {
    panic(err)
}

// Now DB is waiting for values: info, id (EXECUTE)
result, err = stmt.Exec(&quot;Updated information&quot;, 5)
if err != nil {
    panic(err)
}

affected, err = result.RowsAffected()
if err != nil {
    panic(err)
}

fmt.Println(&quot;Updated values:&quot;, affected)
</code></pre>

<h3 id="postgresql">PostgreSQL</h3>

<p>Postgres driver <code>import _ &quot;github.com/lib/pq&quot;</code></p>

<h4 id="connect-1">Connect</h4>

<pre><code class="language-go">// Create structure of the DB
// No connections to the DB here
db, err := sql.Open(&quot;postgres&quot;, &quot;user=postgres password=password dbname=testdb sslmode=disable&quot;)
if err != nil {
    panic(err)
}

db.SetMaxOpenConns(10) // Optional; 10 connections can easily process 8000+ fast QPS

// Connect to the DB
if err = db.Ping(); err != nil {
    panic(err)
}

fmt.Println(&quot;Open connections to the DB:&quot;, db.Stats().OpenConnections)
</code></pre>

<h4 id="query-for-select-many-1"><code>Query()</code> for <code>SELECT</code> many</h4>

<pre><code class="language-go">// Query() returns multiple results
// Requires closing connection to DB
rows, err := db.Query(&quot;SELECT name, info FROM users&quot;)

// Iterate over rows
for rows.Next() {
    var name string
    var info sql.NullString // Now we can differentiate NULL and &quot;&quot; value returned from DB

    if err := rows.Scan(&amp;name, &amp;info); err != nil { // Populates `name` and `info` variables
        panic(err)
    }

    if info.Valid {
        fmt.Println(&quot;User:&quot;, name, info.String)
    } else {
        fmt.Println(&quot;User:&quot;, name, &quot;No info&quot;) // `info` value is NULL
    }
}

rows.Close() // close connection, otherwise - leaks
</code></pre>

<h4 id="queryrow-for-select-one-1"><code>QueryRow()</code> for <code>SELECT</code> one</h4>

<pre><code class="language-go">// QueryRow() returns single result
// Auto closes connection to DB
row := db.QueryRow(&quot;SELECT name, info FROM users WHERE id=$1&quot;, 1)

var name string
var info string
if err := row.Scan(&amp;name, &amp;info); err != nil {
    panic(err)
}

fmt.Println(&quot;User:&quot;, name, info)
</code></pre>

<h4 id="queryrow-for-insert-lastinsertid"><code>QueryRow()</code> for <code>INSERT</code> + <code>LastInsertId()</code></h4>

<pre><code class="language-go">// QueryRow() is used for INSERT queries, when we need to return lastId (pq doesn't support LastInsertId())
// Auto closes connection to DB
var lastId int64

err = db.QueryRow(
    &quot;INSERT INTO users (name, info) VALUES ($1, $2) RETURNING id&quot;,
    &quot;John&quot;,
    &quot;Some Information&quot;,
).Scan(&amp;lastId)

if err != nil {
    panic(err)
}

fmt.Println(&quot;Last insert Id:&quot;, lastId)
</code></pre>

<h4 id="exec-for-insert-update-1"><code>Exec()</code> for <code>INSERT</code>/<code>UPDATE</code></h4>

<pre><code class="language-go">// Exec() executes query and returns num of changed rows
result, err := db.Exec(
    &quot;UPDATE users SET name = $1, info = $2  WHERE id = $3&quot;,
    &quot;Oleg Legun&quot;,
    &quot;Updated information&quot;,
    4)
if err != nil {
    panic(err)
}

affected, err := result.RowsAffected()
if err != nil {
    panic(err)
}

fmt.Println(&quot;Updated values:&quot;, affected)
</code></pre>

<h4 id="prepared-statements-prepare-exec-1">Prepared statements: <code>Prepare()</code> + <code>Exec()</code></h4>

<pre><code class="language-go">// Prepared statements
// Send request to DB (PREPARE)
stmt, err := db.Prepare(&quot;UPDATE users SET info = $1 WHERE id = $2&quot;)
if err != nil {
    panic(err)
}

// Now DB is waiting for values: info, id (EXECUTE)
result, err = stmt.Exec(&quot;Updated information&quot;, 5)
if err != nil {
    panic(err)
}

affected, err = result.RowsAffected()
if err != nil {
    panic(err)
}

fmt.Println(&quot;Updated values:&quot;, affected)
</code></pre>

<h3 id="memcached">Memcached</h3>

<p>Very efficient noSQL DB.</p>

<p><code>import &quot;github.com/bradfitz/gomemcache/memcache&quot;</code></p>

<pre><code class="language-go">var (
    memcacheClient *memcache.Client // Make it global - useful for functions
)

func getRecord(mkey string) *memcache.Item {
    println(&quot;get&quot;, mkey)

    item, err := memcacheClient.Get(mkey)
    if err == memcache.ErrCacheMiss {
        fmt.Println(&quot;Record not found.&quot;)
        return nil
    } else if err != nil {
        panic(err)
    }

    return item
}

func main() {
    MemcachedAddresses := []string{&quot;127.0.0.1:11211&quot;}
    memcacheClient = memcache.New(MemcachedAddresses...)

    // Get record
    mkey := &quot;user_123&quot;

    item := getRecord(mkey)
    fmt.Printf(&quot;Item:%+v\n&quot;, item)

    // Add record
    ttl := 5 // Seconds
    //ttl := 86400 // very useful for User sessions 24H

    // Set() - add record anyway
    err := memcacheClient.Set(&amp;memcache.Item{
        Key:        mkey,
        Value:      []byte(&quot;Oleg&quot;),
        Expiration: int32(ttl),
    })

    if err != nil {
        panic(err)
    }

    // Add() - add record if not exist
    err = memcacheClient.Add(&amp;memcache.Item{
        Key:        &quot;counter&quot;,
        Value:      []byte(&quot;1&quot;),
        Expiration: int32(ttl),
    })

    if err == memcache.ErrNotStored {
        fmt.Println(&quot;Record not stored.&quot;) // Record was added before
    } else if err != nil {
        panic(err)
    }

    // Increment()
    newValue, err := memcacheClient.Increment(&quot;counter&quot;, 10)
    fmt.Println(newValue)
    newValue, err = memcacheClient.Decrement(&quot;counter&quot;, 5)
    fmt.Println(newValue)

    // GetMulti(): Get multiple records
    mkeys := []string{mkey, &quot;counter&quot;}
    items, err := memcacheClient.GetMulti(mkeys)
    if err != nil {
        panic(err)
    }
    fmt.Println(&quot;Map with multiple items:&quot;, items)
}

</code></pre>

<h3 id="redis">Redis</h3>

<p>Heroku recommends <code>import &quot;github.com/garyburd/redigo/redis&quot;</code></p>

<p><a href="https://redis.io/commands/incr" target="_blank">Rate limiter pattern</a></p>

<p>Cache methodology:</p>

<ol>
<li>Check for key in Redis<br /></li>
<li>If key does not exist<br />

<ul>
<li>Rebuild cache: Make SQL query and save result to Redis (ttl n sec)<br />
<br />
<br /></li>
</ul></li>
</ol>

<pre><code class="language-go">var (
    c redis.Conn
)

func getRecord(mkey string) string {
    fmt.Println(&quot;get&quot;, mkey)
    // Parse result (command reply) to a string
    item, err := redis.String(c.Do(&quot;GET&quot;, mkey))
    if err == redis.ErrNil {
        fmt.Println(&quot;Record not found (nil).&quot;)
        return &quot;&quot;
    } else if err != nil {
        panic(err)
    }

    return item
}

func main() {
    var err error

    // Connect
    c, err = redis.DialURL(&quot;redis://user:@localhost:6379/0&quot;)
    if err != nil {
        panic(err)
    }

    defer c.Close()

    // Get Record
    mkey := &quot;name&quot;

    item := getRecord(mkey)
    fmt.Println(&quot;Record:&quot;, item)

    // Add Record
    ttl := 60

    result, err := redis.String(c.Do(&quot;SET&quot;, &quot;counter&quot;, 1, &quot;EX&quot;, ttl))
    if err != nil {
        panic(err)
    }
    if result != &quot;OK&quot; {
        panic(&quot;result not OK: &quot; + result)
    }

    // Increment (INCR/INCRBY/DECRBY)
    // If counter key is not set - Redis will create it with value: 0
    counter, err := redis.Int(c.Do(&quot;INCR&quot;, &quot;counter&quot;))
    if err != nil {
        panic(err)
    }
    fmt.Println(&quot;Counter:&quot;, counter)

    // MGET - Get multiple records
    keys := []interface{}{mkey, &quot;counter&quot;, &quot;nonexisting&quot;}
    reply, err := redis.Strings(c.Do(&quot;MGET&quot;, keys...))
    if err != nil {
        panic(err)
    }
    fmt.Println(reply) // [Oleg Legun 1 nil]
}
</code></pre>

<h4 id="cache-invalidation">Cache Invalidation</h4>

<p>If cache is expired (key doesn't exist), and several processes are going<br />
to rebuild it, we need to use locks, otherwise - DB will be overloaded!</p>

<p>Set new record like <code>mkey+&quot;lock&quot;</code> while rebuilding cache.</p>

<pre><code class="language-go">// If key was not found, lock it and try to rebuild it
result, err := redis.String(c.Do(&quot;SET&quot;, mkey+&quot;_lock&quot;, name, &quot;PX&quot;, 50, &quot;NX&quot;))
if result != &quot;OK&quot; {
    fmt.Println(&quot;Other user is rebuilding it!&quot;)
}

// Rebuild cache

// Delete _lock if operation was quicker than expected
n, err := redis.Int(c.Do(&quot;DEL&quot;, mkey+&quot;lock&quot;))
</code></pre>

<h3 id="mongodb">MongoDB</h3>

<p>MongoDB driver: <code>import &quot;gopkg.in/mgo.v2&quot;</code></p>

<pre><code class="language-go">import (
    &quot;fmt&quot;
    &quot;gopkg.in/mgo.v2&quot;
    &quot;gopkg.in/mgo.v2/bson&quot;
)

// MongoDB can have objects with any structure inside.
// In Go we need to explicitly describe each structure to successfully deserialize it.
// json is used when we serialize to JSON, bson - to Binary JSON (MongoDB type)
// Any extra keys that are present in MongoDB, but not in the `user` struct will be omitted
type user struct {
    ID   bson.ObjectId `json:&quot;id&quot; bson:&quot;_id&quot;` // _id - primary key (_) in MongoDB
    Name string        `json:&quot;name&quot; bson:&quot;name&quot;`
    Info string        `json:&quot;info&quot; bson:&quot;info&quot;`
}

var (
    sess *mgo.Session
)

func main() {
    var err error
    sess, err = mgo.Dial(&quot;mongodb://localhost&quot;)
    if err != nil {
        panic(err)
    }

    // Collection is like a table in MySQL
    collection := sess.DB(&quot;testdb&quot;).C(&quot;users&quot;)

    // Create index
    index := mgo.Index{
        Key: []string{&quot;name&quot;},
    }

    // Save index
    err = collection.EnsureIndex(index)
    if err != nil {
        panic(err)
    }

    // Add document
    if n, _ := collection.Count(); n == 0 {
        firstUser := &amp;user{bson.NewObjectId(), &quot;Oleg&quot;, &quot;New information&quot;}
        err = collection.Insert(firstUser)
        if err != nil {
            panic(err)
        }
    }

    // Get values
    var allUsers []user
    // Find all documents in collection (bson.M{empty} == ALL) and save them to allUsers
    err = collection.Find(bson.M{}).All(&amp;allUsers)
    if err != nil {
        panic(err)
    }
    for i, v := range allUsers {
        fmt.Printf(&quot;user[%d]: %+v\n&quot;, i, v)
    }

    id := bson.NewObjectId()
    // bson.M{&quot;_id&quot;: id} - set find condition
    var notExistentUser user

    // Find() returns *Query, .One() will Unmarshall values to &amp;newUser
    err = collection.Find(bson.M{&quot;_id&quot;: id}).One(&amp;notExistentUser)
    if err != nil {
        //panic(err)
    }

    // Insert new document
    user1 := &amp;user{id, &quot;Jack&quot;, &quot;Incorrect Information&quot;}
    err = collection.Insert(user1)
    if err != nil {
        panic(err)
    }

    // Edit retrieved document
    user1.Info = &quot;Correct Information&quot;
    collection.Update(bson.M{&quot;_id&quot;: user1.ID}, &amp;user1)

    // Edit documents inside MongoDB
    collection.UpdateAll(
        bson.M{&quot;name&quot;: &quot;Jack&quot;}, // Filter condition WHERE (for all Jacks) or  bson.M{&quot;_id&quot;: id} - 1 document
        bson.M{
            &quot;$set&quot;: bson.M{&quot;info&quot;: &quot;Correct Information&quot;},
        },
    )
}
</code></pre>

<h3 id="orm">ORM</h3>

<p>Not as effective as the traditional SQL queries. Can be slow for<br />
high-loaded services.</p>

<p>ORM can generate suboptimal queries: we need 1 field, orm pulls all<br />
fields.</p>

<p>Complex queries with several <code>JOIN</code> - in ORM can be very slow or even<br />
not possible.</p>

<p>Values from SQL tables are automatically mapped to Go structures.</p>

<p>ORM is excellent for UPDATE'ing single user record (not for SELECT!).</p>

<pre><code class="language-go">import (
    &quot;fmt&quot;
    &quot;github.com/jinzhu/gorm&quot;
    _ &quot;github.com/jinzhu/gorm/dialects/mysql&quot;
)

var (
    db *gorm.DB
)

type User struct {
    ID   uint `sql:&quot;AUTO_INCREMENT&quot; gorm:&quot;primary_key&quot;`
    Name string
    Info string
}

func (u *User) TableName() string { // For GORM
    return &quot;users&quot;
}

func (u *User) BeforeSave() (err error) { // For GORM
    fmt.Println(&quot;Trigger on before save&quot;)
    return
}

func PrintByID(id uint) {
    u := User{}
    err := db.Find(&amp;u, id).Error // SELECT * FROM users WHERE id = ?
    if err == gorm.ErrRecordNotFound {
        fmt.Println(&quot;Record no found&quot;, id)
    } else if err != nil {
        panic(err)
    }
    fmt.Printf(&quot;PrintByID: %v, data: %+v\n&quot;, id, u)
}

func main() {
    var err error

    // Connect
    db, err = gorm.Open(&quot;mysql&quot;, &quot;root:password@tcp(localhost:20000)/testdb?charset=utf8&quot;)
    if err != nil {
        panic(err)
    }

    defer db.Close()

    db.DB() // ORM requires explicit connection to DB
    db.DB().Ping()

    PrintByID(1)
    PrintByID(100)

    // Select all records
    all := []User{} // SELECT * FROM users
    db.Find(&amp;all)
    for i, v := range all {
        fmt.Printf(&quot;User %d: %+v\n&quot;, i, v)
    }

    // Create new record
    newUser := User{
        Name: &quot;Jack&quot;,
        Info: &quot;Some information&quot;,
    }

    db.NewRecord(newUser) // =&gt; returns `true` as primary key is blank
    db.Create(&amp;newUser)

    PrintByID(newUser.ID)

    // Update record
    newUser.Info = &quot;New information&quot;
    db.Save(&amp;newUser)
    PrintByID(newUser.ID)

}
</code></pre>

<h2 id="tests">Tests</h2>

<p>Unit tests - most valuable tests.</p>

<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>go test</code></td>
<td align="left">execute <code>*_test.go</code> files</td>
</tr>

<tr>
<td align="left"><code>go test ./handlers</code></td>
<td align="left">Test package <code>handlers</code></td>
</tr>

<tr>
<td align="left"><code>go test -v</code></td>
<td align="left">verbose mode (prints <code>t.Log()</code>)</td>
</tr>

<tr>
<td align="left"><code>go test -run TestDivide</code></td>
<td align="left">execute only <code>*TestDivide*</code> test case (supports RegExp)</td>
</tr>

<tr>
<td align="left"><code>go test -cover</code></td>
<td align="left">Show coverage percentage</td>
</tr>

<tr>
<td align="left"><code>go test -coverprofile=coverage.out</code></td>
<td align="left">Export coverage report to <code>cover.out</code></td>
</tr>

<tr>
<td align="left"><code>go tool cover -func=coverage.out</code></td>
<td align="left">Coverage by functions based on <code>cover.out</code></td>
</tr>

<tr>
<td align="left"><code>go tool cover -html=coverage.out</code></td>
<td align="left">Open in Browser</td>
</tr>

<tr>
<td align="left"><code>go tool cover -html=coverage.out -o coverage.html</code></td>
<td align="left">Convert <code>.out</code> -&gt; <code>.html</code></td>
</tr>
</tbody>
</table>

<h3 id="simple">Simple</h3>

<pre><code class="language-go">package main

import &quot;github.com/pkg/errors&quot;

type User struct {
    Name    string
    Surname string
}

func Sum(a int, b int) int {
    return a + b
}

func AddUser(usersPtr *[]User, name string, surname string) {
    *usersPtr = append(*usersPtr, User{name, surname})
}

func Divide(a int, b int) (int, error) {
    if b == 0 {
        return 0, errors.New(&quot;Zero division error.&quot;)
    }
    return a / b, nil
}
</code></pre>

<pre><code class="language-go">package main

import (
    &quot;github.com/pkg/errors&quot;
    &quot;reflect&quot;
    &quot;testing&quot;
)

func TestSum(t *testing.T) {
    if Sum(1, 2) != 3 {
        // Errorf() generates an error and continues to execute current test case
        t.Errorf(&quot;Expected %d, got %d&quot;, 3, Sum(1, 2))
    }
}

func TestAddUser(t *testing.T) {
    users := []User{}

    AddUser(&amp;users, &quot;Oleg&quot;, &quot;Legun&quot;)

    if len(users) != 1 {
        // Fatalf() generates an error and returns from current function
        t.Fatalf(&quot;Expected len = %d, got %d&quot;, 1, len(users))
    }

    expected := []User{
        {
            Name:    &quot;Oleg&quot;,
            Surname: &quot;Legun&quot;,
        },
    }

    if !reflect.DeepEqual(users, expected) {
        t.Errorf(&quot;Expected %+v, got %+v&quot;, expected, users)
    }
}

// Table testing
func TestTable(t *testing.T) {
    t.Skip()
    testCases := []struct {
        A      int
        B      int
        Result int
        Err    error
    }{
        {10, 5, 2, nil},
        {-10, 2, -5, nil},
        {10, 0, 0, errors.New(&quot;Zero division error.&quot;)},
    }

    for _, testCase := range testCases {
        res, err := Divide(testCase.A, testCase.B)
        if res != testCase.Result {
            t.Errorf(&quot;Divide(%d, %d) =&gt; %d, want %d&quot;, testCase.A, testCase.B, res, testCase.Result)
        }

        if err != nil &amp;&amp; err.Error() != testCase.Err.Error() {
            t.Errorf(&quot;Divide(%d, %d) =&gt; Error: %v, want Error: %v&quot;, testCase.A, testCase.B, err.Error(), testCase.Err.Error())
        }
    }
}
</code></pre>

<ul>
<li><code>t.Parallel()</code> - makes tests execution concurrent<br /></li>
<li><code>t.Log(&quot;Message&quot;)</code> displays message in verbose mode <code>-v</code>.<br /></li>
<li><code>t.Skip()</code> skips current test.<br />
<br />
<br /></li>
</ul>

<h3 id="test-http-handlers">Test HTTP handlers</h3>

<p>To make code testable:</p>

<ul>
<li>break the code into pure functions<br /></li>

<li><p>keep all external data in separate files, that can be mocked</p>

<pre><code>PROJECT
├── main/
│    └── main.go
└── handlers/
     ├── adduser.go
     ├── adduser_test.go
     ├── handlers.go
     └── index.go
</code></pre></li>
</ul>

<pre><code class="language-go">// main.go
package main

import (
    &quot;../handlers&quot;
    &quot;net/http&quot;
)

func main() {
    handler := handlers.Handler{
        Users: &amp;[]handlers.User{},
    }

    http.HandleFunc(&quot;/&quot;, handler.HandleIndex)
    http.HandleFunc(&quot;/adduser&quot;, handler.HandleAddUser)
    http.ListenAndServe(&quot;:3000&quot;, nil)
}
</code></pre>

<pre><code class="language-go">// handlers/handlers.go
package handlers

type User struct {
    Name    string `json:&quot;name&quot;`
    Surname string `json:&quot;surname&quot;`
    Age     uint8  `json:&quot;age&quot;`
}

type Handler struct {
    Users *[]User
}
</code></pre>

<pre><code class="language-go">// handlers/index.go
package handlers

import (
	&quot;encoding/json&quot;
	&quot;log&quot;
	&quot;net/http&quot;
)

func (h Handler) HandleIndex(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodGet:
        json, err := json.Marshal(*h.Users)
        if err != nil {
            log.Panic(&quot;JSON marshalling error&quot;)
        }

        w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
        w.Write([]byte(json))

    case http.MethodPost:
        w.WriteHeader(http.StatusMethodNotAllowed)
    }
}
</code></pre>

<pre><code class="language-go">// handlers/adduser.go
package handlers

import (
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;strconv&quot;
)

func (h Handler) HandleAddUser(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodGet:
        q := r.URL.Query()

        name := q[&quot;name&quot;][0]
        surname := q[&quot;surname&quot;][0]

        age, err := strconv.Atoi(q[&quot;age&quot;][0])
        if err != nil {
            log.Panic(&quot;Invalid age.&quot;)
        }

        *h.Users = append(*h.Users, User{name, surname, uint8(age)})

    case http.MethodPost:
        w.Write([]byte(&quot;Not implemented yet.&quot;))

    default:
        w.WriteHeader(http.StatusMethodNotAllowed)
    }
}
</code></pre>

<pre><code class="language-go">// handlers/adduser_test.go
package handlers

import (
    &quot;net/http&quot;
    &quot;net/http/httptest&quot;
    &quot;strings&quot;
    &quot;testing&quot;
)

func TestHandler_HandleAddUser(t *testing.T) {
    // Create handler w/ test data
    h := Handler{
        Users: &amp;[]User{},
    }

    // Create handler from a function
    handler := http.HandlerFunc(h.HandleAddUser)

    r, err := http.NewRequest(&quot;GET&quot;, &quot;/adduser?name=Oleg&amp;surname=Legun&amp;age=26&quot;, strings.NewReader(&quot;&quot;))
    if err != nil {
        t.Errorf(&quot;Error %v&quot;, err)
    }

    // recorder keeps all http requests
    w := httptest.NewRecorder()

    handler.ServeHTTP(w, r)

    if w.Code != http.StatusOK {
        t.Fatalf(&quot;Expected %d, got %d&quot;, http.StatusOK, w.Code)
    }
}

func TestHandler_HandleIndex(t *testing.T) {
    // Create handler w/ test data
    handler := Handler{
        Users: &amp;[]User{
            {&quot;Oleg&quot;, &quot;Legun&quot;, 26},
        },
    }

    // Create handler from a function
    h := http.HandlerFunc(handler.HandleIndex)

    r, err := http.NewRequest(&quot;GET&quot;, &quot;/&quot;, strings.NewReader(&quot;&quot;))
    if err != nil {
        t.Errorf(&quot;Error %v&quot;, err)
    }

    // recorder keeps all http requests
    w := httptest.NewRecorder()

    h.ServeHTTP(w, r)

    if w.Code != http.StatusOK {
        t.Fatalf(&quot;Expected %d, got %d&quot;, http.StatusOK, w.Code)
    }

    expected := `[{&quot;name&quot;:&quot;Oleg&quot;,&quot;surname&quot;:&quot;Legun&quot;,&quot;age&quot;:26}]`

    // Can also use DeepEqual() instead of a string
    if w.Body.String() != expected {
        t.Errorf(&quot;Expected %s, got %s&quot;, expected, w.Body.String())
    }
}
</code></pre>

<h3 id="mocks">Mocks</h3>

<p><code>https://github.com/golang/mock</code></p>

<p>We can test how our program works w/ external dependency by using a<br />
generated mock based on its interface.</p>

<blockquote>
<p>Package must be available on GOPATH.</p>
</blockquote>

<table>
<thead>
<tr>
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>mockgen -destination=./mocks/users_mock.go users UserInterface</code></td>
<td align="left">Generate mocks based on UserInterface from <code>users</code> package</td>
</tr>
</tbody>
</table>

<pre><code class="language-go">// External Dependency `/users` on GOPATH
package users

type User struct {
    ID   int
    Name string
}

func (u User) GetName() string {
    return u.Name
}

func (u *User) SetName(name string) {
    u.Name = name
}

type UserInterface interface {
    GetName() string
    SetName(string)
}
</code></pre>

<pre><code class="language-go">// users_test.go
package users

import (
    &quot;./mocks&quot;
    &quot;./users&quot;
    &quot;fmt&quot;
    &quot;github.com/golang/mock/gomock&quot;
    &quot;testing&quot;
)

func SetAndGetName(u users.UserInterface) {
    u.SetName(&quot;Oleg&quot;)  // 1st operation
    name := u.GetName()
    fmt.Println(name)  // 2nd operation
}

func TestSetAndGetName(t *testing.T) {
    mockCtrl := gomock.NewController(t)  // pass `t` to enable logging to the console if gomock fails
    defer mockCtrl.Finish()  // Check all methods calls after SetAndGetName() finishes and log PASS/FAIL

    testUser := mocks.NewMockUserInterface(mockCtrl)

    // Record a particular sequence of methods calls, that must be executed
    testUser.EXPECT().SetName(&quot;Oleg&quot;) // record 1st operation
    testUser.EXPECT().GetName().Return(&quot;Oleg&quot;)  // record 2nd operation

    SetAndGetName(testUser) // Pass `testUser` mock to the function to test it
}
</code></pre>

                        </div>                      
                        <div class="clear"></div>
                    </div>
                </div>
            </article>   
            <div class="clear"></div>

            
            <p class="post-tags">
                  <span class="fa fa-tags">Tags:</span>
                  
                    <a rel="tag" href="../../../tags/golang">golang</a>
                  
            </p>
            
            <div id="related-posts">
                <div class="related-inner">
                </div>
            </div>
            
            
<section id="comments" class="themeform">
  

  

  
  

<div id="gitment"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>


<script>
var gitment = new Gitment({
  
  id: location.pathname,
  owner: 'rinetd',
  repo: 'rinetd.github.io',
  oauth: {
    client_id: '89af57db85ca20b7668c',
    client_secret: '4e57a031d7bd29f740559a907db2fe0efb3bf813',
  },
})
gitment.render('gitment')
</script>

  


</section>

            
            <section id="comments" class="themeform">
                
            </section>
        </div>
</div> <div class="sidebar s1 collapsed" data-position="left" data-layout="col-3cm" data-sb-id="s1">
    <a class="sidebar-toggle" title="Expand Sidebar">
        <i class="fas icon-sidebar-toggle"></i>
    </a>
    <div class="sidebar-content">
        <div class="sidebar-top group">
            <p>Follow:</p>  
                          
<ul class="social-links">
    
    
    
    

    
    <li>
        <a class="social-tooltip" href="mailto:" title="Email">
            <i class="fa fa-envelope"></i></a>
    </li>

    
    <li>
        <a class="social-tooltip"  href="//github.com/" title="GitHub"><i
                class="fa fa-github"></i></a>
    </li>

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    <li>
        <a class="social-tooltip" title="RSS Feed"
            aria-label="RSS Feed"
            href="../../../feed" target="_blank"
            style="color:rgba(255,255,255,0.7)">
            <i class="fa fa-rss"></i>
        </a>
    </li>

</ul>
   
        </div>
            <ul class="post-nav group">
    <li class="previous">
      
      <a href="../../../language/golang/go-pipe/" rel="prev">
        <i class="fa fa-chevron-left"></i>
        <strong>Previous Post</strong>
        <span>Golang Pipe</span>
      </a>
      
  </li>
</ul>

            
            <div id="categories-2" class="widget widget_categories"><h3>分类</h3>
  <ul>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/ai/">Ai</a>
        <small>(4)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/algorithm/">Algorithm</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/android/">Android</a>
        <small>(17)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/ansible/">Ansible</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/beats/">Beats</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/caffe/">Caffe</a>
        <small>(18)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/camera/">Camera</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/cgo/">Cgo</a>
        <small>(9)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/clang/">Clang</a>
        <small>(6)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/cmd/">Cmd</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/cpp/">Cpp</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/css/">Css</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/dart/">Dart</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/database/">Database</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/dataset/">Dataset</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/deeplearning/">Deeplearning</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/devops/">Devops</a>
        <small>(70)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/docker/">Docker</a>
        <small>(18)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/dts/">Dts</a>
        <small>(5)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/elasticsearch/">Elasticsearch</a>
        <small>(9)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/english/">English</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/freertos/">Freertos</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/front-end/">Front-End</a>
        <small>(20)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/golang/">Golang</a>
        <small>(127)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/hacker/">Hacker</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/hardware/">Hardware</a>
        <small>(10)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/hisi/">Hisi</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/jetson/">Jetson</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/js/">Js</a>
        <small>(9)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/jumpserver/">Jumpserver</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/kernel/">Kernel</a>
        <small>(6)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/linux/">Linux</a>
        <small>(91)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/linux-%E5%91%BD%E4%BB%A4/">Linux-命令</a>
        <small>(120)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/mac/">Mac</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/machinelearn/">Machinelearn</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/machinelearning/">Machinelearning</a>
        <small>(11)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/macos/">Macos</a>
        <small>(5)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/math/">Math</a>
        <small>(6)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/matplotlib/">Matplotlib</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/mysql/">Mysql</a>
        <small>(10)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/ncnn/">Ncnn</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/network/">Network</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/nginx/">Nginx</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/node/">Node</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/numpy/">Numpy</a>
        <small>(4)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/opencv/">Opencv</a>
        <small>(10)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/pandas/">Pandas</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/platform/">Platform</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/post/">Post</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/pyqt/">Pyqt</a>
        <small>(4)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/python/">Python</a>
        <small>(24)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/pytorch/">Pytorch</a>
        <small>(6)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/rk3288/">Rk3288</a>
        <small>(23)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/rk3399/">Rk3399</a>
        <small>(9)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/rtmp/">Rtmp</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/scikit/">Scikit</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/shell/">Shell</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/tool/">Tool</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/weixin/">Weixin</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/windows/">Windows</a>
        <small>(22)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/work/">Work</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/yolo/">Yolo</a>
        <small>(7)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%8D%8F%E8%AE%AE/">协议</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a>
        <small>(23)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%B7%A5%E5%85%B7/">工具</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/">常用算法</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/">排列组合</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        <small>(37)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91/">文本编辑</a>
        <small>(30)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/">生活技巧</a>
        <small>(4)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a>
        <small>(1)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a>
        <small>(40)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7/">集群监控</a>
        <small>(7)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/">静态博客</a>
        <small>(15)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a href="../../../categories/%E9%AB%98%E6%95%B0/">高数</a>
        <small>(2)</small>
      </li>
    
  </ul>

</div>


    </div>
</div> <div class="sidebar s2 collapsed" data-position="right" data-layout="col-3cm" data-sb-id="s2">
        <a class="sidebar-toggle" title="Expand Sidebar">
            <i class="fas icon-sidebar-toggle"></i>
        </a>
        <div class="sidebar-content">
            <div class="sidebar-top group">
                <p>More</p>
            </div>
            <ul class="post-nav group">
    <li class="next">
      
      <a href="../../../language/golang/_mistakes/" rel="next">
        <i class="fa fa-chevron-right"></i>
        <strong>Next post</strong>
        <span>Go 语言的那些坑</span>
      </a>
      
  </li>
</ul>

            <div id="tag_cloud-2" class="widget widget_tag_cloud"><h3>标签云</h3>
  <div class="tagcloud post-tags">

      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/ai/" class="tag-link-4" title="1 Posts">ai<small>(4)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/ansible/" class="tag-link-19" title="1 Posts">ansible<small>(19)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/awesome/" class="tag-link-3" title="1 Posts">awesome<small>(3)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/bfc/" class="tag-link-2" title="1 Posts">bfc<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/c/" class="tag-link-5" title="1 Posts">c<small>(5)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/caffe/" class="tag-link-18" title="1 Posts">caffe<small>(18)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/centos7/" class="tag-link-2" title="1 Posts">centos7<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/cgo/" class="tag-link-9" title="1 Posts">cgo<small>(9)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/clang/" class="tag-link-6" title="1 Posts">clang<small>(6)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/cmd/" class="tag-link-2" title="1 Posts">cmd<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/cpp/" class="tag-link-2" title="1 Posts">cpp<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/css/" class="tag-link-20" title="1 Posts">css<small>(20)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/css3/" class="tag-link-2" title="1 Posts">css3<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/curd/" class="tag-link-3" title="1 Posts">curd<small>(3)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/curl/" class="tag-link-2" title="1 Posts">curl<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/dataset/" class="tag-link-2" title="1 Posts">dataset<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/devops/" class="tag-link-3" title="1 Posts">devops<small>(3)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/docker/" class="tag-link-21" title="1 Posts">docker<small>(21)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/drone/" class="tag-link-22" title="1 Posts">drone<small>(22)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/dts/" class="tag-link-6" title="1 Posts">dts<small>(6)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/elasticsearch/" class="tag-link-9" title="1 Posts">elasticsearch<small>(9)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/emacs/" class="tag-link-12" title="1 Posts">emacs<small>(12)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/encode/" class="tag-link-3" title="1 Posts">encode<small>(3)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/english/" class="tag-link-8" title="1 Posts">english<small>(8)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/es6/" class="tag-link-2" title="1 Posts">es6<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/etcd/" class="tag-link-4" title="1 Posts">etcd<small>(4)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/flannel/" class="tag-link-2" title="1 Posts">flannel<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/git/" class="tag-link-6" title="1 Posts">git<small>(6)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/github/" class="tag-link-2" title="1 Posts">github<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/golang/" class="tag-link-141" title="1 Posts">golang<small>(141)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/gradle/" class="tag-link-3" title="1 Posts">gradle<small>(3)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/haproxy/" class="tag-link-5" title="1 Posts">haproxy<small>(5)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/hardware/" class="tag-link-10" title="1 Posts">hardware<small>(10)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/hexo/" class="tag-link-3" title="1 Posts">hexo<small>(3)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/html/" class="tag-link-2" title="1 Posts">html<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/http/" class="tag-link-6" title="1 Posts">http<small>(6)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/hugo/" class="tag-link-14" title="1 Posts">hugo<small>(14)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/imagemagick/" class="tag-link-2" title="1 Posts">imagemagick<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/ip/" class="tag-link-3" title="1 Posts">ip<small>(3)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/iproute2/" class="tag-link-5" title="1 Posts">iproute2<small>(5)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/iptables/" class="tag-link-17" title="1 Posts">iptables<small>(17)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/javascript/" class="tag-link-19" title="1 Posts">javascript<small>(19)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/jquery/" class="tag-link-12" title="1 Posts">jquery<small>(12)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/js/" class="tag-link-10" title="1 Posts">js<small>(10)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/jumpserver/" class="tag-link-2" title="1 Posts">jumpserver<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/jwt/" class="tag-link-3" title="1 Posts">jwt<small>(3)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/kernel/" class="tag-link-6" title="1 Posts">kernel<small>(6)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/kubernetes/" class="tag-link-11" title="1 Posts">kubernetes<small>(11)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/linux/" class="tag-link-19" title="1 Posts">linux<small>(19)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/lvs/" class="tag-link-8" title="1 Posts">lvs<small>(8)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/machinelearn/" class="tag-link-3" title="1 Posts">machinelearn<small>(3)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/machinelearning/" class="tag-link-11" title="1 Posts">machinelearning<small>(11)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/macos/" class="tag-link-7" title="1 Posts">macos<small>(7)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/makefile/" class="tag-link-2" title="1 Posts">makefile<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/mariadb/" class="tag-link-9" title="1 Posts">mariadb<small>(9)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/math/" class="tag-link-6" title="1 Posts">math<small>(6)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/matplotlib/" class="tag-link-3" title="1 Posts">matplotlib<small>(3)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/maven/" class="tag-link-2" title="1 Posts">maven<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/meteor/" class="tag-link-7" title="1 Posts">meteor<small>(7)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/ml/" class="tag-link-3" title="1 Posts">ml<small>(3)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/mysql/" class="tag-link-61" title="1 Posts">mysql<small>(61)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/ncnn/" class="tag-link-3" title="1 Posts">ncnn<small>(3)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/netns/" class="tag-link-2" title="1 Posts">netns<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/network/" class="tag-link-2" title="1 Posts">network<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/nginx/" class="tag-link-28" title="1 Posts">nginx<small>(28)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/nmap/" class="tag-link-2" title="1 Posts">nmap<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/node/" class="tag-link-4" title="1 Posts">node<small>(4)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/nosql/" class="tag-link-8" title="1 Posts">nosql<small>(8)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/npm/" class="tag-link-3" title="1 Posts">npm<small>(3)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/numpy/" class="tag-link-4" title="1 Posts">numpy<small>(4)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/oauth2/" class="tag-link-2" title="1 Posts">oauth2<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/opencv/" class="tag-link-10" title="1 Posts">opencv<small>(10)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/openssl/" class="tag-link-3" title="1 Posts">openssl<small>(3)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/pandoc/" class="tag-link-2" title="1 Posts">pandoc<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/php/" class="tag-link-4" title="1 Posts">php<small>(4)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/post/" class="tag-link-3" title="1 Posts">post<small>(3)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/powershell/" class="tag-link-2" title="1 Posts">powershell<small>(2)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/prometheus/" class="tag-link-8" title="1 Posts">prometheus<small>(8)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/pyqt/" class="tag-link-4" title="1 Posts">pyqt<small>(4)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/python/" class="tag-link-26" title="1 Posts">python<small>(26)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/pytorch/" class="tag-link-6" title="1 Posts">pytorch<small>(6)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/redis/" class="tag-link-2" title="1 Posts">redis<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/reflect/" class="tag-link-3" title="1 Posts">reflect<small>(3)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/responsive/" class="tag-link-2" title="1 Posts">responsive<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/restful/" class="tag-link-6" title="1 Posts">restful<small>(6)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/rk3288/" class="tag-link-22" title="1 Posts">rk3288<small>(22)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/rk3399/" class="tag-link-9" title="1 Posts">rk3399<small>(9)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/route/" class="tag-link-2" title="1 Posts">route<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/rsync/" class="tag-link-2" title="1 Posts">rsync<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/scikit/" class="tag-link-3" title="1 Posts">scikit<small>(3)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/scrapy/" class="tag-link-8" title="1 Posts">scrapy<small>(8)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/scss/" class="tag-link-2" title="1 Posts">scss<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/sed/" class="tag-link-3" title="1 Posts">sed<small>(3)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/seo/" class="tag-link-5" title="1 Posts">seo<small>(5)</small></a>
        
      
        
      
        
          <a rel="tag" href="../../../tags/shell/" class="tag-link-10" title="1 Posts">shell<small>(10)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/sqlite/" class="tag-link-2" title="1 Posts">sqlite<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/ssh/" class="tag-link-3" title="1 Posts">ssh<small>(3)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/stm32/" class="tag-link-5" title="1 Posts">stm32<small>(5)</small></a>
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/swagger/" class="tag-link-2" title="1 Posts">swagger<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/swarm/" class="tag-link-2" title="1 Posts">swarm<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/sysbench/" class="tag-link-2" title="1 Posts">sysbench<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/sysctl/" class="tag-link-2" title="1 Posts">sysctl<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/systemctl/" class="tag-link-2" title="1 Posts">systemctl<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/tc/" class="tag-link-2" title="1 Posts">tc<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/tcpdump/" class="tag-link-2" title="1 Posts">tcpdump<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/timezone/" class="tag-link-2" title="1 Posts">timezone<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/tshark/" class="tag-link-2" title="1 Posts">tshark<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/ubuntu/" class="tag-link-2" title="1 Posts">ubuntu<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/ulimit/" class="tag-link-2" title="1 Posts">ulimit<small>(2)</small></a>
        
      
        
      
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/vim/" class="tag-link-14" title="1 Posts">vim<small>(14)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/webpack3/" class="tag-link-2" title="1 Posts">webpack3<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/windows/" class="tag-link-18" title="1 Posts">windows<small>(18)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/wireshark/" class="tag-link-2" title="1 Posts">wireshark<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/xidel/" class="tag-link-2" title="1 Posts">xidel<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/xml/" class="tag-link-2" title="1 Posts">xml<small>(2)</small></a>
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/yaml/" class="tag-link-2" title="1 Posts">yaml<small>(2)</small></a>
        
      
        
          <a rel="tag" href="../../../tags/yolo/" class="tag-link-7" title="1 Posts">yolo<small>(7)</small></a>
        
      
        
      
        
      
        
      
        
          <a rel="tag" href="../../../tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="tag-link-2" title="1 Posts">微服务<small>(2)</small></a>
        
      
        
      
        
      
        
      
  </div>
</div>


        </div>
    </div>`

                    </div>
                    
                </div>
                

            </div>

        </div>
    </div>

    <footer id="footer">
    <section class="container" id="footer-bottom">
      <div class="container-inner">
        <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
        <div class="pad group">
          <div class="grid one-half">
            <div id="copyright">
                <p>Copyright (c) 2017. All rights reserved. (版权所有) <a href='http://www.miitbeian.gov.cn/'>鲁ICP备17074587号-1</a></p>
                
            </div>
            
          </div>
          
          <div class="grid one-half last">
            <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On WeiBo"
        href="http://weibo.com/rinetd" target="_blank">
        <i class="fa fa-weibo"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On Twitter"
        href="https://twitter.com/rinetd" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub"
        href="https://github.com/rinetd" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

          </div>
        </div>
  
      </div>
      
    </section>
    
  </footer>


<div class="back-to-top" id="back-to-top">
    <i class="fa fa-angle-double-up"></i>
</div>





<script type='text/javascript'>
    var HUParams={
        "_disabled":[],
        "SmoothScroll":{
            "Enabled":true,
            "Options":{"touchpadSupport":false}
        },
        "centerAllImg":"1",
        "timerOnScrollAllBrowsers":"1",
        "extLinksStyle":"1",
        "extLinksTargetExt":"1",
        "extLinksSkipSelectors":{
            "classes":["btn","button"],"ids":[]
        },
        "imgSmartLoadEnabled":"1",
        "imgSmartLoadOpts":{
            "parentSelectors":[".container .content",".container .sidebar","#footer","#header-widgets"],
            "opts":{
                "excludeImg":[".tc-holder-img"],
                "fadeIn_options":100
            }
        },
        "goldenRatio":"1.618","gridGoldenRatioLimit":"350",
        "sbStickyUserSettings":{"desktop":true,"mobile":true},
        "isWPMobile":"",
        "menuStickyUserSettings":{
            "desktop":"stick_up",
            "mobile":"stick_up"
        },
        "isDevMode":"",
        "ajaxUrl":"https:\/\/demo-hueman.presscustomizr.com\/?huajax=1",
            "frontNonce":{"id":"HuFrontNonce","handle":"798e5956c0"},
            "userStarted":{"with":"before|1.0.4","on":{"date":"2017-05-22 16:30:22.000000","timezone_type":3,"timezone":"UTC"}},
            "isWelcomeNoteOn":"","welcomeContent":""};
</script>



<script src="https://cdn.bootcss.com/lodash-compat/3.10.2/lodash.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript" src="../../../front/js/scripts.js"></script> 




<script>
  $(".topbar-toggle-down").click(function(){
    $("#nav-topbar").css("overflow","visible");
  });
</script>





















<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-106129999-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5HM5XM2" height="0" width="0"
                style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5HM5XM2');
    </script>
    
<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?e2103759b6030b3c4ac84c63c542e493";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>




</body>

</html>