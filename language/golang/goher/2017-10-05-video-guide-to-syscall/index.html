<!doctype html><html lang=zh-cn class=no-js><base href=http://blog.pytool.com/><title>è§†é¢‘ç¬”è®°ï¼šGo å’Œ syscall - Liz Rice</title><meta charset=utf-8><meta name=robots content=index,nofollow><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta http-equiv=x-dns-prefetch-control content=on><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=origin-when-cross-origin><meta name=description content="è§†é¢‘ä¿¡æ¯ A Go programmer's guide to syscalls by Liz Rice at GopherCon 2017 {% owl youtube 01w7viEZzXQ %} https://www.youtube.com/watch?v=01w7viEZzXQ å¹»ç¯ï¼šhttps://speakerdeck.com/lizrice/a-go-programm"><meta name=author content=rinetd><meta name=baidu-site-verification content=pCInWQYbNT><meta name=google-site-verification content=ifeWsnNpU7w8vP3ii_Cjq-P9LKw3ngVitnMWv4XmJqk><link rel=canonical href=http://blog.pytool.com/language/golang/goher/2017-10-05-video-guide-to-syscall/><link rel=icon href=../../../../public/favicon.ico><link rel="shortcut icon" href=../../../../public/favicon.ico><link rel=stylesheet href=../../../../front/css/main.min.css><link rel=stylesheet href=../../../../front/css/font-awesome.min.css><link rel=stylesheet href=//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css><body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome"><div id=wrapper><header id=header class="top-menu-mobile-on one-mobile-menu top_menu header-ads-desktop  topbar-transparent"><nav class="nav-container group mobile-menu mobile-sticky" id=nav-mobile data-menu-id=header-1><div class=mobile-title-logo-in-header><p class=site-title><a class=custom-logo-link href=http://blog.pytool.com rel=home title="Pytool | Home">Pytool</a></div><div class="ham__navbar-toggler-two collapsed" title=Menu aria-expanded=false><div class=ham__navbar-span-wrapper><span class="line line-1"></span><span class="line line-2"></span><span class="line line-3"></span></div></div><div class=nav-text>è§†é¢‘ç¬”è®°ï¼šGo å’Œ syscall - Liz Rice</div><div class="nav-wrap container"><ul class="nav container-inner group mobile-search"><li><form class="searchform themeform" action=https://demo-hueman.presscustomizr.com/><div><input class=search name=s onblur="if(this.value=='')this.value='To search type and hit enter';" onfocus="if(this.value=='To search type and hit enter')this.value='';" value="To search type and hit enter"></div></form></ul><ul id=menu-topbar-menu class="nav container-inner group"><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home"><a href=http://blog.pytool.com>Home</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../edit/>Edit</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../database/>Database</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/database/mongo/>Mongo</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/database/mysql/>Mysql</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/database/redis/>Redis</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../devops/>Devops</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/oauth2/>OAuth2</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/ansible/>Ansible</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/docker/>Docker</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/drone/>Drone</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/elk/>Elk</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/etcd/>Etcd</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/kubernetes/>Kubernetes</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/prometheus/>Prometheus</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%99%A8/>æ–‡æ¡£ç”Ÿæˆå™¨</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/>ç³»ç»Ÿç›‘æ§</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/devops/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/>è‡ªåŠ¨éƒ¨ç½²</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../frontend/>Frontend</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/frontend/css/>Css</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/frontend/vue/>Vue</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../hacker/>Hacker</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/>00_ç«¯å£è½¬å‘(éš§é“)</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hacker/01-info-gather/>01-Info-Gather</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/>01_ç«¯å£æ‰«æ</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hacker/02-spoof/>02-Spoof</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hacker/shells/>Shells</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../hardware/>Hardware</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hardware/android-%E5%BA%95%E5%B1%82/>Android-åº•å±‚</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hardware/rtmp/>Rtmp</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/hardware/%E8%BD%A6%E8%81%94%E7%BD%91/>è½¦è”ç½‘</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../language/>Language</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/android/>Android</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/awesome/>Awesome</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/golang/>Golang</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=http://blog.pytool.com/language/golang/goher/>Goher</a><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=http://blog.pytool.com/language/golang/hugo/>Hugo</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/java/>Java</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=http://blog.pytool.com/language/java/hadoop/>Hadoop</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/php/>Php</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=http://blog.pytool.com/language/php/magento/>Magento</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/language/python/>Python</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=http://blog.pytool.com/language/python/scrapy/>Scrapy</a></ul></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../linux/>Linux</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/cmd/>Cmd</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/git/>Git</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/haproxy/>Haproxy</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/ip/>Ip</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/lvs/>Lvs</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/nginx/>Nginx</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/linux/shell/>Shell</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../../machinelearning/>MachineLearning</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=http://blog.pytool.com/machinelearning/math/>Math</a></ul><li class=item><a class=text href=../../../../series/>series</a><li class=item><a class=text href=../../../../categories/>categories</a><li class=item><a class=text href=../../../../tags/>tags</a><li class=item><a class=text href=../../../../me/>about</a></ul></div></nav><nav class="nav-container group desktop-menu desktop-sticky" id=nav-topbar data-menu-id=header-2><div class=nav-text>è§†é¢‘ç¬”è®°ï¼šGo å’Œ syscall - Liz Rice</div><div class=topbar-toggle-down><i class="fas fa-angle-double-down" aria-hidden=true data-toggle=down title="Expand menu"></i><i class="fas fa-angle-double-up" aria-hidden=true data-toggle=up title="Collapse menu"></i></div><div class="nav-wrap container"><ul id=menu-topbar-menu-1 class="nav container-inner group"><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home"><a href=../../../../>Home</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../edit/>Edit</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../database/>Database</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/database/mongo/>Mongo</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/database/mysql/>Mysql</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/database/redis/>Redis</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../devops/>Devops</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/oauth2/>OAuth2</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/ansible/>Ansible</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/docker/>Docker</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/drone/>Drone</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/elk/>Elk</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/etcd/>Etcd</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/kubernetes/>Kubernetes</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/prometheus/>Prometheus</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%99%A8/>æ–‡æ¡£ç”Ÿæˆå™¨</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/>ç³»ç»Ÿç›‘æ§</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/devops/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/>è‡ªåŠ¨éƒ¨ç½²</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../frontend/>Frontend</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/frontend/css/>Css</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/frontend/vue/>Vue</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../hacker/>Hacker</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/>00_ç«¯å£è½¬å‘(éš§é“)</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hacker/01-info-gather/>01-Info-Gather</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/>01_ç«¯å£æ‰«æ</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hacker/02-spoof/>02-Spoof</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hacker/shells/>Shells</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../hardware/>Hardware</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hardware/android-%E5%BA%95%E5%B1%82/>Android-åº•å±‚</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hardware/rtmp/>Rtmp</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/hardware/%E8%BD%A6%E8%81%94%E7%BD%91/>è½¦è”ç½‘</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../language/>Language</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/android/>Android</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/awesome/>Awesome</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/golang/>Golang</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/java/>Java</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/php/>Php</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/language/python/>Python</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../linux/>Linux</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/cmd/>Cmd</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/git/>Git</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/haproxy/>Haproxy</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/ip/>Ip</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/lvs/>Lvs</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/nginx/>Nginx</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/linux/shell/>Shell</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../machinelearning/>MachineLearning</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/machinelearning/math/>Math</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../../post/>Post</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/life/>Life</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/reship/>Reship</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/basic/>Basic</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/english/>English</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/seo/>Seo</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/software/>Software</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/wiki/>Wiki</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=http://blog.pytool.com/post/windows/>Windows</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../../series/>series</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../../categories/>categories</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../../tags/>tags</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../../me/>about</a></ul></div></nav></header><div class=container id=page><div class=container-inner><div class=main><div class="main-inner group"><div class=content><div class="pad group page-title"><ul class="meta-single group"><li><span class="fa fa-folder-open"></span><li class=category><a href=../../../../categories/golang/ rel="category tag">golang</a></ul></div><div class="pad group"><article class="post type-post status-publish format-standard has-post-thumbnail hentry category-lifestyle tag-classical-grid tag-masonry-grid tag-standard-list"><div class="post-inner group"><h1 class=post-title>è§†é¢‘ç¬”è®°ï¼šGo å’Œ syscall - Liz Rice</h1><p class=post-byline>by Â· 2017å¹´10æœˆ05æ—¥ Â· 5490 Words Â·
~11min reading time |
<a href=https://gitlab.com/rinetd/blog/edit/master/language/golang/goher/2017-10-05-video-guide-to-syscall.md target=_blank>Improve on <i class="fa fa-gitlab"></i></a><div class=clear></div><div class="entry themeform"><div class=entry-inner><p>åŸæ–‡ä½œè€…ï¼š<a target=_blank href=http://blog.pytool.com/>rinetd</a></br>åŸæ–‡é“¾æ¥ï¼š<a target=_blank href=http://blog.pytool.com/language/golang/goher/2017-10-05-video-guide-to-syscall/> è§†é¢‘ç¬”è®°ï¼šGo å’Œ syscall - Liz Rice</a></p><h1 id=è§†é¢‘ä¿¡æ¯>è§†é¢‘ä¿¡æ¯</h1><p><strong>A Go programmer's guide to syscalls</strong><br>by Liz Rice<br>at GopherCon 2017<p>{% owl youtube 01w7viEZzXQ %}<p><a href="https://www.youtube.com/watch?v=01w7viEZzXQ" target=_blank>https://www.youtube.com/watch?v=01w7viEZzXQ</a><ul><li>å¹»ç¯ï¼š<a href=https://speakerdeck.com/lizrice/a-go-programmers-guide-to-syscalls target=_blank>https://speakerdeck.com/lizrice/a-go-programmers-guide-to-syscalls</a><br><li>åšæ–‡ï¼š<a href=https://about.sourcegraph.com/go/a-go-guide-to-syscalls target=_blank>https://about.sourcegraph.com/go/a-go-guide-to-syscalls</a><br><li>ä»£ç ï¼š<a href=https://github.com/lizrice/strace-from-scratch target=_blank>https://github.com/lizrice/strace-from-scratch</a><br><br></ul><h1 id=ä»€ä¹ˆæ˜¯-syscall>ä»€ä¹ˆæ˜¯ <code>syscall</code>ï¼Ÿ</h1><blockquote><p>â€œåœ¨ç”µè„‘ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨ï¼ˆè‹±è¯­ï¼šsystem callï¼‰ï¼Œåˆç§°ä¸ºç³»ç»Ÿå‘¼å«ï¼ŒæŒ‡è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„ç¨‹åºå‘æ“ä½œç³»ç»Ÿå†…æ ¸è¯·æ±‚éœ€è¦æ›´é«˜æƒé™è¿è¡Œçš„æœåŠ¡ã€‚ç³»ç»Ÿè°ƒç”¨æä¾›ç”¨æˆ·ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚å¤§å¤šæ•°ç³»ç»Ÿäº¤äº’å¼æ“ä½œéœ€æ±‚åœ¨å†…æ ¸æ€æ‰§è¡Œã€‚å¦‚è®¾å¤‡IOæ“ä½œæˆ–è€…è¿›ç¨‹é—´é€šä¿¡ã€‚â€ - <a href=https://zh.wikipedia.org/zh-cn/ç³»ç»Ÿè°ƒç”¨ target=_blank>ç»´åŸºç™¾ç§‘</a></blockquote><p>å®é™…ä¸Šï¼Œä½ åŸºæœ¬ä¸Šåšä»»ä½•äº‹æƒ…çš„æ—¶å€™ï¼Œéƒ½éœ€è¦ç³»ç»Ÿè°ƒç”¨ã€‚<ul><li>è®¿é—®æ–‡ä»¶<br><li>è®¿é—®è®¾å¤‡<br><li>è¿›ç¨‹ç®¡ç†<br><li>é€šè®¯<br><li>æ—¶é—´<br><li>...<br><br></ul><h2 id=å³ä½¿æ˜¯ç®€å•ç¨‹åºä¹Ÿåœ¨ä½¿ç”¨-syscall>å³ä½¿æ˜¯ç®€å•ç¨‹åºä¹Ÿåœ¨ä½¿ç”¨ <code>syscall</code></h2><p>æ— è®ºä½ æ˜¯å†™ C ç¨‹åºã€å†™ Go ç¨‹åºï¼Œæˆ–è€…å“ªæ€•æ˜¯å†™ bash è„šæœ¬ï¼Œä½ å®é™…ä¸Šéƒ½ä¼šç”¨åˆ° syscallã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ Go çš„ä¾‹å­ã€‚<p><strong>hello.go</strong><pre><code class=language-go>package main

import &quot;fmt&quot;

func main() {
	fmt.Println(&quot;Hello, GopherCon!&quot;)
}
</code></pre><p>å¦‚æœæˆ‘ä»¬åœ¨ Linux ä¸Šæ„å»ºï¼Œå¹¶ä¸”ä½¿ç”¨ <code>strace</code> çš„è¯ï¼Œå°±å¯ä»¥çœ‹åˆ°å‘ç”Ÿäº†å¤šå°‘ç³»ç»Ÿè°ƒç”¨äº†ï¼š<pre><code class=language-bash>$ go build hello.go
$ strace ./hello
execve(&quot;./hello&quot;, [&quot;./hello&quot;], [/* 23 vars */]) = 0
arch_prctl(ARCH_SET_FS, 0x52c008)       = 0
sched_getaffinity(0, 8192, [0])         = 8
mmap(0xc000000000, 65536, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc000000000
munmap(0xc000000000, 65536)             = 0

...

futex(0x52c0b0, FUTEX_WAIT, 0, NULL)    = 0
mmap(NULL, 262144, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f1eef3ac000
write(1, &quot;Hello, GopherCon!\n&quot;, 18Hello, GopherCon!
)     = 18
futex(0x52ba58, FUTEX_WAKE, 1)          = 1
futex(0x52b990, FUTEX_WAKE, 1)          = 1
exit_group(0)                           = ?
+++ exited with 0 +++
</code></pre><p>æˆ‘ä»¬çœ‹åˆ°äº†æµ·æµ·çš„ syscallï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å…³æ³¨ä¸€ä¸‹æœ€åçš„é‚£ä¸ª <code>write()</code>ï¼š<pre><code class=language-go>write(1, &quot;Hello, GopherCon!\n&quot;, 18Hello, GopherCon!
)     = 18
</code></pre><p>è¿™æ˜¯æœ€åçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°äº†æ ‡å‡†è¾“å‡ºï¼Œ<code>1</code>ã€‚<p>é‚£ä¹ˆä¸­é—´éƒ½ç»è¿‡äº†ä»€ä¹ˆï¼Ÿå¦‚æœæˆ‘ä»¬é¡ºç€ä»£ç ä¸€æ­¥æ­¥è·Ÿè¸ªè¿›å»å°±ä¼šçœ‹åˆ°ï¼Œ<code>fmt.Println()</code> çš„å®šä¹‰åœ¨ <code>fmt/print.go</code> ä¸­ï¼š<pre><code class=language-go>func Println(a ...interface{}) (n int, err error) {
	return Fprintln(os.Stdout, a...)
}
</code></pre><p><code>Fprintln()</code> çš„å®šä¹‰ä¸ºï¼š<pre><code class=language-go>func Fprintln(w io.Writer, a ...interface{}) (n int, err error) {
	p := newPrinter()
	p.doPrintln(a)
	n, err = w.Write(p.buf)
	p.free()
	return
}
</code></pre><p>æ³¨æ„åˆ°è¿™é‡Œæœ€åè°ƒç”¨çš„æ˜¯ <code>w.Write()</code>ï¼Œè€Œ <code>w</code> å®é™…ä¸Šæ˜¯å‰é¢çš„ <code>os.Stdout</code>ï¼Œå…¶å®šä¹‰åœ¨ <code>os/file.go</code> ä¸­ï¼Œä¸ºï¼š<pre><code class=language-go>	Stdout = NewFile(uintptr(syscall.Stdout), &quot;/dev/stdout&quot;)
</code></pre><p>è¿™é‡Œçš„ <code>NewFile()</code> ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶ï¼š<pre><code class=language-go>// &quot;os/file_unix.go&quot;
func newFile(fd uintptr, name string, pollable bool) *File {
	fdi := int(fd)
	if fdi &lt; 0 {
		return nil
	}
	f := &amp;File{&amp;file{
		pfd: poll.FD{
			Sysfd:         fdi,
			IsStream:      true,
			ZeroReadIsEOF: true,
		},
		name: name,
	}}
  ...
  return f
}
</code></pre><p>ç„¶åå»çœ‹è¿™ä¸ª <code>file</code> çš„å…·ä½“å®ç°ï¼š<pre><code class=language-go>func (f *File) write(b []byte) (n int, err error) {
	n, err = f.pfd.Write(b)
	runtime.KeepAlive(f)
	return n, err
}
</code></pre><p>è¿›ä¸€æ­¥å»çœ‹ <code>f.pfd.Write()</code> çš„å®ç°ï¼š<pre><code class=language-go>func (fd *FD) Write(p []byte) (int, error) {
	if err := fd.writeLock(); err != nil {
		return 0, err
	}
	defer fd.writeUnlock()
	if err := fd.pd.prepareWrite(fd.isFile); err != nil {
		return 0, err
	}
	var nn int
	for {
		max := len(p)
		if fd.IsStream &amp;&amp; max-nn &gt; maxRW {
			max = nn + maxRW
		}
		n, err := syscall.Write(fd.Sysfd, p[nn:max])
		if n &gt; 0 {
			nn += n
		}
		if nn == len(p) {
			return nn, err
		}
		if err == syscall.EAGAIN &amp;&amp; fd.pd.pollable() {
			if err = fd.pd.waitWrite(fd.isFile); err == nil {
				continue
			}
		}
		if err != nil {
			return nn, err
		}
		if n == 0 {
			return nn, io.ErrUnexpectedEOF
		}
	}
}
</code></pre><p>è¿™é‡Œæˆ‘ä»¬å°±çœ‹åˆ°äº†æœ€ç»ˆçš„ <code>syscall</code>ï¼š<pre><code class=language-go>		n, err := syscall.Write(fd.Sysfd, p[nn:max])
</code></pre><p>Go çš„ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨äº† <code>syscall</code> è¿™ä¸ªæ ‡å‡†åº“çš„åŒ…ã€‚åŒ…é‡Œæœ‰å¾ˆå¤šæ“ä½œç³»ç»Ÿç›¸å…³çš„ä»£ç ï¼Œä»¥åŠç‰¹å®šæ„æ¶çš„è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚<ul><li>ç³»ç»Ÿç›¸å…³çš„ä»£ç ï¼š<br><ul><li>å¦‚ï¼š <a href=https://golang.org/src/syscall/syscall_linux.go target=_blank>https://golang.org/src/syscall/syscall_linux.go</a><br></ul><li>è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼š<br><ul><li>å¦‚ï¼š<a href=https://golang.org/src/syscall/zsyscall_linux_386.go target=_blank>https://golang.org/src/syscall/zsyscall_linux_386.go</a><br><br></ul></ul><p>å¯¹äº Linux è€Œè¨€ï¼Œç°åœ¨å¤§çº¦æœ‰ <code>330</code> å¤šä¸ªç³»ç»Ÿè°ƒç”¨ã€‚<h2 id=å¦‚ä½•è¿›è¡Œçš„-syscall>å¦‚ä½•è¿›è¡Œçš„ <code>syscall</code></h2><p>å¦‚ä½•è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Ÿå’Œå¾€å¸¸ä¸€æ ·ï¼Œå…ˆæŸ¥ <code>man</code>ï¼š<blockquote><p><code>syscall()</code> saves CPU registers before making the system call, restores the registers upon return from the system call, and stores any error code returned by the system call in <code>errno(3)</code> if an error occurs.</blockquote><p>å°±æ˜¯è¯´è°ƒç”¨ <code>syscall</code> ä¹‹å‰å…ˆä¿å­˜ç¯å¢ƒï¼›<code>syscall</code> è¿”å›ä¹‹åï¼Œæ¢å¤ç¯å¢ƒï¼›é”™è¯¯ä»£ç åœ¨ <code>errno</code> ä¸­ã€‚<p>è€Œå®é™…çš„è°ƒç”¨æ¥å£ï¼Œå¯ä»¥å‚è€ƒï¼š<a href=http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/ target=_blank>http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a><p>ä»¥ <code>sys_write</code> è°ƒç”¨ä¸ºä¾‹ï¼Œç³»ç»Ÿè°ƒç”¨å·æ”¾åˆ°äº† <code>%rax</code> ä¹‹ä¸­ï¼Œæ–‡ä»¶çš„ <code>fd</code> æ”¾åˆ°äº† <code>%rdi</code> ä¸­ï¼Œè¦å†™å…¥çš„ <code>buf</code> æ”¾åˆ°äº† <code>%rsi</code> ä¸­ï¼Œå†™å…¥é•¿åº¦æ”¾åˆ°äº† <code>%rdx</code> ä¹‹ä¸­ã€‚<p>å½“æ‰§è¡Œäº† <code>syscall()</code> åï¼Œå¼€å§‹è¿›å…¥ Trapï¼Œç„¶åè¿›å…¥å†…æ ¸æ€ï¼Œå¼€å§‹æ‰§è¡Œå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨çš„ä»£ç ã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼Œä¼šæ”¾åˆ°äº† <code>%rax</code> ä¹‹ä¸­ã€‚<p>å½“ç„¶ï¼Œè¿™é‡Œæ˜¯ä»¥ <code>amd64</code> æ¶æ„çš„ Linux ç³»ç»Ÿä¸¾ä¾‹ï¼Œä¸åŒçš„ç³»ç»Ÿï¼Œæ— è®ºæ˜¯æŒ‡ä»¤é›†ã€è¿˜æ˜¯è°ƒç”¨æ–¹å¼éƒ½ä¼šä¸åŒã€‚<h2 id=syscall-å¯ä»¥ä½œä¸ºä¸€ä¸ªå…¼å®¹å±‚><code>syscall</code> å¯ä»¥ä½œä¸ºä¸€ä¸ªå…¼å®¹å±‚</h2><p>å¯ä»¥æŠŠ <code>syscall</code> ä½œä¸ºä¸€å±‚å¯ç§»æ¤å±‚ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°ä¸€ç»„ <code>syscall</code> æ¥å£ï¼Œæ¥æ¨¡æ‹Ÿ Linuxã€‚<p>è¿™ä¸ªæ¦‚å¿µä¸æ–°é²œï¼Œæ¯”å¦‚ <a href=https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux target=_blank>Windows Subsystem for Linux</a>ã€ä»¥åŠ FreeBSD çš„ <a href=https://www.freebsd.org/doc/handbook/linuxemu-lbc-install.html target=_blank>Linux emulation layer</a>ï¼Œè¿˜æœ‰ <a href=https://en.wikipedia.org/wiki/L4Linux target=_blank>L4Linux</a> éƒ½æ˜¯è¿™ä¹ˆåšçš„ã€‚<h2 id=è§‚å¯Ÿç¨‹åºçš„-syscall-è°ƒç”¨æƒ…å†µ>è§‚å¯Ÿç¨‹åºçš„ <code>syscall</code> è°ƒç”¨æƒ…å†µ</h2><ul><li>Linux ä¸‹çš„ <code>strace</code>ï¼š<br><ul><li><code>strace -c</code> æ±‡æ€»è¾“å‡ºã€‚<br><br></ul></ul><p>æ¯”å¦‚åˆšæ‰çš„é‚£ä¸ª <code>hello</code> ç¨‹åºï¼š<pre><code class=language-bash>$ strace -c ./hello
Hello, GopherCon!
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
  0.00    0.000000           0         1           write
  0.00    0.000000           0         8           mmap
  0.00    0.000000           0         1           munmap
  0.00    0.000000           0       114           rt_sigaction
  0.00    0.000000           0         6           rt_sigprocmask
  0.00    0.000000           0         2           clone
  0.00    0.000000           0         1           execve
  0.00    0.000000           0         2           sigaltstack
  0.00    0.000000           0         1           arch_prctl
  0.00    0.000000           0         1           gettid
  0.00    0.000000           0         3           futex
  0.00    0.000000           0         1           sched_getaffinity
  0.00    0.000000           0         1           readlinkat
------ ----------- ----------- --------- --------- ----------------
100.00    0.000000                   142           total
</code></pre><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¿è¡Œè¿™ä¸ªç¨‹åºçš„è¯ï¼Œåªè¦æœ‰ä¸ªå†…æ ¸å¯ä»¥å®ç°è¿™<code>13</code>ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå°±å¤Ÿäº†ã€‚ğŸ˜¼<p>ä¸è¿‡ <code>strace</code> æ˜¯æ€ä¹ˆåšåˆ°ç›‘å¬ç³»ç»Ÿè°ƒç”¨çš„å‘¢ï¼Ÿ<p>å®é™…ä¸Š <code>strace</code> ä½¿ç”¨äº† Linux çš„å¦ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œ<code>ptrace</code>ã€‚<code>ptrace</code> å¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹ç›‘å¬ã€æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼Œæ£€æŸ¥ã€æ”¹å˜è¯¥è¿›ç¨‹çš„å†…å­˜ã€å¯„å­˜å™¨ç­‰ç­‰ã€‚è¿™ç»å¸¸ç”¨äºæ–­ç‚¹è°ƒè¯•ã€å’Œç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªã€‚å¾ˆæš´åŠ›ã€å¾ˆå¼ºå¤§â€¦â€¦ğŸ’ª<h1 id=ç”¨-go-å†™ä¸€ä¸ª-strace>ç”¨ Go å†™ä¸€ä¸ª <code>strace</code></h1><p>æ—¢ç„¶ <code>strace</code> æ˜¯ä½¿ç”¨çš„ <code>ptrace</code> ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œ Go å¯ä»¥ç›´æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ä¸”å°è£…äº†ä¸€äº› <code>ptrace</code> çš„è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®å¯ä»¥ç”¨ Go å®ç°ä¸€ä¸ª <code>strace</code>ã€‚<h2 id=è°ƒç”¨å¦ä¸€ä¸ªå‘½ä»¤>è°ƒç”¨å¦ä¸€ä¸ªå‘½ä»¤</h2><pre><code class=language-go>//	main.go
package main

import (
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;os/exec&quot;
)

func main() {
	fmt.Printf(&quot;Run %v\n&quot;, os.Args[1:])

	cmd := exec.Command(os.Args[1], os.Args[2:]...)
	cmd.Stderr = os.Stderr
	cmd.Stdin = os.Stdin
	cmd.Stdout = os.Stdout

	cmd.Start()
	err := cmd.Wait()
	if err != nil {
		fmt.Printf(&quot;wait() returned: %v\n&quot;, err)
	}
}
</code></pre><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>exec.Command()</code> æ¥å»ºç«‹è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå°†ç³»ç»Ÿçš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯å¯¹æ¥è¿‡å»ï¼Œå¹¶ä¸”æŠŠå‚æ•°ä¼ é€’è¿‡å»ï¼Œç„¶åå¼€å§‹æ‰§è¡Œã€‚<pre><code class=language-bash>$ ./strace ../hello/hello abcd
Run [../hello/hello abcd]
Hello, GopherCon!
</code></pre><h2 id=æ·»åŠ -ptrace-æ”¯æŒ>æ·»åŠ  <code>ptrace</code> æ”¯æŒ</h2><p>æ·»åŠ  <code>ptrace</code> æ”¯æŒéå¸¸ç®€å•ï¼Œè®¾ç½® <code>cmd.SysProcAttr</code> å³å¯ã€‚<pre><code class=language-go>  ...
	cmd.Stdout = os.Stdout
  //  è®¾ç½® Ptrace ä¸º true
	cmd.SysProcAttr = &amp;syscall.SysProcAttr{
		Ptrace: true,
	}
  ...

  //  ä¸ºäº†æ›´æ˜æ˜¾çš„çœ‹å‡ºæ•ˆæœï¼Œåœ¨é€€å‡ºå‰ç­‰å¾…ä¸€ä¼šå„¿
	time.Sleep(time.Second * 2)
}
</code></pre><p>è¿™æ¬¡å†æ‰§è¡Œï¼Œå°±ä¼šå‘ç°ï¼Œè¢«è°ƒç”¨çš„ç¨‹åºæš‚åœäº†ä¸€æ®µæ—¶é—´ï¼Œç„¶åæ‰ç»§ç»­æ‰§è¡Œï¼š<pre><code class=language-bash>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
# &lt;- è¿™é‡Œç­‰å€™äº†2ç§’
$ Hello, GopherCon!
</code></pre><p>ç”±äºå¯ç”¨äº† <code>ptrace</code>ï¼Œå½“ <code>hello</code> è¢«åŠ è½½åï¼Œå¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯æ§åˆ¶æƒå›åˆ°äº†æˆ‘ä»¬è¿™ä¸ªç¨‹åºï¼Œå°±åƒæ˜¯æ–­ç‚¹ä¸€æ ·ã€‚æ‰€ä»¥ <code>hello</code> æš‚åœäº†ä¸€æ®µæ—¶é—´ã€‚è€Œå½“ <code>time.Sleep()</code> ç»“æŸåï¼Œæˆ‘ä»¬çš„ä¸»ç¨‹åºé€€å‡ºï¼Œå’Œ <code>hello</code> æ–­å¼€äº†è¿™ä¸ªæ§åˆ¶è”ç³»ï¼Œäºæ˜¯ <code>hello</code> å°±ç»§ç»­æ‰§è¡Œï¼Œäºæ˜¯çœ‹åˆ°äº†åé¢çš„ <code>Hello, GopherCon!</code> äº†ã€‚<h2 id=æ‰“å°æ–­ç‚¹çš„å¯„å­˜å™¨å˜é‡>æ‰“å°æ–­ç‚¹çš„å¯„å­˜å™¨å˜é‡</h2><p>æ—¢ç„¶æ˜¯æ–­ç‚¹ï¼Œæ§åˆ¶æƒå›åˆ°ä¸»ç¨‹åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥æ‰“å°è¢«è°ƒè¯•ç¨‹åºçš„å¯„å­˜å™¨å˜é‡ï¼š<pre><code class=language-go>	pid := cmd.Process.Pid
	var regs syscall.PtraceRegs
	if err = syscall.PtraceGetRegs(pid, &amp;regs); err != nil {
		panic(err)
	}

	fmt.Printf(&quot;%#v\n&quot;, regs)
</code></pre><p>ç„¶åå†æ¬¡æ‰§è¡Œæˆ‘ä»¬çš„ straceï¼Œå°±å¯ä»¥çœ‹åˆ°å¯„å­˜å™¨ä¿¡æ¯äº†ï¼š<pre><code class=language-bash>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
syscall.PtraceRegs{R15:0x0, R14:0x0, R13:0x0, R12:0x0, Rbp:0x0, Rbx:0x0, R11:0x0, R10:0x0, R9:0x0, R8:0x0, Rax:0x0, Rcx:0x0, Rdx:0x0, Rsi:0x0, Rdi:0x0, Orig_rax:0x3b, Rip:0x452060, Cs:0x33, Eflags:0x200, Rsp:0x7ffe862afdf0, Ss:0x2b, Fs_base:0x0, Gs_base:0x0, Ds:0x0, Es:0x0, Fs:0x0, Gs:0x0}
$ Hello, GopherCon!
</code></pre><p><code>hello</code> æ‰€æœ‰æ–­ç‚¹ä½ç½®çš„å¯„å­˜å™¨ä¿¡æ¯æˆ‘ä»¬å°±éƒ½å¯ä»¥çœ‹åˆ°äº†ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ç³»ç»Ÿè°ƒç”¨éƒ½ç”¨äº†å“ªäº›å¯„å­˜å™¨ä¹ˆï¼Ÿ<code>%rax</code> åº”è¯¥å­˜å‚¨çš„æ˜¯ç³»ç»Ÿè°ƒç”¨å·çš„ï¼Œè€Œè¿™é‡Œçš„ <code>Rax:0x0</code>ï¼Œç»è¿‡äº†è§£åï¼Œå®é™…çš„æ–­ç‚¹ä½ç½®çš„ç³»ç»Ÿè°ƒç”¨å­˜åœ¨äº <code>Orig_rax:0x3b</code>ã€‚<code>0x3b</code>ï¼Œä¹Ÿå°±æ˜¯ <code>59</code> å·ç³»ç»Ÿè°ƒç”¨ï¼ŒæŸ¥è¯¢ä¹‹å‰çš„è¡¨æ ¼ï¼Œå¯ä»¥çŸ¥é“åœ¨ Linux é‡Œå¯¹åº”çš„æ˜¯ <code>sys_execve</code>ã€‚<h2 id=è¾“å‡ºç³»ç»Ÿè°ƒç”¨åç§°>è¾“å‡ºç³»ç»Ÿè°ƒç”¨åç§°</h2><p>æ—¢ç„¶çŸ¥é“äº†ç³»ç»Ÿè°ƒç”¨å·ï¼Œå¯ä¸å¯ä»¥ç›´æ¥æ‰“å°å‡ºç³»ç»Ÿè°ƒç”¨åå­—ï¼Ÿåœ¨ Go ä¸­ï¼Œè¿™å¾ˆå®¹æ˜“ï¼Œä½¿ç”¨ <code>github.com/seccomp/libseccomp-golang</code> å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬è¿›è¡Œä¸€å±‚å°è£…ï¼Œå°è£…ä¸º <code>syscallCounter</code>ï¼Œç„¶ååœ¨æˆ‘ä»¬çš„ <code>main.go</code> ä¸­è°ƒç”¨ï¼š<pre><code class=language-go>	var ss syscallCounter
	ss = ss.init()

	name := ss.getName(regs.Orig_rax)
	fmt.Printf(&quot;%s\n&quot;, name)
</code></pre><p>ç„¶åå†æ¬¡è¿è¡Œï¼Œå°±ä¼šçœ‹åˆ°è¾“å‡ºçš„åå­— <code>execve</code> äº†ï¼š<pre><code class=language-bash>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
execve
$ Hello, GopherCon!
</code></pre><h2 id=è¾“å‡ºæ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨>è¾“å‡ºæ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨</h2><p>è¿™åªæ˜¯ç¢°åˆ°çš„ç¬¬ä¸€ä¸ª <code>syscall</code>ï¼Œå¦‚ä½•æ‰èƒ½æ˜¾ç¤ºæ¥ä¸‹æ¥çš„ç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿ<p><code>ptrace</code> å…è®¸æŒ‡å®šåœ¨ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æš‚åœï¼Œæ‰€ä»¥åªéœ€è¦åœ¨æ‰“å° <code>syscall</code> åå­—ä¹‹åï¼ŒåŠ å…¥è¿™éƒ¨åˆ†è®¾ç½®ï¼Œç„¶åæ•´ä½“å¾ªç¯å°±å¥½äº†ã€‚<pre><code class=language-go>
	for {
		//	æ‰“å°æ–­ç‚¹å¯„å­˜å™¨å€¼
		if err = syscall.PtraceGetRegs(pid, &amp;regs); err != nil {
			panic(err)
		}
		// fmt.Printf(&quot;%#v\n&quot;, regs)

		//	è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„åå­—
		var ss syscallCounter
		ss = ss.init()
		name := ss.getName(regs.Orig_rax)
		fmt.Printf(&quot;%s\n&quot;, name)

		//	è¦æ±‚åœ¨ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æš‚åœ
		if err := syscall.PtraceSyscall(pid, 0); err != nil {
			panic(err)
		}

		//	å¼€å§‹ç­‰å¾…ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨
		if _, err = syscall.Wait4(pid, nil, 0, nil); err != nil {
			panic(err)
		}
	}
</code></pre><p>è¿™æ¬¡æˆ‘ä»¬å†æ‰§è¡Œæˆ‘ä»¬çš„ straceï¼Œå°±ä¼šå‘ç°æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ‰“å°å‡ºæ¥äº†ï¼š<pre><code class=language-go>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
execve
arch_prctl
arch_prctl
sched_getaffinity
sched_getaffinity
mmap
mmap
munmap

...

futex
futex
readlinkat
readlinkat
mmap
mmap
write
Hello, GopherCon!
write
exit_group
panic: no such process

goroutine 1 [running]:
main.main()
        /vagrant/syscall/strace/main.go:36 +0x530
</code></pre><p>ä¸è¿‡æ³¨æ„åˆ°æœ€åå‡ºç°äº† <code>panic: no such process</code> äº†ä¹ˆï¼Ÿè¿™æ˜¯å› ä¸º <code>hello</code> ç¨‹åºæ‰§è¡Œå®Œåé€€å‡ºäº†ï¼Œæ‰€ä»¥è‡ªç„¶æˆ‘ä»¬çš„ <code>main()</code> ç¨‹åºæ— æ³•ç»§ç»­å–å¾—å…¶å¯„å­˜å™¨çš„å€¼äº†ã€‚<p>æ€ä¹ˆæ‰èƒ½ä¸ <code>panic</code> å‘¢ï¼Ÿå¾ˆç®€å•å˜›ï¼Œæˆ‘ä»¬åœ¨<code>36</code>è¡Œé‚£é‡Œï¼Œå»æ‰ <code>panic()</code>ï¼Œç›´æ¥ <code>break</code> å‡ºå¾ªç¯å³å¯ã€‚ç„¶åå°±æ²¡æœ‰ <code>panic</code> å•¦ã€‚ğŸ˜¸<h2 id=å…¶å®-ptrace-ä¼šåœä¸¤æ¬¡>å…¶å® <code>ptrace</code> ä¼šåœä¸¤æ¬¡â€¦â€¦</h2><p>å¦‚æœä»”ç»†è§‚å¯Ÿä¹‹å‰çš„è¾“å‡ºï¼š<pre><code class=language-bash>...

readlinkat
readlinkat
mmap
mmap
futex
futex
futex
futex
write
Hello, GopherCon!
write
exit_group
</code></pre><p>æ³¨æ„åˆ°è²Œä¼¼æ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½æˆå¯¹å‡ºç°ä¹ˆï¼Ÿç‰¹åˆ«æ˜¯ <code>Hello, GopherCon!</code> çš„å‰åå„å¤¹äº†ä¸€ä¸ª <code>write</code>ã€‚çœŸçš„è¿™ä¹ˆæ•´é½çš„éƒ½æ˜¯ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ä¹ˆï¼Ÿä¸æ˜¯çš„ã€‚å…¶å®<strong>ç³»ç»Ÿè°ƒç”¨åªå‘ç”Ÿäº†ä¸€æ¬¡</strong>ï¼Œä¸è¿‡æˆ‘ä»¬çš„ç¨‹åºå´<strong>åœäº†ä¸¤æ¬¡</strong>ã€‚<p>å¦‚æœä»”ç»†çœ‹ <code>ptrace</code> çš„ <a href=http://man7.org/linux/man-pages/man2/ptrace.2.html target=_blank>manpage</a> çš„è¯ï¼Œç¿»åˆ°åé¢ï¼Œä¼šå‘ç°å®ƒæåˆ°ï¼Œåœ¨è¢«ç›‘å¬ç¨‹åºè¿›å…¥ <code>syscall</code> ä¹‹å‰ï¼Œä¼šåœä¸€ä¸‹ï¼Œå«åš <code>syscall-enter-stop</code>ï¼Œè€Œåœ¨ä» <code>syscall</code> è¿”å›åï¼Œè¿˜ä¼šåœä¸€ä¸‹ï¼Œå«åš <code>syscall-exit-stop</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šå¯¹äºæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½è¾“å‡ºäº†ä¸¤è¾¹åå­—ï¼Œè€Œä¸”ä¸€æ¬¡æ˜¯ç³»ç»Ÿè°ƒç”¨ä¹‹å‰ã€ä¸€æ¬¡æ˜¯ä¹‹åã€‚æ‰€ä»¥å°±å‡ºç°äº†ä¸‰æ˜æ²»å½¢å¼çš„è¾“å‡ºäº†ï¼š<pre><code class=language-bash>write
Hello, GopherCon!
write
</code></pre><p>æ¯”è¾ƒéƒé—·çš„æ˜¯ï¼Œä»…ä»è¿”å›ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åŒºåˆ†å“ªæ¬¡æ˜¯ <code>syscall-enter-stop</code>ï¼Œå“ªæ¬¡æ˜¯ <code>syscall-exit-stop</code>ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½åœ¨å¤–é¢åšä¸€ä¸ª tik-tok çš„æ ‡å¿—ä½ï¼Œæ¥è¡¨æ˜åˆ°åº•æ˜¯å•¥ã€‚<p>æˆ‘ä»¬å†æ¬¡ä¿®æ”¹ç¨‹åºï¼Œæ·»åŠ ä¸€ä¸ª <code>exit</code> æ ‡å¿—ä½ã€‚<pre><code class=language-go>	//	æ˜¯å¦æ˜¯ syscall-exit-stop çš„æ ‡å¿—ä½
	exit := true
	for {
		//	å¦‚æœæ˜¯ syscall-exit-stop å°±æ‰“å°
		if exit {
			//	æ‰“å°æ–­ç‚¹å¯„å­˜å™¨å€¼
			if err := syscall.PtraceGetRegs(pid, &amp;regs); err != nil {
				break
			}
			// fmt.Printf(&quot;%#v\n&quot;, regs)

			//	è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„åå­—
			var ss syscallCounter
			ss = ss.init()
			name := ss.getName(regs.Orig_rax)
			fmt.Printf(&quot;%s\n&quot;, name)
		}

		//	è¦æ±‚åœ¨ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æš‚åœ
		if err := syscall.PtraceSyscall(pid, 0); err != nil {
			panic(err)
		}

		//	å¼€å§‹ç­‰å¾…ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨
		if _, err := syscall.Wait4(pid, nil, 0, nil); err != nil {
			panic(err)
		}

		//	æ¯æ¬¡å¾ªç¯ç¿»è½¬ä¸€ä¸‹ï¼Œæ¥è¡¨æ˜ enter, exit è¿™ä¸€å¯¹çŠ¶æ€
		exit = !exit
	}
</code></pre><blockquote><p>æ³¨æ„è¿™é‡Œ <code>exit</code> çš„åˆå§‹å€¼ä¸º <code>true</code>ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡åœçš„æ—¶å€™ï¼Œæ˜¯ <code>execve</code> ç³»ç»Ÿè°ƒç”¨ã€‚ç†Ÿæ‚‰ Unix/Linux ç¨‹åºè®¾è®¡çš„äººåº”è¯¥ä¸€ä¸‹å°±ååº”è¿‡æ¥äº†ï¼Œè¿™æ˜¯çˆ¶è¿›ç¨‹å»ºç«‹å­è¿›ç¨‹çš„å‡½æ•°/ç³»ç»Ÿè°ƒç”¨ã€‚å½“å­è¿›ç¨‹ç¬¬ä¸€æ¬¡è¿›å…¥ç”¨æˆ·æ€çš„æ—¶å€™ï¼Œå¿…ç„¶æ˜¯ä»è¿™ä¸ªç³»ç»Ÿè°ƒç”¨è¿”å›ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ª <code>syscall</code> æ˜¯ç”±çˆ¶è¿›ç¨‹å‘èµ·çš„ï¼Œåˆ†åˆ«åœ¨å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ä¸­è¿”å›ã€‚å› æ­¤å½“ <code>ptrace</code> ç¬¬ä¸€æ¬¡æˆªè·å­è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨äº‹ä»¶çš„æ—¶å€™ï¼Œä¸€å®šæ˜¯<strong>é€€å‡º</strong>ç³»ç»Ÿè°ƒç”¨çš„çŠ¶æ€ã€‚</blockquote><p>è¿™ä¸€æ¬¡å†è¾“å‡ºï¼Œå°±ä¼šå‘ç°æˆå¯¹çš„ç³»ç»Ÿè°ƒç”¨åªå‰©ä¸‹ååŠéƒ¨åˆ†äº†ï¼š<pre><code class=language-go>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
execve
arch_prctl
sched_getaffinity
mmap
munmap
mmap
mmap

...

clone
rt_sigprocmask
futex
futex
futex
readlinkat
mmap
futex
Hello, GopherCon!
write
</code></pre><p>è¿™å›å°±å¯¹äº†ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨è¿”å›åï¼Œæ‰æ‰“å°è¯¥ç³»ç»Ÿè°ƒç”¨ã€‚å› æ­¤ <code>Hello, GopherCon!</code> æ˜¯å‘ç”Ÿåœ¨æ‰“å° <code>write</code> ä¹‹å‰ã€‚<h2 id=æ±‡æ€»ç³»ç»Ÿè°ƒç”¨>æ±‡æ€»ç³»ç»Ÿè°ƒç”¨</h2><p>æˆ‘ä»¬ä¹‹å‰çœ‹è¿‡ <code>strace -c</code> è¿™ä¸ªæ±‡æ€»çš„ç»“æœï¼Œçœ‹èµ·æ¥ä¸é”™ã€‚æˆ‘ä»¬è¿™é‡Œå®ç°ä¸€ä¸‹ã€‚<p>è¿™é‡Œé’ˆå¯¹ <code>syscallCounter</code> å®ç°ä¸€ä¸ªè®¡æ•°å‡½æ•° <code>ss.inc()</code> å’Œä¸€ä¸ªæ±‡æ€»è¾“å‡ºå‡½æ•° <code>ss.print()</code>ï¼š<pre><code class=language-go>//  syscall_counter.go
func (s syscallCounter) inc(syscallID uint64) error {
	if syscallID &gt; maxSyscalls {
		return fmt.Errorf(&quot;invalid syscall ID (%x)&quot;, syscallID)
	}

	s[syscallID]++
	return nil
}

func (s syscallCounter) print() {
	w := tabwriter.NewWriter(os.Stdout, 0, 0, 8, ' ', tabwriter.AlignRight|tabwriter.Debug)
	for k, v := range s {
		if v &gt; 0 {
			name, _ := sec.ScmpSyscall(k).GetName()
			fmt.Fprintf(w, &quot;%d\t%s\n&quot;, v, name)
		}
	}
	w.Flush()
}
</code></pre><p>ç„¶ååœ¨æ¯æ¬¡æ‰“å°å‡½æ•°åçš„åœ°æ–¹åŠ å…¥ <code>ss.inc(regs.Orig_rax)</code> å³å¯ã€‚<pre><code class=language-go>func main() {
	fmt.Printf(&quot;Run %v\n&quot;, os.Args[1:])

	//	åˆ›å»ºè°ƒç”¨çš„å‘½ä»¤
	cmd := exec.Command(os.Args[1], os.Args[2:]...)
	cmd.Stderr = os.Stderr
	cmd.Stdin = os.Stdin
	cmd.Stdout = os.Stdout
	//	å¯ç”¨ ptrace
	cmd.SysProcAttr = &amp;syscall.SysProcAttr{
		Ptrace: true,
	}

	//	å¯åŠ¨ç¨‹åº
	cmd.Start()
	err := cmd.Wait()
	if err != nil {
		fmt.Printf(&quot;wait() returned: %v\n&quot;, err)
	}

	pid := cmd.Process.Pid
	var regs syscall.PtraceRegs
	var ss syscallCounter
	ss = ss.init()

	//	æ˜¯å¦æ˜¯ syscall-exit-stop çš„æ ‡å¿—ä½
	exit := true
	for {
		//	å¦‚æœæ˜¯ syscall-exit-stop å°±æ‰“å°
		if exit {
			//	æ‰“å°æ–­ç‚¹å¯„å­˜å™¨å€¼
			if err := syscall.PtraceGetRegs(pid, &amp;regs); err != nil {
				break
			}
			// fmt.Printf(&quot;%#v\n&quot;, regs)

			//	è¾“å‡ºç³»ç»Ÿè°ƒç”¨çš„åå­—
			name := ss.getName(regs.Orig_rax)
			fmt.Printf(&quot;%s\n&quot;, name)

			//	å¯¹ç³»ç»Ÿè°ƒç”¨è®¡æ•°
			ss.inc(regs.Orig_rax)
		}

		//	è¦æ±‚åœ¨ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æš‚åœ
		if err := syscall.PtraceSyscall(pid, 0); err != nil {
			panic(err)
		}

		//	å¼€å§‹ç­‰å¾…ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨
		if _, err := syscall.Wait4(pid, nil, 0, nil); err != nil {
			panic(err)
		}

		//	æ¯æ¬¡å¾ªç¯ç¿»è½¬ä¸€ä¸‹ï¼Œæ¥è¡¨æ˜ enter, exit è¿™ä¸€å¯¹çŠ¶æ€
		exit = !exit
	}

	//	è¾“å‡ºç³»ç»Ÿè°ƒç”¨æ±‡æ€»
	ss.print()
}
</code></pre><p>è¿™ä¸€æ¬¡å†æ¥è¾“å‡ºçœ‹çœ‹ã€‚<pre><code class=language-go>$ ./strace ../hello/hello
Run [../hello/hello]
wait() returned: stop signal: trace/breakpoint trap
execve
arch_prctl
sched_getaffinity
mmap

...

readlinkat
futex
mmap
Hello, GopherCon!
write
          1|write
          8|mmap
          1|munmap
        114|rt_sigaction
          8|rt_sigprocmask
          3|clone
          1|execve
          2|sigaltstack
          1|arch_prctl
          1|gettid
          3|futex
          1|sched_getaffinity
          1|readlinkat
</code></pre><p>è¿™æ¬¡å°±å¯ä»¥çœ‹åˆ°æ±‡æ€»æ•°æ®äº†ã€‚ğŸ˜<h1 id=syscall-ä¸ç³»ç»Ÿå®‰å…¨>syscall ä¸ç³»ç»Ÿå®‰å…¨</h1><ul><li>å¯¹äºå¾®æœåŠ¡è€Œè¨€ï¼Œæ¯ä¸ªæœåŠ¡åªä¼šæ‰§è¡Œå¾ˆå°‘ä¸€éƒ¨åˆ†åŠŸèƒ½<br><li>å¯¹äºå®‰å…¨è€Œè¨€ï¼Œåˆ™è¿½æ±‚çš„æ˜¯<strong>æœ€å°æƒé™</strong>çš„åŸåˆ™<br><br></ul><p>ä»å‰é¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°è¿™ä¸ª <code>hello</code> ç¨‹åºåªéœ€è¦åå‡ ä¸ª <code>syscall</code>ï¼Œé‚£ä¹ˆå¯¹äºæ‹¥æœ‰ <code>330</code> å¤šä¸ª <code>syscall</code> çš„ Linux å†…æ ¸è€Œè¨€ï¼Œç»å¤§å¤šæ•°çš„ç³»ç»Ÿè°ƒç”¨æˆ‘ä»¬éƒ½ä¸éœ€è¦ã€‚æ›´ä½•å†µç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£åˆ° <code>ptrace</code> è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯éå¸¸å±é™©çš„ï¼Œä¸åº”è¯¥å…è®¸ä¸éœ€è¦çš„ç¨‹åºæœ‰è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„èƒ½åŠ›ã€‚<p>é‚£ä¹ˆæˆ–è®¸æˆ‘ä»¬å¯ä»¥é€šè¿‡çº¦æŸï¼Œé™å®šè¿™ä¸ª <code>hello</code> åªå¯ä»¥ç”¨è¿™åå‡ ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å®ƒçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¸å…è®¸ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥<strong>ç¼©å°æ”»å‡»é¢ç§¯</strong>ï¼Œä»¥æ»¡è¶³<strong>æœ€å°æƒé™</strong>çš„å®‰å…¨éœ€æ±‚ã€‚<p>å¯¹äºä¼ ç»Ÿçš„è‡ƒè‚¿çš„åº”ç”¨è€Œè¨€ï¼Œå¯èƒ½æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºåº”ç”¨å¯èƒ½ä¼šä»€ä¹ˆéƒ½å¹²ï¼Œå¯¼è‡´ç”¨äº†å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ã€‚ä½†æ˜¯å¯¹äºå¾®æœåŠ¡è€Œè¨€ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¾ˆå°ï¼Œåªåšç‰¹å®šçš„äº‹æƒ…ï¼Œé‚£ä¹ˆå…¶ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨å°±ä¼šè¢«é™å®šåœ¨ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´ã€‚é‚£ä¹ˆå¦‚æœå¯ä»¥è¿›è¡Œè¿™ç§ç³»ç»Ÿè°ƒç”¨çš„çº¦æŸï¼Œæˆ‘ä»¬å°±å¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚<p><a href=https://en.wikipedia.org/wiki/Seccomp target=_blank>seccomp</a> å¯ä»¥è®©æˆ‘ä»¬åšè¿™ä¸ªäº‹æƒ…ï¼Œåœ¨ docker ä¸­ç”šè‡³ç›´æ¥<a href=https://docs.docker.com/engine/security/seccomp/ target=_blank>é›†æˆäº† seccomp çš„å®‰å…¨çº¦æŸ</a>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç»“åˆ Docker æ¥çº¦æŸå¾®æœåŠ¡çš„ç»†åŒ–çš„ç³»ç»Ÿè°ƒç”¨æƒé™ã€‚<pre><code class=language-bash>$ docker run --security-opt seccomp=/path/sc_profile.json hello-world
</code></pre><p>è¿™ä¸œè¥¿çš„ç¼ºç‚¹æ˜¯å¤ªé•¿äº†ï¼Œæ¯”å¦‚çœ‹ä¸€ä¸‹è¿™ä¸ªé»˜è®¤é…ç½®çš„æ–‡ä»¶ï¼š<a href=https://github.com/moby/moby/blob/master/profiles/seccomp/default.json target=_blank>https://github.com/moby/moby/blob/master/profiles/seccomp/default.json</a><p>è¿˜æœ‰æ›´é•¿çš„ï¼Œæ¯”å¦‚ Jessie Frazelle(Docker Queen) åšçš„é‚£ä¸ªåœ¨ Docker ä¸­è¿è¡Œ Chrome çš„é•œåƒæ‰€éœ€è¦çš„ seccomp é…ç½®ï¼š<a href=https://github.com/jessfraz/dotfiles/blob/master/etc/docker/seccomp/chrome.json target=_blank>https://github.com/jessfraz/dotfiles/blob/master/etc/docker/seccomp/chrome.json</a><p>è¿™æ²¡æœ‰ä¸ªåŸºç¡€è¿˜çœŸå†™ä¸äº†ï¼Œæˆ–è®¸è¿™å°±æ˜¯å®‰å…¨å…¬å¸å­˜åœ¨çš„åŸå› ä¹‹ä¸€å§â€¦â€¦ğŸ˜<h2 id=ç¨‹åºä¸­ä½¿ç”¨-seccomp-é…ç½®>ç¨‹åºä¸­ä½¿ç”¨ seccomp é…ç½®</h2><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®š <code>seccomp</code> çš„é…ç½®ã€‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª <code>disallow()</code> å‡½æ•°ï¼Œæ¥ç¦æ­¢æŸä¸ª syscallã€‚<pre><code class=language-go>func disallow(sc string) {
	id, err := sec.GetSyscallFromName(sc)
	if err != nil {
		panic(err)
	}

	filter, _ := sec.NewFilter(sec.ActAllow)
	filter.AddRule(id, sec.ActErrno.SetReturnCode(int16(syscall.EPERM)))
	filter.Load()
}
</code></pre><p>ç„¶åæˆ‘ä»¬åœ¨ <code>main()</code> ä¸­æ‰§è¡Œ <code>hello</code> å‰ï¼Œç¦ç”¨ä¸€ä¸ª syscallï¼Œå‡è®¾æˆ‘ä»¬ç¦ç”¨ <code>write</code>ï¼š<pre><code class=language-go>func main() {
	fmt.Printf(&quot;Run %v\n&quot;, os.Args[1:])

	//	ç¦ç”¨ write ç³»ç»Ÿè°ƒç”¨
	disallow(&quot;write&quot;)

	//	åˆ›å»ºè°ƒç”¨çš„å‘½ä»¤
	cmd := exec.Command(os.Args[1], os.Args[2:]...)
...
}
</code></pre><p>ç„¶åå†æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œå‘ç°ä»€ä¹ˆç³»ç»Ÿè°ƒç”¨éƒ½æ²¡è¾“å‡ºï¼š<pre><code class=language-bash>$ ./strace ../hello/hello
Run [../hello/hello]
</code></pre><p>ä¸ºä»€ä¹ˆè¿é™¤äº† <code>write</code> çš„ç³»ç»Ÿè°ƒç”¨éƒ½æ²¡æœ‰è¾“å‡ºå‘¢ï¼Ÿå› ä¸ºæ‰“å°é‚£äº›å­—ç¬¦ä¸²åˆ°å±å¹•çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨ <code>write</code> æ¥å®ç°çš„ã€‚è€Œè¿™ä¸ªåŠ è½½çš„ <code>seccomp</code> çš„å®‰å…¨é…ç½®ï¼Œæ˜¯å¯¹å½“å‰è¿›ç¨‹æœ‰æ•ˆçš„ï¼ˆå½“ç„¶ï¼Œ<code>hello</code> æ‰§è¡Œåä¹Ÿä¼šé›†æˆè¯¥é…ç½®ï¼‰ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹è‡ªç„¶ä¹Ÿä¸èƒ½é€šè¿‡ <code>write</code> ç³»ç»Ÿè°ƒç”¨æ‰“å°è¾“å‡ºäº†ï¼Œæˆ‘ä»¬è²Œä¼¼æŠŠè‡ªå·±ä¹Ÿç»™ç¦äº†â€¦â€¦ğŸ˜…<p>å¥½å§ï¼Œè¿™æ ·å­æˆ‘ä»¬æ ¹æœ¬å•¥éƒ½çœ‹ä¸è§ï¼Œæ¥æ¢ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ç¦æ­¢ä¸€ä¸‹ã€‚è¿™æ¬¡æˆ‘ä»¬æ¢ä¸ªå‘½ä»¤ï¼Œä¸ç”¨ <code>hello</code> äº†ï¼Œç”¨ <code>echo hello</code>ã€‚ç„¶åç”¨æˆ‘ä»¬çš„ strace çœ‹çœ‹éƒ½æœ‰å•¥ç³»ç»Ÿè°ƒç”¨ï¼š<pre><code class=language-bash>        1|read
        1|write
        3|open
        5|close
        4|fstat
        7|mmap
        4|mprotect
        1|munmap
        3|brk
        3|access
        1|execve
        1|arch_prctl
</code></pre><p>å—¯ï¼Œè¿™é‡Œçœ‹ <code>open</code> ä¸é¡ºçœ¼ï¼Œå°±ç¦ç”¨å®ƒäº†ã€‚<pre><code class=language-go>	//	ç¦ç”¨ open ç³»ç»Ÿè°ƒç”¨
	disallow(&quot;open&quot;)
</code></pre><p>æ„å»ºåï¼Œå†æ¬¡è¿è¡Œï¼š<pre><code class=language-bash>$ ./strace echo hello
Run [echo hello]
wait() returned: stop signal: trace/breakpoint trap
execve
brk
access
mmap
access
open
open
stat
open
stat
open
stat
open
stat
echo: error while loading shared libraries: libc.so.6: cannot open shared object file: Operation not permitted
writev
        5|open
        4|stat
        1|mmap
        1|brk
        1|writev
        2|access
        1|execve
</code></pre><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº† <code>cannot open shared object file: Operation not permitted</code> çš„æŠ¥é”™ï¼Œè¿™å°±æ˜¯ç”±äºæˆ‘ä»¬ç¦æ­¢äº† <code>open</code> ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œå¯¼è‡´ <code>echo hello</code> è¿›è¡Œè¯¥ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå‡ºé”™äº†ã€‚è€Œä¸”å¯ä»¥æ³¨æ„åˆ°ï¼Œ<code>echo hello</code> çš„å†…éƒ¨æœ‰é”™è¯¯å¤„ç†ï¼Œå°è¯•äº†å¥½å‡ æ¬¡æ‰æœ€åæŠ¥é”™é€€å‡ºçš„ã€‚</div><div class=clear></div></div></div></article><div class=clear></div><p class=post-tags><span class="fa fa-tags">Tags:</span>
<a rel=tag href=../../../../tags/golang>golang</a><div id=related-posts><div class=related-inner></div></div><section id=comments class=themeform><div id=gitment></div><link rel=stylesheet href=https://imsun.github.io/gitment/style/default.css><script src=https://imsun.github.io/gitment/dist/gitment.browser.js></script><script>var gitment=new Gitment({id:location.pathname,owner:'rinetd',repo:'rinetd.github.io',oauth:{client_id:'89af57db85ca20b7668c',client_secret:'4e57a031d7bd29f740559a907db2fe0efb3bf813',},})
gitment.render('gitment')</script></section><section id=comments class=themeform></section></div></div><div class="sidebar s1 collapsed" data-position=left data-layout=col-3cm data-sb-id=s1><a class=sidebar-toggle title="Expand Sidebar"><i class="fas icon-sidebar-toggle"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>Follow:<ul class=social-links><li><a class=social-tooltip href=mailto: title=Email><i class="fa fa-envelope"></i></a><li><a class=social-tooltip href=//github.com/ title=GitHub><i class="fa fa-github"></i></a><li><a class=social-tooltip title="RSS Feed" aria-label="RSS Feed" href=../../../../feed target=_blank style=color:rgba(255,255,255,.7)><i class="fa fa-rss"></i></a></ul></div><ul class="post-nav group"><li class=previous><a href=http://blog.pytool.com/language/golang/hugo/hugo-template-lookup/ rel=prev><i class="fa fa-chevron-left"></i><strong>Previous Post</strong>
<span>Hugo æ¨¡æ¿template Lookup order</span></a></ul><div id=categories-2 class="widget widget_categories"><h3>åˆ†ç±»</h3><ul><li class="cat-item cat-item-1"><a href=../../../../categories/android/>Android</a>
<small>(17)</small><li class="cat-item cat-item-1"><a href=../../../../categories/devops/>Devops</a>
<small>(63)</small><li class="cat-item cat-item-1"><a href=../../../../categories/docker/>Docker</a>
<small>(15)</small><li class="cat-item cat-item-1"><a href=../../../../categories/golang/>Golang</a>
<small>(77)</small><li class="cat-item cat-item-1"><a href=../../../../categories/linux/>Linux</a>
<small>(77)</small><li class="cat-item cat-item-1"><a href=../../../../categories/linux-%E5%91%BD%E4%BB%A4/>Linux-å‘½ä»¤</a>
<small>(113)</small><li class="cat-item cat-item-1"><a href=../../../../categories/windows/>Windows</a>
<small>(5)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/>å‰ç«¯æŠ€æœ¯</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/>åµŒå…¥å¼</a>
<small>(22)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E5%B7%A5%E5%85%B7/>å·¥å…·</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/>å¸¸ç”¨ç®—æ³•</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/>æ•°æ®åº“</a>
<small>(36)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91/>æ–‡æœ¬ç¼–è¾‘</a>
<small>(27)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/>æ­£åˆ™è¡¨è¾¾å¼</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/>ç”Ÿæ´»æŠ€å·§</a>
<small>(4)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E7%A8%8B%E5%BA%8F%E5%91%98/>ç¨‹åºå‘˜</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/>ç½‘ç»œå®‰å…¨</a>
<small>(39)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7/>é›†ç¾¤ç›‘æ§</a>
<small>(7)</small><li class="cat-item cat-item-1"><a href=../../../../categories/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/>é™æ€åšå®¢</a>
<small>(14)</small></ul></div></div></div><div class="sidebar s2 collapsed" data-position=right data-layout=col-3cm data-sb-id=s2><a class=sidebar-toggle title="Expand Sidebar"><i class="fas icon-sidebar-toggle"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>More</div><ul class="post-nav group"><li class=next><a href=http://blog.pytool.com/language/golang/goher/2017-10-04-video-understanding-channels/ rel=next><i class="fa fa-chevron-right"></i><strong>Next post</strong>
<span>è§†é¢‘ç¬”è®°ï¼šç†è§£ channels - Kavya Joshi</span></a></ul><div id=tag_cloud-2 class="widget widget_tag_cloud"><h3>æ ‡ç­¾äº‘</h3><div class="tagcloud post-tags"><a rel=tag href=../../../../tags/ansible/ class=tag-link-12 title="1 Posts">ansible<small>(12)</small></a>
<a rel=tag href=../../../../tags/awesome/ class=tag-link-3 title="1 Posts">awesome<small>(3)</small></a>
<a rel=tag href=../../../../tags/centos7/ class=tag-link-2 title="1 Posts">centos7<small>(2)</small></a>
<a rel=tag href=../../../../tags/css/ class=tag-link-18 title="1 Posts">css<small>(18)</small></a>
<a rel=tag href=../../../../tags/curd/ class=tag-link-3 title="1 Posts">curd<small>(3)</small></a>
<a rel=tag href=../../../../tags/curl/ class=tag-link-2 title="1 Posts">curl<small>(2)</small></a>
<a rel=tag href=../../../../tags/docker/ class=tag-link-18 title="1 Posts">docker<small>(18)</small></a>
<a rel=tag href=../../../../tags/drone/ class=tag-link-18 title="1 Posts">drone<small>(18)</small></a>
<a rel=tag href=../../../../tags/emacs/ class=tag-link-12 title="1 Posts">emacs<small>(12)</small></a>
<a rel=tag href=../../../../tags/encode/ class=tag-link-3 title="1 Posts">encode<small>(3)</small></a>
<a rel=tag href=../../../../tags/etcd/ class=tag-link-4 title="1 Posts">etcd<small>(4)</small></a>
<a rel=tag href=../../../../tags/flannel/ class=tag-link-2 title="1 Posts">flannel<small>(2)</small></a>
<a rel=tag href=../../../../tags/git/ class=tag-link-4 title="1 Posts">git<small>(4)</small></a>
<a rel=tag href=../../../../tags/golang/ class=tag-link-84 title="1 Posts">golang<small>(84)</small></a>
<a rel=tag href=../../../../tags/gradle/ class=tag-link-3 title="1 Posts">gradle<small>(3)</small></a>
<a rel=tag href=../../../../tags/haproxy/ class=tag-link-5 title="1 Posts">haproxy<small>(5)</small></a>
<a rel=tag href=../../../../tags/hexo/ class=tag-link-2 title="1 Posts">hexo<small>(2)</small></a>
<a rel=tag href=../../../../tags/html/ class=tag-link-2 title="1 Posts">html<small>(2)</small></a>
<a rel=tag href=../../../../tags/http/ class=tag-link-2 title="1 Posts">http<small>(2)</small></a>
<a rel=tag href=../../../../tags/hugo/ class=tag-link-13 title="1 Posts">hugo<small>(13)</small></a>
<a rel=tag href=../../../../tags/imagemagick/ class=tag-link-2 title="1 Posts">imagemagick<small>(2)</small></a>
<a rel=tag href=../../../../tags/ip/ class=tag-link-3 title="1 Posts">ip<small>(3)</small></a>
<a rel=tag href=../../../../tags/iproute2/ class=tag-link-5 title="1 Posts">iproute2<small>(5)</small></a>
<a rel=tag href=../../../../tags/iptables/ class=tag-link-13 title="1 Posts">iptables<small>(13)</small></a>
<a rel=tag href=../../../../tags/javascript/ class=tag-link-6 title="1 Posts">javascript<small>(6)</small></a>
<a rel=tag href=../../../../tags/jwt/ class=tag-link-3 title="1 Posts">jwt<small>(3)</small></a>
<a rel=tag href=../../../../tags/kubernetes/ class=tag-link-11 title="1 Posts">kubernetes<small>(11)</small></a>
<a rel=tag href=../../../../tags/linux/ class=tag-link-6 title="1 Posts">linux<small>(6)</small></a>
<a rel=tag href=../../../../tags/lvs/ class=tag-link-8 title="1 Posts">lvs<small>(8)</small></a>
<a rel=tag href=../../../../tags/makefile/ class=tag-link-2 title="1 Posts">makefile<small>(2)</small></a>
<a rel=tag href=../../../../tags/mariadb/ class=tag-link-9 title="1 Posts">mariadb<small>(9)</small></a>
<a rel=tag href=../../../../tags/maven/ class=tag-link-2 title="1 Posts">maven<small>(2)</small></a>
<a rel=tag href=../../../../tags/meteor/ class=tag-link-7 title="1 Posts">meteor<small>(7)</small></a>
<a rel=tag href=../../../../tags/ml/ class=tag-link-2 title="1 Posts">ml<small>(2)</small></a>
<a rel=tag href=../../../../tags/mysql/ class=tag-link-50 title="1 Posts">mysql<small>(50)</small></a>
<a rel=tag href=../../../../tags/nginx/ class=tag-link-26 title="1 Posts">nginx<small>(26)</small></a>
<a rel=tag href=../../../../tags/nmap/ class=tag-link-3 title="1 Posts">nmap<small>(3)</small></a>
<a rel=tag href=../../../../tags/npm/ class=tag-link-3 title="1 Posts">npm<small>(3)</small></a>
<a rel=tag href=../../../../tags/oauth2/ class=tag-link-2 title="1 Posts">oauth2<small>(2)</small></a>
<a rel=tag href=../../../../tags/pandoc/ class=tag-link-2 title="1 Posts">pandoc<small>(2)</small></a>
<a rel=tag href=../../../../tags/php/ class=tag-link-3 title="1 Posts">php<small>(3)</small></a>
<a rel=tag href=../../../../tags/powershell/ class=tag-link-2 title="1 Posts">powershell<small>(2)</small></a>
<a rel=tag href=../../../../tags/prometheus/ class=tag-link-8 title="1 Posts">prometheus<small>(8)</small></a>
<a rel=tag href=../../../../tags/python/ class=tag-link-5 title="1 Posts">python<small>(5)</small></a>
<a rel=tag href=../../../../tags/redis/ class=tag-link-2 title="1 Posts">redis<small>(2)</small></a>
<a rel=tag href=../../../../tags/responsive/ class=tag-link-3 title="1 Posts">responsive<small>(3)</small></a>
<a rel=tag href=../../../../tags/restful/ class=tag-link-6 title="1 Posts">restful<small>(6)</small></a>
<a rel=tag href=../../../../tags/rsync/ class=tag-link-2 title="1 Posts">rsync<small>(2)</small></a>
<a rel=tag href=../../../../tags/scrapy/ class=tag-link-8 title="1 Posts">scrapy<small>(8)</small></a>
<a rel=tag href=../../../../tags/scss/ class=tag-link-2 title="1 Posts">scss<small>(2)</small></a>
<a rel=tag href=../../../../tags/sed/ class=tag-link-3 title="1 Posts">sed<small>(3)</small></a>
<a rel=tag href=../../../../tags/seo/ class=tag-link-5 title="1 Posts">seo<small>(5)</small></a>
<a rel=tag href=../../../../tags/shell/ class=tag-link-8 title="1 Posts">shell<small>(8)</small></a>
<a rel=tag href=../../../../tags/ssh/ class=tag-link-3 title="1 Posts">ssh<small>(3)</small></a>
<a rel=tag href=../../../../tags/stm32/ class=tag-link-5 title="1 Posts">stm32<small>(5)</small></a>
<a rel=tag href=../../../../tags/swagger/ class=tag-link-2 title="1 Posts">swagger<small>(2)</small></a>
<a rel=tag href=../../../../tags/swarm/ class=tag-link-2 title="1 Posts">swarm<small>(2)</small></a>
<a rel=tag href=../../../../tags/sysbench/ class=tag-link-2 title="1 Posts">sysbench<small>(2)</small></a>
<a rel=tag href=../../../../tags/sysctl/ class=tag-link-2 title="1 Posts">sysctl<small>(2)</small></a>
<a rel=tag href=../../../../tags/tc/ class=tag-link-2 title="1 Posts">tc<small>(2)</small></a>
<a rel=tag href=../../../../tags/tcpdump/ class=tag-link-2 title="1 Posts">tcpdump<small>(2)</small></a>
<a rel=tag href=../../../../tags/timezone/ class=tag-link-2 title="1 Posts">timezone<small>(2)</small></a>
<a rel=tag href=../../../../tags/tshark/ class=tag-link-2 title="1 Posts">tshark<small>(2)</small></a>
<a rel=tag href=../../../../tags/ubuntu/ class=tag-link-2 title="1 Posts">ubuntu<small>(2)</small></a>
<a rel=tag href=../../../../tags/ulimit/ class=tag-link-2 title="1 Posts">ulimit<small>(2)</small></a>
<a rel=tag href=../../../../tags/vim/ class=tag-link-11 title="1 Posts">vim<small>(11)</small></a>
<a rel=tag href=../../../../tags/webpack3/ class=tag-link-2 title="1 Posts">webpack3<small>(2)</small></a>
<a rel=tag href=../../../../tags/windows/ class=tag-link-2 title="1 Posts">windows<small>(2)</small></a>
<a rel=tag href=../../../../tags/wireshark/ class=tag-link-2 title="1 Posts">wireshark<small>(2)</small></a>
<a rel=tag href=../../../../tags/xidel/ class=tag-link-2 title="1 Posts">xidel<small>(2)</small></a>
<a rel=tag href=../../../../tags/xml/ class=tag-link-2 title="1 Posts">xml<small>(2)</small></a>
<a rel=tag href=../../../../tags/yaml/ class=tag-link-2 title="1 Posts">yaml<small>(2)</small></a>
<a rel=tag href=../../../../tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=tag-link-2 title="1 Posts">å¾®æœåŠ¡<small>(2)</small></a></div></div></div></div>`</div></div></div></div></div><footer id=footer><section class=container id=footer-bottom><div class=container-inner><a id=back-to-top href=#><i class="fa fa-angle-up"></i></a><div class="pad group"><div class="grid one-half"><div id=copyright><p>Copyright (c) 2017. All rights reserved. (ç‰ˆæƒæ‰€æœ‰) <a href=http://www.miitbeian.gov.cn/>é²ICPå¤‡17074587å·-1</a></div></div><div class="grid one-half last"><ul class=social-links><li><a class=social-tooltip title="On WeiBo" href=http://weibo.com/rinetd target=_blank><i class="fa fa-weibo"></i></a><li><a class=social-tooltip title="On Twitter" href=https://twitter.com/rinetd target=_blank><i class="fa fa-twitter"></i></a><li><a class=social-tooltip title="On GitHub" href=https://github.com/rinetd target=_blank><i class="fa fa-github"></i></a></ul></div></div></div></section></footer><div class=back-to-top id=back-to-top><i class="fa fa-angle-double-up"></i></div><script>var HUParams={"_disabled":[],"SmoothScroll":{"Enabled":true,"Options":{"touchpadSupport":false}},"centerAllImg":"1","timerOnScrollAllBrowsers":"1","extLinksStyle":"1","extLinksTargetExt":"1","extLinksSkipSelectors":{"classes":["btn","button"],"ids":[]},"imgSmartLoadEnabled":"1","imgSmartLoadOpts":{"parentSelectors":[".container .content",".container .sidebar","#footer","#header-widgets"],"opts":{"excludeImg":[".tc-holder-img"],"fadeIn_options":100}},"goldenRatio":"1.618","gridGoldenRatioLimit":"350","sbStickyUserSettings":{"desktop":true,"mobile":true},"isWPMobile":"","menuStickyUserSettings":{"desktop":"stick_up","mobile":"stick_up"},"isDevMode":"","ajaxUrl":"https:\/\/demo-hueman.presscustomizr.com\/?huajax=1","frontNonce":{"id":"HuFrontNonce","handle":"798e5956c0"},"userStarted":{"with":"before|1.0.4","on":{"date":"2017-05-22 16:30:22.000000","timezone_type":3,"timezone":"UTC"}},"isWelcomeNoteOn":"","welcomeContent":""};</script><script src=https://cdn.bootcss.com/lodash-compat/3.10.2/lodash.min.js></script><script src=https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js></script><script src=../../../../front/js/scripts.js></script><script>$(".topbar-toggle-down").click(function(){$("#nav-topbar").css("overflow","visible");});</script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-106129999-2','auto');ga('send','pageview');</script><script async src=//www.google-analytics.com/analytics.js></script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5HM5XM2" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5HM5XM2');</script><script id=baidu_analytics>var _hmt=_hmt||[];(function(){if(window.location.hostname==='localhost')return;var hm=document.createElement("script");hm.async=true;hm.src="https://hm.baidu.com/hm.js?e2103759b6030b3c4ac84c63c542e493";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script>